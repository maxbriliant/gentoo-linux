::: {.mw-jump .sr-only}
Jump to: [content](#top)
:::

::: {.site-title}
::: {.container}
::: {.row}
::: {.site-title-buttons}
::: {.btn-group .btn-group-sm}
[[]{.fa .fa-fw .fa-download} **Get
Gentoo!**](https://get.gentoo.org/){.btn .get-gentoo}

::: {.btn-group .btn-group-sm}
[[]{.fa .fa-fw .fa-map-o} [gentoo.org sites]{.hidden-xs}
[]{.caret}](#){.btn .gentoo-org-sites .dropdown-toggle}

-   [[]{.fa .fa-home .fa-fw}
    gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
-   [[]{.fa .fa-file-text-o .fa-fw}
    Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
-   [[]{.fa .fa-bug .fa-fw}
    Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
-   [[]{.fa .fa-comments-o .fa-fw}
    Forums](https://forums.gentoo.org/ "Discuss with the community")
-   [[]{.fa .fa-hdd-o .fa-fw}
    Packages](https://packages.gentoo.org/ "Find software for your Gentoo")
-   
-   [[]{.fa .fa-rss .fa-fw}
    Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
-   [[]{.fa .fa-archive .fa-fw}
    Archives](https://archives.gentoo.org/ "Read up on past discussions")
-   [[]{.fa .fa-code .fa-fw}
    Gitweb](https://gitweb.gentoo.org/ "Browse our source code in Gitweb")
-   [[]{.fa .fa-code .fa-fw} CVS
    sources](https://sources.gentoo.org/ "Browse our source code in CVS")
-   
-   [[]{.fa .fa-server .fa-fw} Infra
    Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")
:::
:::
:::

::: {.logo}
![Gentoo Linux Logo](https://assets.gentoo.org/tyrian/site-logo.png)

[Wiki]{.site-label}
:::
:::
:::
:::

::: {.container}
::: {.row}
::: {.navbar-header}
[Toggle navigation]{.sr-only} []{.icon-bar} []{.icon-bar} []{.icon-bar}
:::

::: {.collapse .navbar-collapse .navbar-main-collapse}
-   [[Main
    page](/wiki/Main_Page "Visit the main page [z]")]{#n-mainpage-description}
-   [[Recent
    changes](/wiki/Special:RecentChanges "A list of recent changes in the wiki [r]")]{#n-recentchanges}
-   [[Help](/wiki/Special:MyLanguage/Help:Contents "The place to find out")]{#n-help}
-   [Gentoo []{.caret}](/wiki/Gentoo_Wiki:Menu-Gentoo){.dropdown-toggle}
    -   [[Gentoo Projects](/wiki/Project:Gentoo)]{#n-Gentoo-Projects}
-   [Documentation
    []{.caret}](/wiki/Gentoo_Wiki:Menu-Documentation){.dropdown-toggle}
    -   [[Gentoo
        Handbook](/wiki/Handbook:Main_Page)]{#n-Gentoo-Handbook}
    -   [[Gentoo FAQ](/wiki/FAQ)]{#n-Gentoo-FAQ}
    -   [[Featured
        Documents](/wiki/Project:Documentation/Overview)]{#n-Featured-Documents}
    -   
    -   Topics
    -   [[Core system](/wiki/Category:Core_system)]{#n-Core-system}
    -   [[Hardware](/wiki/Category:Hardware)]{#n-Hardware}
    -   [[Software](/wiki/Category:Software)]{#n-Software}
    -   [[Desktop](/wiki/Category:Desktop)]{#n-Desktop}
    -   [[Server &
        Security](/wiki/Category:Server_and_Security)]{#n-Server-.26-Security}
    -   [[Project &
        Community](/wiki/Category:Project_and_Community)]{#n-Project-.26-Community}

```{=html}
<!-- -->
```
-   [ Tools []{.caret}](#){.dropdown-toggle}
    -   [[What links
        here](/wiki/Special:WhatLinksHere/Handbook:AMD64/Full/Installation "A list of all wiki pages that link here [j]")]{#t-whatlinkshere}
    -   [[Related
        changes](/wiki/Special:RecentChangesLinked/Handbook:AMD64/Full/Installation "Recent changes in pages linked from this page [k]")]{#t-recentchangeslinked}
    -   [[Special
        pages](/wiki/Special:SpecialPages "A list of all special pages [q]")]{#t-specialpages}
    -   [[Printable
        version](/index.php?title=Handbook:AMD64/Full/Installation&printable=yes "Printable version of this page [p]")]{#t-print}
    -   [[Permanent
        link](/index.php?title=Handbook:AMD64/Full/Installation&oldid=229552 "Permanent link to this revision of the page")]{#t-permalink}
    -   [[Page
        information](/index.php?title=Handbook:AMD64/Full/Installation&action=info "More information about this page")]{#t-info}
    -   [[Browse
        properties](/wiki/Special:Browse/:Handbook:AMD64-2FFull-2FInstallation)]{#t-smwbrowselink}
-   [[]{.fa .fa-user aria-label="Personal tools"} User
    []{.caret}](#){.dropdown-toggle}
    -   [[Create
        account](/index.php?title=Special:CreateAccount&returnto=Handbook%3AAMD64%2FFull%2FInstallation "You are encouraged to create an account and log in; however, it is not mandatory")]{#pt-createaccount}
    -   [[Log
        in](/index.php?title=Special:UserLogin&returnto=Handbook%3AAMD64%2FFull%2FInstallation "You are encouraged to log in; however, it is not mandatory [o]")]{#pt-login}
:::
:::
:::

::: {.container}
::: {.row}
::: {.navbar-header}
[Toggle navigation]{.sr-only} []{.icon-bar} []{.icon-bar} []{.icon-bar}
:::

::: {#gw-toolbar .collapse .navbar-collapse}
-   [[Handbook](/wiki/Handbook:AMD64/Full/Installation)]{#ca-nstab-handbook}
-   [[Discussion](/wiki/Handbook_Talk:AMD64/Full/Installation "Discussion about the content page [t]")]{#ca-talk}

::: {.input-group}
::: {.input-group-btn}
:::
:::

-   [[View
    source](/index.php?title=Handbook:AMD64/Full/Installation&action=edit "This page is protected.
    You can view its source [e]")]{#ca-viewsource}
-   [more []{.caret}](#){.dropdown-toggle}
    -   [[History](/index.php?title=Handbook:AMD64/Full/Installation&action=history "Past revisions of this page [h]")]{#ca-history}
:::
:::
:::

::: {.container}
::: {.row}
::: {.col-md-12}
::: {#content .mw-body role="main"}
[]{#top}

[Gentoo Linux amd64 Handbook: Installing Gentoo]{dir="auto"} {#firstHeading .first-header lang="en"}
============================================================

::: {#bodyContent .mw-body-content}
::: {#siteSub}
From Gentoo Wiki
:::

::: {#contentSub}
[\<
[Handbook:AMD64](/wiki/Special:MyLanguage/Handbook:AMD64 "Special:MyLanguage/Handbook:AMD64")â€Ž
\|
[Full](/wiki/Special:MyLanguage/Handbook:AMD64/Full "Special:MyLanguage/Handbook:AMD64/Full")]{.subpages}
:::

::: {#jump-to-nav .mw-jump}
Jump to: [navigation](#column-one), [search](#searchInput)
:::

::: {#mw-content-text .mw-content-ltr lang="en" dir="ltr"}
::: {.mw-parser-output}
::: {#toc .toc}
::: {.toctitle lang="en" dir="ltr"}
Contents
--------
:::

-   [[1]{.tocnumber} [Introduction]{.toctext}](#Introduction)
    -   [[1.1]{.tocnumber} [Welcome]{.toctext}](#Welcome)
    -   [[1.2]{.tocnumber} [How the installation is
        structured]{.toctext}](#How_the_installation_is_structured)
    -   [[1.3]{.tocnumber} [Installation options for
        Gentoo]{.toctext}](#Installation_options_for_Gentoo)
    -   [[1.4]{.tocnumber} [Troubles]{.toctext}](#Troubles)
-   [[2]{.tocnumber} [Hardware
    requirements]{.toctext}](#Hardware_requirements)
-   [[3]{.tocnumber} [Gentoo Linux installation
    media]{.toctext}](#Gentoo_Linux_installation_media)
    -   [[3.1]{.tocnumber} [Minimal installation
        CD]{.toctext}](#Minimal_installation_CD)
    -   [[3.2]{.tocnumber} [The occasional Gentoo
        LiveDVD]{.toctext}](#The_occasional_Gentoo_LiveDVD)
    -   [[3.3]{.tocnumber} [What are stages
        then?]{.toctext}](#What_are_stages_then.3F)
-   [[4]{.tocnumber} [Downloading]{.toctext}](#Downloading)
    -   [[4.1]{.tocnumber} [Obtain the
        media]{.toctext}](#Obtain_the_media)
    -   [[4.2]{.tocnumber} [Verifying the downloaded
        files]{.toctext}](#Verifying_the_downloaded_files)
        -   [[4.2.1]{.tocnumber} [Microsoft Windows based
            verification]{.toctext}](#Microsoft_Windows_based_verification)
        -   [[4.2.2]{.tocnumber} [Linux based
            verification]{.toctext}](#Linux_based_verification)
    -   [[4.3]{.tocnumber} [Burning a disk]{.toctext}](#Burning_a_disk)
        -   [[4.3.1]{.tocnumber} [Burning with Microsoft
            Windows]{.toctext}](#Burning_with_Microsoft_Windows)
            -   [[4.3.1.1]{.tocnumber} [Prior to Windows
                7]{.toctext}](#Prior_to_Windows_7)
            -   [[4.3.1.2]{.tocnumber} [Windows 7 and
                above]{.toctext}](#Windows_7_and_above)
        -   [[4.3.2]{.tocnumber} [Burning with
            Linux]{.toctext}](#Burning_with_Linux)
-   [[5]{.tocnumber} [Booting]{.toctext}](#Booting)
    -   [[5.1]{.tocnumber} [Booting the installation
        media]{.toctext}](#Booting_the_installation_media)
        -   [[5.1.1]{.tocnumber} [Kernel
            choices]{.toctext}](#Kernel_choices)
        -   [[5.1.2]{.tocnumber} [Hardware
            options]{.toctext}](#Hardware_options)
        -   [[5.1.3]{.tocnumber} [Logical volume/device
            management]{.toctext}](#Logical_volume.2Fdevice_management)
        -   [[5.1.4]{.tocnumber} [Other
            options]{.toctext}](#Other_options)
    -   [[5.2]{.tocnumber} [Extra hardware
        configuration]{.toctext}](#Extra_hardware_configuration)
    -   [[5.3]{.tocnumber} [Optional: User
        accounts]{.toctext}](#Optional:_User_accounts)
    -   [[5.4]{.tocnumber} [Optional: Viewing documentation while
        installing]{.toctext}](#Optional:_Viewing_documentation_while_installing)
        -   [[5.4.1]{.tocnumber} [TTYs]{.toctext}](#TTYs)
        -   [[5.4.2]{.tocnumber} [GNU Screen]{.toctext}](#GNU_Screen)
    -   [[5.5]{.tocnumber} [Optional: Starting the SSH
        daemon]{.toctext}](#Optional:_Starting_the_SSH_daemon)
-   [[6]{.tocnumber} [Automatic network
    detection]{.toctext}](#Automatic_network_detection)
    -   [[6.1]{.tocnumber} [Determine interface
        names]{.toctext}](#Determine_interface_names)
        -   [[6.1.1]{.tocnumber} [ifconfig
            command]{.toctext}](#ifconfig_command)
        -   [[6.1.2]{.tocnumber} [ip command]{.toctext}](#ip_command)
    -   [[6.2]{.tocnumber} [Optional: Configure any
        proxies]{.toctext}](#Optional:_Configure_any_proxies)
    -   [[6.3]{.tocnumber} [Testing the
        network]{.toctext}](#Testing_the_network)
-   [[7]{.tocnumber} [Automatic network
    configuration]{.toctext}](#Automatic_network_configuration)
    -   [[7.1]{.tocnumber} [Default: Using
        net-setup]{.toctext}](#Default:_Using_net-setup)
    -   [[7.2]{.tocnumber} [Alternative: Using
        PPP]{.toctext}](#Alternative:_Using_PPP)
    -   [[7.3]{.tocnumber} [Alternative: Using
        PPTP]{.toctext}](#Alternative:_Using_PPTP)
-   [[8]{.tocnumber} [Manual network
    configuration]{.toctext}](#Manual_network_configuration)
    -   [[8.1]{.tocnumber} [Loading the appropriate network
        modules]{.toctext}](#Loading_the_appropriate_network_modules)
    -   [[8.2]{.tocnumber} [Using DHCP]{.toctext}](#Using_DHCP)
    -   [[8.3]{.tocnumber} [Preparing for wireless
        access]{.toctext}](#Preparing_for_wireless_access)
    -   [[8.4]{.tocnumber} [Understanding network
        terminology]{.toctext}](#Understanding_network_terminology)
    -   [[8.5]{.tocnumber} [Using ifconfig and
        route]{.toctext}](#Using_ifconfig_and_route)
-   [[9]{.tocnumber} [Introduction to block
    devices]{.toctext}](#Introduction_to_block_devices)
    -   [[9.1]{.tocnumber} [Block devices]{.toctext}](#Block_devices)
    -   [[9.2]{.tocnumber} [Partition
        tables]{.toctext}](#Partition_tables)
        -   [[9.2.1]{.tocnumber} [MBR]{.toctext}](#MBR)
        -   [[9.2.2]{.tocnumber} [GPT]{.toctext}](#GPT)
    -   [[9.3]{.tocnumber} [GPT or MBR]{.toctext}](#GPT_or_MBR)
        -   [[9.3.1]{.tocnumber} [Using UEFI]{.toctext}](#Using_UEFI)
    -   [[9.4]{.tocnumber} [Advanced
        storage]{.toctext}](#Advanced_storage)
        -   [[9.4.1]{.tocnumber} [Btrfs RAID]{.toctext}](#Btrfs_RAID)
        -   [[9.4.2]{.tocnumber} [LVM]{.toctext}](#LVM)
    -   [[9.5]{.tocnumber} [Default partitioning
        scheme]{.toctext}](#Default_partitioning_scheme)
-   [[10]{.tocnumber} [Designing a partition
    scheme]{.toctext}](#Designing_a_partition_scheme)
    -   [[10.1]{.tocnumber} [How many partitions and how
        big?]{.toctext}](#How_many_partitions_and_how_big.3F)
    -   [[10.2]{.tocnumber} [What about swap
        space?]{.toctext}](#What_about_swap_space.3F)
    -   [[10.3]{.tocnumber} [What is the BIOS boot
        partition?]{.toctext}](#What_is_the_BIOS_boot_partition.3F)
-   [[11]{.tocnumber} [Default: Using parted to partition the
    disk]{.toctext}](#Default:_Using_parted_to_partition_the_disk)
    -   [[11.1]{.tocnumber} [Viewing the current partition layout with
        parted]{.toctext}](#Viewing_the_current_partition_layout_with_parted)
    -   [[11.2]{.tocnumber} [Setting the GPT
        label]{.toctext}](#Setting_the_GPT_label)
    -   [[11.3]{.tocnumber} [Removing all partitions with
        parted]{.toctext}](#Removing_all_partitions_with_parted)
    -   [[11.4]{.tocnumber} [Creating the
        partitions]{.toctext}](#Creating_the_partitions)
-   [[12]{.tocnumber} [Alternative: Using fdisk to partition the
    disk]{.toctext}](#Alternative:_Using_fdisk_to_partition_the_disk)
    -   [[12.1]{.tocnumber} [Viewing the current partition
        layout]{.toctext}](#Viewing_the_current_partition_layout)
    -   [[12.2]{.tocnumber} [Removing all partitions with
        fdisk]{.toctext}](#Removing_all_partitions_with_fdisk)
    -   [[12.3]{.tocnumber} [Creating the BIOS boot
        partition]{.toctext}](#Creating_the_BIOS_boot_partition)
    -   [[12.4]{.tocnumber} [Creating the boot
        partition]{.toctext}](#Creating_the_boot_partition)
    -   [[12.5]{.tocnumber} [Creating the swap
        partition]{.toctext}](#Creating_the_swap_partition)
    -   [[12.6]{.tocnumber} [Creating the root
        partition]{.toctext}](#Creating_the_root_partition)
    -   [[12.7]{.tocnumber} [Saving the partition
        layout]{.toctext}](#Saving_the_partition_layout)
-   [[13]{.tocnumber} [Creating file
    systems]{.toctext}](#Creating_file_systems)
    -   [[13.1]{.tocnumber} [Introduction]{.toctext}](#Introduction_2)
    -   [[13.2]{.tocnumber} [Filesystems]{.toctext}](#Filesystems)
    -   [[13.3]{.tocnumber} [Applying a filesystem to a
        partition]{.toctext}](#Applying_a_filesystem_to_a_partition)
    -   [[13.4]{.tocnumber} [Activating the swap
        partition]{.toctext}](#Activating_the_swap_partition)
-   [[14]{.tocnumber} [Mounting the root
    partition]{.toctext}](#Mounting_the_root_partition)
-   [[15]{.tocnumber} [Installing a stage
    tarball]{.toctext}](#Installing_a_stage_tarball)
    -   [[15.1]{.tocnumber} [Setting the date and
        time]{.toctext}](#Setting_the_date_and_time)
        -   [[15.1.1]{.tocnumber} [Automatic]{.toctext}](#Automatic)
        -   [[15.1.2]{.tocnumber} [Manual]{.toctext}](#Manual)
    -   [[15.2]{.tocnumber} [Choosing a stage
        tarball]{.toctext}](#Choosing_a_stage_tarball)
        -   [[15.2.1]{.tocnumber} [Multilib (32 and
            64-bit)]{.toctext}](#Multilib_.2832_and_64-bit.29)
        -   [[15.2.2]{.tocnumber} [No-multilib (pure
            64-bit)]{.toctext}](#No-multilib_.28pure_64-bit.29)
    -   [[15.3]{.tocnumber} [Downloading the stage
        tarball]{.toctext}](#Downloading_the_stage_tarball)
        -   [[15.3.1]{.tocnumber} [Graphical
            browsers]{.toctext}](#Graphical_browsers)
        -   [[15.3.2]{.tocnumber} [Command-line
            browsers]{.toctext}](#Command-line_browsers)
        -   [[15.3.3]{.tocnumber} [Verifying and
            validating]{.toctext}](#Verifying_and_validating)
    -   [[15.4]{.tocnumber} [Unpacking the stage
        tarball]{.toctext}](#Unpacking_the_stage_tarball)
-   [[16]{.tocnumber} [Configuring compile
    options]{.toctext}](#Configuring_compile_options)
    -   [[16.1]{.tocnumber} [Introduction]{.toctext}](#Introduction_3)
    -   [[16.2]{.tocnumber} [CFLAGS and
        CXXFLAGS]{.toctext}](#CFLAGS_and_CXXFLAGS)
    -   [[16.3]{.tocnumber} [MAKEOPTS]{.toctext}](#MAKEOPTS)
    -   [[16.4]{.tocnumber} [Ready, set,
        go!]{.toctext}](#Ready.2C_set.2C_go.21)
-   [[17]{.tocnumber} [Chrooting]{.toctext}](#Chrooting)
    -   [[17.1]{.tocnumber} [Optional: Selecting
        mirrors]{.toctext}](#Optional:_Selecting_mirrors)
        -   [[17.1.1]{.tocnumber} [Distribution
            files]{.toctext}](#Distribution_files)
        -   [[17.1.2]{.tocnumber} [Gentoo ebuild
            repository]{.toctext}](#Gentoo_ebuild_repository)
    -   [[17.2]{.tocnumber} [Copy DNS info]{.toctext}](#Copy_DNS_info)
    -   [[17.3]{.tocnumber} [Mounting the necessary
        filesystems]{.toctext}](#Mounting_the_necessary_filesystems)
    -   [[17.4]{.tocnumber} [Entering the new
        environment]{.toctext}](#Entering_the_new_environment)
    -   [[17.5]{.tocnumber} [Mounting the boot
        partition]{.toctext}](#Mounting_the_boot_partition)
-   [[18]{.tocnumber} [Configuring
    Portage]{.toctext}](#Configuring_Portage)
    -   [[18.1]{.tocnumber} [Installing an ebuild repository snapshot
        from the
        web]{.toctext}](#Installing_an_ebuild_repository_snapshot_from_the_web)
    -   [[18.2]{.tocnumber} [Optional: Updating the Gentoo ebuild
        repository]{.toctext}](#Optional:_Updating_the_Gentoo_ebuild_repository)
    -   [[18.3]{.tocnumber} [Reading news
        items]{.toctext}](#Reading_news_items)
    -   [[18.4]{.tocnumber} [Choosing the right
        profile]{.toctext}](#Choosing_the_right_profile)
        -   [[18.4.1]{.tocnumber} [No-multilib]{.toctext}](#No-multilib)
        -   [[18.4.2]{.tocnumber} [systemd]{.toctext}](#systemd)
    -   [[18.5]{.tocnumber} [Updating the \@world
        set]{.toctext}](#Updating_the_.40world_set)
    -   [[18.6]{.tocnumber} [Configuring the USE
        variable]{.toctext}](#Configuring_the_USE_variable)
    -   [[18.7]{.tocnumber} [Optional: Configuring the ACCEPT\_LICENSE
        variable]{.toctext}](#Optional:_Configuring_the_ACCEPT_LICENSE_variable)
-   [[19]{.tocnumber} [Optional: Using systemd as the init
    system]{.toctext}](#Optional:_Using_systemd_as_the_init_system)
-   [[20]{.tocnumber} [Timezone]{.toctext}](#Timezone)
-   [[21]{.tocnumber} [Configure locales]{.toctext}](#Configure_locales)
-   [[22]{.tocnumber} [Installing the
    sources]{.toctext}](#Installing_the_sources)
-   [[23]{.tocnumber} [Default: Manual
    configuration]{.toctext}](#Default:_Manual_configuration)
    -   [[23.1]{.tocnumber} [Introduction]{.toctext}](#Introduction_4)
    -   [[23.2]{.tocnumber} [Activating required
        options]{.toctext}](#Activating_required_options)
    -   [[23.3]{.tocnumber} [Architecture specific kernel
        configuration]{.toctext}](#Architecture_specific_kernel_configuration)
    -   [[23.4]{.tocnumber} [Compiling and
        installing]{.toctext}](#Compiling_and_installing)
    -   [[23.5]{.tocnumber} [Optional: Building an
        initramfs]{.toctext}](#Optional:_Building_an_initramfs)
-   [[24]{.tocnumber} [Alternative: Using
    genkernel]{.toctext}](#Alternative:_Using_genkernel)
-   [[25]{.tocnumber} [Kernel modules]{.toctext}](#Kernel_modules)
    -   [[25.1]{.tocnumber} [Configuring the
        modules]{.toctext}](#Configuring_the_modules)
    -   [[25.2]{.tocnumber} [Optional: Installing
        firmware]{.toctext}](#Optional:_Installing_firmware)
-   [[26]{.tocnumber} [Filesystem
    information]{.toctext}](#Filesystem_information)
    -   [[26.1]{.tocnumber} [About fstab]{.toctext}](#About_fstab)
    -   [[26.2]{.tocnumber} [Creating the fstab
        file]{.toctext}](#Creating_the_fstab_file)
        -   [[26.2.1]{.tocnumber} [Filesystem labels and
            UUIDs]{.toctext}](#Filesystem_labels_and_UUIDs)
        -   [[26.2.2]{.tocnumber} [Partition labels and
            UUIDs]{.toctext}](#Partition_labels_and_UUIDs)
-   [[27]{.tocnumber} [Networking
    information]{.toctext}](#Networking_information)
    -   [[27.1]{.tocnumber} [Host and domain
        information]{.toctext}](#Host_and_domain_information)
    -   [[27.2]{.tocnumber} [Configuring the
        network]{.toctext}](#Configuring_the_network)
    -   [[27.3]{.tocnumber} [Automatically start networking at
        boot]{.toctext}](#Automatically_start_networking_at_boot)
    -   [[27.4]{.tocnumber} [The hosts file]{.toctext}](#The_hosts_file)
    -   [[27.5]{.tocnumber} [Optional: Get PCMCIA
        working]{.toctext}](#Optional:_Get_PCMCIA_working)
-   [[28]{.tocnumber} [System
    information]{.toctext}](#System_information)
    -   [[28.1]{.tocnumber} [Root password]{.toctext}](#Root_password)
    -   [[28.2]{.tocnumber} [Init and boot
        configuration]{.toctext}](#Init_and_boot_configuration)
-   [[29]{.tocnumber} [System logger]{.toctext}](#System_logger)
-   [[30]{.tocnumber} [Optional: Cron
    daemon]{.toctext}](#Optional:_Cron_daemon)
-   [[31]{.tocnumber} [Optional: File
    indexing]{.toctext}](#Optional:_File_indexing)
-   [[32]{.tocnumber} [Optional: Remote
    access]{.toctext}](#Optional:_Remote_access)
-   [[33]{.tocnumber} [Filesystem tools]{.toctext}](#Filesystem_tools)
-   [[34]{.tocnumber} [Networking tools]{.toctext}](#Networking_tools)
    -   [[34.1]{.tocnumber} [Installing a DHCP
        client]{.toctext}](#Installing_a_DHCP_client)
    -   [[34.2]{.tocnumber} [Optional: Installing a PPPoE
        client]{.toctext}](#Optional:_Installing_a_PPPoE_client)
    -   [[34.3]{.tocnumber} [Optional: Install wireless networking
        tools]{.toctext}](#Optional:_Install_wireless_networking_tools)
-   [[35]{.tocnumber} [Selecting a boot
    loader]{.toctext}](#Selecting_a_boot_loader)
-   [[36]{.tocnumber} [Default: GRUB2]{.toctext}](#Default:_GRUB2)
    -   [[36.1]{.tocnumber} [Emerge]{.toctext}](#Emerge)
    -   [[36.2]{.tocnumber} [Install]{.toctext}](#Install)
    -   [[36.3]{.tocnumber} [Configure]{.toctext}](#Configure)
-   [[37]{.tocnumber} [Alternative 1:
    LILO]{.toctext}](#Alternative_1:_LILO)
    -   [[37.1]{.tocnumber} [Emerge]{.toctext}](#Emerge_2)
    -   [[37.2]{.tocnumber} [Configure]{.toctext}](#Configure_2)
    -   [[37.3]{.tocnumber} [Install]{.toctext}](#Install_2)
-   [[38]{.tocnumber} [Alternative 2:
    efibootmgr]{.toctext}](#Alternative_2:_efibootmgr)
-   [[39]{.tocnumber} [Alternative 3:
    Syslinux]{.toctext}](#Alternative_3:_Syslinux)
-   [[40]{.tocnumber} [Rebooting the
    system]{.toctext}](#Rebooting_the_system)
-   [[41]{.tocnumber} [User
    administration]{.toctext}](#User_administration)
    -   [[41.1]{.tocnumber} [Adding a user for daily
        use]{.toctext}](#Adding_a_user_for_daily_use)
-   [[42]{.tocnumber} [Disk cleanup]{.toctext}](#Disk_cleanup)
    -   [[42.1]{.tocnumber} [Removing
        tarballs]{.toctext}](#Removing_tarballs)
-   [[43]{.tocnumber} [Where to go from
    here]{.toctext}](#Where_to_go_from_here)
    -   [[43.1]{.tocnumber} [Documentation]{.toctext}](#Documentation)
    -   [[43.2]{.tocnumber} [Gentoo online]{.toctext}](#Gentoo_online)
        -   [[43.2.1]{.tocnumber} [Forums and
            IRC]{.toctext}](#Forums_and_IRC)
        -   [[43.2.2]{.tocnumber} [Mailing
            lists]{.toctext}](#Mailing_lists)
        -   [[43.2.3]{.tocnumber} [Bugs]{.toctext}](#Bugs)
        -   [[43.2.4]{.tocnumber} [Development
            guide]{.toctext}](#Development_guide)
    -   [[43.3]{.tocnumber} [Closing
        thoughts]{.toctext}](#Closing_thoughts)
:::

\

\

[Introduction]{#Introduction .mw-headline}
------------------------------------------

### [Welcome]{#Welcome .mw-headline}

First of all, welcome to Gentoo! You are about to enter the world of
choices and performance. Gentoo is all about choices. When installing
Gentoo, this is made clear several times - users can choose how much
they want to compile themselves, how to install Gentoo, what system
logger to use, etc.

Gentoo is a fast, modern meta-distribution with a clean and flexible
design. It is built on an ecosystem of free software and does not hide
what is beneath the hood from its users. Portage, the package
maintenance system which Gentoo uses, is written in Python, meaning the
user can easily view and modify the source code. Gentoo\'s packaging
system uses source code (although support for pre-compiled packages is
included too) and configuring Gentoo happens through regular text files.
In other words, openness everywhere.

It is very important that everyone understands that choices are what
makes Gentoo run. We try not to force users into anything they do not
like. If anyone believes otherwise, please [bug
report](https://bugs.gentoo.org){.external .text} it.

### [How the installation is structured]{#How_the_installation_is_structured .mw-headline}

The Gentoo Installation can be seen as a 10-step procedure,
corresponding to the next set of chapters. Each step results in a
certain state:

  Step   Result
  ------ ----------------------------------------------------------------------------------------------------
  1      The user is in a working environment ready to install Gentoo.
  2      The Internet connection is ready to install Gentoo.
  3      The hard disks are initialized to host the Gentoo installation.
  4      The installation environment is prepared and the user is ready to chroot into the new environment.
  5      Core packages, which are the same on all Gentoo installations, are installed.
  6      The Linux kernel is installed.
  7      The user will have configured most of the Gentoo system configuration files.
  8      The necessary system tools are installed.
  9      The proper boot loader has been installed and configured.
  10     The freshly installed Gentoo Linux environment is ready to be explored.

Whenever a certain choice is presented the handbook will try to explain
the pros and cons of each choice. Although the text then continues with
a default choice (identified by \"Default: \" in the title), the other
possibilities will be documented as well (marked by \"Alternative: \" in
the title). Do not think that the default is what Gentoo recommends. It
is however what Gentoo believes most users will use.

Sometimes an optional step can be followed. Such steps are marked as
\"Optional: \" and are therefore not needed to install Gentoo. However,
some optional steps are dependent on a previously made decision. The
instructions will inform the reader when this happens, both when the
decision is made, and right before the optional step is described.

### [Installation options for Gentoo]{#Installation_options_for_Gentoo .mw-headline}

Gentoo can be installed in many different ways. It can be downloaded and
installed from official Gentoo installation media such as our CDs and
DVDs. The installation media can be installed on a USB stick or accessed
via a netbooted environment. Alternatively, Gentoo can be installed from
non-official media such as an already installed distribution or a
non-Gentoo bootable disk (such as Knoppix).

This document covers the installation using official Gentoo Installation
media or, in certain cases, netbooting.

::: {.alert .alert-info .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Note**\
For help on the other installation approaches, including using
non-Gentoo CDs, please read our [Alternative installation
guide](/wiki/Installation_alternatives "Installation alternatives").
:::

We also provide a [Gentoo installation tips and
tricks](/wiki/Gentoo_installation_tips_and_tricks "Gentoo installation tips and tricks")
document that might be useful to read as well.

### [Troubles]{#Troubles .mw-headline}

If a problem is found in the installation (or in the installation
documentation), please visit our [bug tracking
system](https://bugs.gentoo.org){.external .text} and check if the bug
is known. If not, please create a bug report for it so we can take care
of it. Do not be afraid of the developers who are assigned to the bugs -
they (generally) don\'t eat people.

Note though that, although this document is architecture-specific, it
might contain references to other architectures as well. This is due to
the fact that large parts of the Gentoo Handbook use installation source
text that is shared for all architectures (to avoid duplication of
efforts and starvation of development resources). We will try to keep
this to a minimum to avoid confusion.

If there is some uncertainty whether or not the problem is a
user-problem (some error made despite having read the documentation
carefully) or a software-problem (some error we made despite having
tested the installation/documentation carefully) everybody is welcome to
join the [[\#gentoo](irc://irc.gentoo.org/gentoo){.external
.text}]{style="font-family: monospace; font-size: 95%;"} channel on
irc.freenode.net. Of course, everyone is welcome otherwise too as our
chat channel covers the broad Gentoo spectrum.

Speaking of which, if there are any additional questions regarding
Gentoo, check out the [Frequently Asked Questions](/wiki/FAQ "FAQ")
article. There are also
[FAQs](https://forums.gentoo.org/viewforum.php?f=40){.external .text} on
the [Gentoo Forums](https://forums.gentoo.org){.external .text}.

\

\

\

\

\

[Hardware requirements]{#Hardware_requirements .mw-headline}
------------------------------------------------------------

Before we start, we first list what hardware requirements are needed to
successfully install Gentoo on a amd64 box.

\

AMD64 livedisk hardware requirements
:::
:::
:::
:::
:::
:::
:::

Minimal CD

LiveDVD

CPU

Any AMD64 CPU or
[EM64T](https://en.wikipedia.org/wiki/X86-64#Intel_64 "wikipedia:X86-64"){.extiw}
CPU (Core i3, i5, and i7 are EM64T)

Memory

256 MB

512 MB

Disk space

2.5 GB (excluding swap space)

Swap space

At least 256 MB

The [AMD64 project](/wiki/Project:AMD64 "Project:AMD64") is a good place
to be for more information about Gentoo\'s
**[amd64]{style="font-family: monospace; font-size: 95%; color: #54487a"}**
support.

\

[Gentoo Linux installation media]{#Gentoo_Linux_installation_media .mw-headline}
--------------------------------------------------------------------------------

### [Minimal installation CD]{#Minimal_installation_CD .mw-headline}

::: {.alert .alert-info .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Note**\
As of **August 23, 2018** the official Minimal CDs are **capable** of
booting in UEFI mode. Previous versions boot in BIOS (MBR) mode only.
Readers looking to make their system UEFI bootable must download the
latest ISO.
:::

The Gentoo minimal installation CD is a bootable image which contains a
self-sustained Gentoo environment. It allows the user to boot Linux from
the CD or other installation media. During the boot process the hardware
is detected and the appropriate drivers are loaded. The image is
maintained by Gentoo developers and allows anyone to install Gentoo if
an active Internet connection is available.

The Minimal Installation CD is called
[install-amd64-minimal-\<release\>.iso]{style="font-family: monospace; font-size: 95%"}.

### [The occasional Gentoo LiveDVD]{#The_occasional_Gentoo_LiveDVD .mw-headline}

Occasionally, a special DVD is crafted by the Gentoo Ten project which
can be used to install Gentoo. The instructions further down this
chapter target the Minimal Installation CD so might be a bit different.
However, the LiveDVD (or any other bootable Linux environment) supports
getting a root prompt by just invoking [sudo su
-]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} or
[sudo -i]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} in a
terminal.

### []{#What_are_stages_then?}[What are stages then?]{#What_are_stages_then.3F .mw-headline}

A stage3 tarball is an archive containing a minimal Gentoo environment,
suitable to continue the Gentoo installation using the instructions in
this manual. Previously, the Gentoo Handbook described the installation
using one of three [stage
tarballs](/wiki/Stage_tarball "Stage tarball"). While Gentoo still
offers stage1 and stage2 tarballs, the official installation method uses
the stage3 tarball. If you are interested in performing a Gentoo
installation using a stage1 or stage2 tarball, please read the Gentoo
FAQ on [How do I install Gentoo using a stage1 or stage2
tarball](/wiki/FAQ#How_do_I_install_Gentoo_using_a_stage1_or_stage2_tarball.3F "FAQ")?

Stage3 tarballs can be downloaded from
[releases/amd64/autobuilds/]{style="font-family: monospace; font-size: 95%"}
on any of the [official Gentoo
mirrors](https://www.gentoo.org/downloads/mirrors/){.external .text}.
Stage files update frequently and are not included on the installation
images.

[Downloading]{#Downloading .mw-headline}
----------------------------------------

### [Obtain the media]{#Obtain_the_media .mw-headline}

The default installation media that Gentoo Linux uses are the *minimal
installation CDs*, which host a bootable, very small Gentoo Linux
environment. This environment contains all the right tools to install
Gentoo. The CD images themselves can be downloaded from the [downloads
page](https://www.gentoo.org/downloads/){.external .text} (recommended)
or by manually browsing to the ISO location on one of the many
[available mirrors](https://www.gentoo.org/downloads/mirrors/){.external
.text}.

If downloading from a mirror, the minimal installation CDs can be found
as follows:

1.  Go to the
    [releases/]{style="font-family: monospace; font-size: 95%"}
    directory.
2.  Select the directory for the relevant target architecture (such as
    **[amd64/]{style="font-family: monospace; font-size: 95%; color: #54487a"}**).
3.  Select the
    [autobuilds/]{style="font-family: monospace; font-size: 95%"}
    directory.
4.  For
    **[amd64]{style="font-family: monospace; font-size: 95%; color: #54487a"}**
    and
    **[x86]{style="font-family: monospace; font-size: 95%; color: #54487a"}**
    architectures select either the
    [current-install-amd64-minimal/]{style="font-family: monospace; font-size: 95%"}
    or
    [current-install-x86-minimal/]{style="font-family: monospace; font-size: 95%"}
    directory (respectively). For all other architectures navigate to
    the [current-iso/]{style="font-family: monospace; font-size: 95%"}
    directory.

::: {.alert .alert-info .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Note**\
Some target architectures such as
**[arm]{style="font-family: monospace; font-size: 95%; color: #54487a"}**,
**[mips]{style="font-family: monospace; font-size: 95%; color: #54487a"}**,
and
**[s390]{style="font-family: monospace; font-size: 95%; color: #54487a"}**
will not have minimal install CDs. At this time the [Gentoo Release
Engineering project](/wiki/Project:RelEng "Project:RelEng") does not
support building [.iso]{style="font-family: monospace; font-size: 95%"}
files for these targets.
:::

Inside this location, the installation media file is the file with the
[.iso]{style="font-family: monospace; font-size: 95%"} suffix. For
instance, take a look at the following listing:

::: {.gw-box}
::: {.box-caption}
[CODE]{.label style="margin-right: .5em; background-color: #204A87"}
**Example list of downloadable files at
releases/amd64/autobuilds/current-iso/**
:::

``` {.captioned}
[DIR] hardened/                                          05-Dec-2014 01:42    -   
[   ] install-amd64-minimal-20141204.iso                 04-Dec-2014 21:04  208M  
[   ] install-amd64-minimal-20141204.iso.CONTENTS        04-Dec-2014 21:04  3.0K  
[   ] install-amd64-minimal-20141204.iso.DIGESTS         04-Dec-2014 21:04  740   
[TXT] install-amd64-minimal-20141204.iso.DIGESTS.asc     05-Dec-2014 01:42  1.6K  
[   ] stage3-amd64-20141204.tar.bz2                      04-Dec-2014 21:04  198M  
[   ] stage3-amd64-20141204.tar.bz2.CONTENTS             04-Dec-2014 21:04  4.6M  
[   ] stage3-amd64-20141204.tar.bz2.DIGESTS              04-Dec-2014 21:04  720   
[TXT] stage3-amd64-20141204.tar.bz2.DIGESTS.asc          05-Dec-2014 01:42  1.5K
```
:::

In the above example, the
[install-amd64-minimal-20141204.iso]{style="font-family: monospace; font-size: 95%"}
file is the minimal installation CD itself. But as can be seen, other
related files exist as well:

-   A [.CONTENTS]{style="font-family: monospace; font-size: 95%"} file
    which is a text file listing all files available on the installation
    media. This file can be useful to verify if particular firmware or
    drivers are available on the installation media before downloading
    it.
-   A [.DIGESTS]{style="font-family: monospace; font-size: 95%"} file
    which contains the hash of the ISO file itself, in various hashing
    formats/algorithms. This file can be used to verify if the
    downloaded ISO file is corrupt or not.
-   A [.DIGESTS.asc]{style="font-family: monospace; font-size: 95%"}
    file which not only contains the hash of the ISO file (like the
    [.DIGESTS]{style="font-family: monospace; font-size: 95%"} file),
    but also a cryptographic signature of that file. This can be used to
    both verify if the downloaded ISO file is corrupt or not, as well as
    verify that the download is indeed provided by the Gentoo Release
    Engineering team and has not been tampered with.

Ignore the other files available at this location for now - those will
come back when the installation has proceeded further. Download the
[.iso]{style="font-family: monospace; font-size: 95%"} file and, if
verification of the download is wanted, download the
[.DIGESTS.asc]{style="font-family: monospace; font-size: 95%"} file for
the [.iso]{style="font-family: monospace; font-size: 95%"} file as well.
The [.CONTENTS]{style="font-family: monospace; font-size: 95%"} file
does not need to be downloaded as the installation instructions will not
refer to this file anymore, and the
[.DIGESTS]{style="font-family: monospace; font-size: 95%"} file should
contain the same information as the
[.DIGESTS.asc]{style="font-family: monospace; font-size: 95%"} file,
except that the latter also contains a signature on top of it.

### [Verifying the downloaded files]{#Verifying_the_downloaded_files .mw-headline}

::: {.alert .alert-info .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Note**\
This is an optional step and not necessary to install Gentoo Linux.
However, it is recommended as it ensures that the downloaded file is not
corrupt and has indeed been provided by the Gentoo Infrastructure team.
:::

Through the [.DIGESTS]{style="font-family: monospace; font-size: 95%"}
and [.DIGESTS.asc]{style="font-family: monospace; font-size: 95%"}
files, the validity of the ISO file can be confirmed using the right set
of tools. This verification is usually done in two steps:

1.  First, the cryptographic signature is validated to make sure that
    the installation file is provided by the Gentoo Release Engineering
    team
2.  If the cryptographic signature validates, then the checksum is
    verified to make sure that the downloaded file itself is not
    corrupted

#### [Microsoft Windows based verification]{#Microsoft_Windows_based_verification .mw-headline}

On a Microsoft Windows system, chances are low that the right set of
tools to verify checksums and cryptographic signatures are in place.

To first verify the cryptographic signature, tools such as
[GPG4Win](http://www.gpg4win.org/){.external .text} can be used. After
installation, the public keys of the Gentoo Release Engineering team
need to be imported. The list of keys is available on the [signatures
page](https://www.gentoo.org/downloads/signatures/){.external .text}.
Once imported, the user can then verify the signature of the
[.DIGESTS.asc]{style="font-family: monospace; font-size: 95%"} file.

::: {.alert .alert-warning .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Important**\
This does not verify that the
[.DIGESTS]{style="font-family: monospace; font-size: 95%"} file is
correct, only that the
[.DIGESTS.asc]{style="font-family: monospace; font-size: 95%"} file is.
That also implies that the checksum should be verified against the
values in the
[.DIGESTS.asc]{style="font-family: monospace; font-size: 95%"} file,
which is why the instructions above only refer to downloading the
[.DIGESTS.asc]{style="font-family: monospace; font-size: 95%"} file.
:::

The checksum itself can be verified using the [Hashcalc
application](https://www.slavasoft.com/hashcalc/){.external .text},
although many others exist as well. Most of the time, these tools will
show the user the calculated checksum, and the user is requested to
verify this checksum with the value that is inside the
[.DIGESTS.asc]{style="font-family: monospace; font-size: 95%"} file.

#### [Linux based verification]{#Linux_based_verification .mw-headline}

On a Linux system, the most common method for verifying the
cryptographic signature is to use the
[app-crypt/gnupg](https://packages.gentoo.org/packages/app-crypt/gnupg){.external
.text} software. With this package installed, the following commands can
be used to verify the cryptographic signature of the
[.DIGESTS.asc]{style="font-family: monospace; font-size: 95%"} file.

First, download the right set of keys as made available on the
[signatures
page](https://www.gentoo.org/downloads/signatures/){.external .text}:

::: {.cmd-box}
<div>

`user $`{style="color: #4E9A06; font-weight: bold;"}[]{.tripleclick-separator}`gpg --keyserver hkps://hkps.pool.sks-keyservers.net --recv-keys 0xBB572E0E2D182910`

</div>

    gpg: requesting key 0xBB572E0E2D182910 from hkp server pool.sks-keyservers.net
    gpg: key 0xBB572E0E2D182910: "Gentoo Linux Release Engineering (Automated Weekly Release Key) <releng@gentoo.org>" 1 new signature
    gpg: 3 marginal(s) needed, 1 complete(s) needed, classic trust model
    gpg: depth: 0  valid:   3  signed:  20  trust: 0-, 0q, 0n, 0m, 0f, 3u
    gpg: depth: 1  valid:  20  signed:  12  trust: 9-, 0q, 0n, 9m, 2f, 0u
    gpg: next trustdb check due at 2018-09-15
    gpg: Total number processed: 1
    gpg:         new signatures: 1
:::

Alternatively you can use instead the WKD to download the key:

::: {.cmd-box}
<div>

`user $`{style="color: #4E9A06; font-weight: bold;"}[]{.tripleclick-separator}`wget -O- https://gentoo.org/.well-known/openpgpkey/hu/wtktzo4gyuhzu8a4z5fdj3fgmr1u6tob?l=releng | gpg --import`

</div>

    --2019-04-19 20:46:32--  https://gentoo.org/.well-known/openpgpkey/hu/wtktzo4gyuhzu8a4z5fdj3fgmr1u6tob?l=releng
    Resolving gentoo.org (gentoo.org)... 89.16.167.134
    Connecting to gentoo.org (gentoo.org)|89.16.167.134|:443... connected.
    HTTP request sent, awaiting response... 200 OK
    Length: 35444 (35K) [application/octet-stream]
    Saving to: 'STDOUT'
     
         0K .......... .......... .......... ....                 100% 11.9M=0.003s
     
    2019-04-19 20:46:32 (11.9 MB/s) - written to stdout [35444/35444]
     
    gpg: key 9E6438C817072058: 84 signatures not checked due to missing keys
    gpg: /tmp/test2/trustdb.gpg: trustdb created
    gpg: key 9E6438C817072058: public key "Gentoo Linux Release Engineering (Gentoo Linux Release Signing Key) <releng@gentoo.org>" imported
    gpg: key BB572E0E2D182910: 12 signatures not checked due to missing keys
    gpg: key BB572E0E2D182910: 1 bad signature
    gpg: key BB572E0E2D182910: public key "Gentoo Linux Release Engineering (Automated Weekly Release Key) <releng@gentoo.org>" imported
    gpg: Total number processed: 2
    gpg:               imported: 2
    gpg: no ultimately trusted keys found
:::

Next verify the cryptographic signature of the
[.DIGESTS.asc]{style="font-family: monospace; font-size: 95%"} file:

::: {.cmd-box}
<div>

`user $`{style="color: #4E9A06; font-weight: bold;"}[]{.tripleclick-separator}`gpg --verify install-amd64-minimal-20141204.iso.DIGESTS.asc`

</div>

    gpg: Signature made Fri 05 Dec 2014 02:42:44 AM CET
    gpg:                using RSA key 0xBB572E0E2D182910
    gpg: Good signature from "Gentoo Linux Release Engineering (Automated Weekly Release Key) <releng@gentoo.org>" [unknown]
    gpg: WARNING: This key is not certified with a trusted signature!
    gpg:          There is no indication that the signature belongs to the owner.
    Primary key fingerprint: 13EB BDBE DE7A 1277 5DFD  B1BA BB57 2E0E 2D18 2910
:::

To be absolutely certain that everything is valid, verify the
fingerprint shown with the fingerprint on the [Gentoo signatures
page](https://www.gentoo.org/downloads/signatures/){.external .text}.

With the cryptographic signature validated, next verify the checksum to
make sure the downloaded ISO file is not corrupted. The
[.DIGESTS.asc]{style="font-family: monospace; font-size: 95%"} file
contains multiple hashing algorithms, so one of the methods to validate
the right one is to first look at the checksum registered in the
[.DIGESTS.asc]{style="font-family: monospace; font-size: 95%"} file. For
instance, to get the SHA512 checksum:

::: {.cmd-box}
<div>

`user $`{style="color: #4E9A06; font-weight: bold;"}[]{.tripleclick-separator}`grep -A 1 -i sha512 install-amd64-minimal-20141204.iso.DIGESTS.asc`

</div>

    # SHA512 HASH
    364d32c4f8420605f8a9fa3a0fc55864d5b0d1af11aa62b7a4d4699a427e5144b2d918225dfb7c5dec8d3f0fe2cddb7cc306da6f0cef4f01abec33eec74f3024  install-amd64-minimal-20141204.iso
    --
    # SHA512 HASH
    0719a8954dc7432750de2e3076c8b843a2c79f5e60defe43fcca8c32ab26681dfb9898b102e211174a895ff4c8c41ddd9e9a00ad6434d36c68d74bd02f19b57f  install-amd64-minimal-20141204.iso.CONTENTS
:::

In the above output, two SHA512 checksums are shown - one for the
[install-amd64-minimal-20141204.iso]{style="font-family: monospace; font-size: 95%"}
file and one for its accompanying
[.CONTENTS]{style="font-family: monospace; font-size: 95%"} file. Only
the first checksum is of interest, as it needs to be compared with the
calculated SHA512 checksum which can be generated as follows:

::: {.cmd-box}
<div>

`user $`{style="color: #4E9A06; font-weight: bold;"}[]{.tripleclick-separator}`sha512sum install-amd64-minimal-20141204.iso`

</div>

    364d32c4f8420605f8a9fa3a0fc55864d5b0d1af11aa62b7a4d4699a427e5144b2d918225dfb7c5dec8d3f0fe2cddb7cc306da6f0cef4f01abec33eec74f3024  install-amd64-minimal-20141204.iso
:::

As both checksums match, the file is not corrupted and the installation
can continue.

### [Burning a disk]{#Burning_a_disk .mw-headline}

Of course, with just an ISO file downloaded, the Gentoo Linux
installation cannot be started. The ISO file needs to be burned on a CD
to boot from, and in such a way that its *content* is burned on the CD,
not just the file itself. Below a few common methods are described - a
more elaborate set of instructions can be found in [Our FAQ on burning
an ISO file](/wiki/FAQ#How_do_I_burn_an_ISO_file.3F "FAQ").

#### [Burning with Microsoft Windows]{#Burning_with_Microsoft_Windows .mw-headline}

##### [Prior to Windows 7]{#Prior_to_Windows_7 .mw-headline}

On versions of Microsoft Windows prior to Windows 7, an ISO burning
utility will need to be installed in order to burn ISO files to optical
media. A number of tools exist to support this task; a couple notable
packages include:

-   With EasyCD Creator, select
    [File]{style="font-family: monospace; font-size: 95%"}, [Record CD
    from CD image]{style="font-family: monospace; font-size: 95%"}. Then
    change the [Files of
    type]{style="font-family: monospace; font-size: 95%"} to **ISO image
    file**. Then locate the ISO file and click
    [Open]{style="font-family: monospace; font-size: 95%"}. After
    clicking on [Start
    recording]{style="font-family: monospace; font-size: 95%"} the ISO
    image will be burned correctly onto the CD-R.
-   With Nero Burning ROM, cancel the wizard which automatically pops up
    and select [Burn
    Image]{style="font-family: monospace; font-size: 95%"} from the
    [File]{style="font-family: monospace; font-size: 95%"} menu. Select
    the image to burn and click
    [Open]{style="font-family: monospace; font-size: 95%"}. Now hit the
    [Burn]{style="font-family: monospace; font-size: 95%"} button and
    watch the brand new CD being burnt.

##### [Windows 7 and above]{#Windows_7_and_above .mw-headline}

Versions of Microsoft Windows 7 and above can both mount and burn ISO
images to optical media without the requirement for third-party
software. Simply insert a burnable disk, browse to the downloaded ISO
files, right click the file in Windows Explorer, and select \"Burn disk
image\".

#### [Burning with Linux]{#Burning_with_Linux .mw-headline}

On Linux, the ISO file can be burned on a CD using the
[cdrecord]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
utility, which is included in the
[app-cdr/cdrtools](https://packages.gentoo.org/packages/app-cdr/cdrtools){.external
.text} package.

For instance, to burn the ISO file on the CD in the
[/dev/sr0]{style="font-family: monospace; font-size: 95%"} device (this
is the first CD device on the system - substitute with the right device
file if necessary):

::: {.cmd-box}
<div>

`user $`{style="color: #4E9A06; font-weight: bold;"}[]{.tripleclick-separator}`cdrecord dev=/dev/sr0 install-amd64-minimal-20141204.iso`

</div>
:::

Users that prefer a graphical user interface can use K3B, part of the
[kde-apps/k3b](https://packages.gentoo.org/packages/kde-apps/k3b){.external
.text} package. In K3B, go to
[Tools]{style="font-family: monospace; font-size: 95%"} and use [Burn CD
Image]{style="font-family: monospace; font-size: 95%"}. Then follow the
instructions provided by K3B.

[Booting]{#Booting .mw-headline}
--------------------------------

### [Booting the installation media]{#Booting_the_installation_media .mw-headline}

Once the installation media is ready, it is time to boot it. Insert the
media in the system, reboot, and enter the motherboard\'s firmware user
interface. This is usually performed by pressing a keyboard key such as
[DEL]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"},
[F1]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"},
[F10]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"},
or [ESC]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}
during the Power-On Self-test (POST) process. The \'trigger\' key varies
depending on the system and motherboard. If it is not obvious use an
internet search engine and do some research using the motherboard\'s
model name as the search keyword. Results should be easy to determine.
Once inside the motherboard\'s firmware menu, change the boot order so
that the external bootable media (CD/DVD disks or USB drives) are tried
*before* the internal disk devices. Without this change, the system will
most likely reboot to the internal disk device, ignoring the external
boot media.

::: {.alert .alert-warning .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Important**\
When installing Gentoo with the purpose of using the UEFI interface
instead of BIOS, it is recommended to boot with UEFI immediately. If
not, then it might be necessary to create a bootable UEFI USB stick (or
other medium) once before finalizing the Gentoo Linux installation.
:::

If not yet done, ensure that the installation media is inserted or
plugged into the system, and reboot. A boot prompt should be shown. At
this screen, [Enter]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}
will begin the boot process with the default boot options. To boot the
installation media with custom boot options, specify a kernel followed
by boot options and then hit [Enter]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}.

At the boot prompt, users get the option of displaying the available
kernels ([F1]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"})
and boot options ([F2]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}).
If no choice is made within 15 seconds (either displaying information or
using a kernel) then the installation media will fall back to booting
from disk. This allows installations to reboot and try out their
installed environment without the need to remove the CD from the tray
(something well appreciated for remote installations).

Specifying a kernel was mentioned. On the Minimal installation media,
only two predefined kernel boot options are provided. The default option
is called [gentoo]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}. The
other being the *-nofb* variant; this disables kernel framebuffer
support.

The next section displays a short overview of the available kernels and
their descriptions:

#### [Kernel choices]{#Kernel_choices .mw-headline}

gentoo
:   Default kernel with support for K8 CPUs (including NUMA support) and
    EM64T CPUs.

gentoo-nofb
:   Same as *gentoo* but without framebuffer support.

memtest86
:   Test the local RAM for errors.

Alongside the kernel, boot options help in tuning the boot process
further.

#### [Hardware options]{#Hardware_options .mw-headline}

acpi=on
:   This loads support for ACPI and also causes the acpid daemon to be
    started by the CD on boot. This is only needed if the system
    requires ACPI to function properly. This is not required for
    Hyperthreading support.

acpi=off
:   Completely disables ACPI. This is useful on some older systems and
    is also a requirement for using APM. This will disable any
    Hyperthreading support of your processor.

console=X
:   This sets up serial console access for the CD. The first option is
    the device, usually ttyS0 on x86, followed by any connection
    options, which are comma separated. The default options are
    9600,8,n,1.

dmraid=X
:   This allows for passing options to the device-mapper RAID subsystem.
    Options should be encapsulated in quotes.

doapm
:   This loads APM driver support. This also requires that `acpi=off`.

dopcmcia
:   This loads support for PCMCIA and Cardbus hardware and also causes
    the pcmcia cardmgr to be started by the CD on boot. This is only
    required when booting from PCMCIA/Cardbus devices.

doscsi
:   This loads support for most SCSI controllers. This is also a
    requirement for booting most USB devices, as they use the SCSI
    subsystem of the kernel.

sda=stroke
:   This allows the user to partition the whole hard disk even when the
    BIOS is unable to handle large disks. This option is only used on
    machines with an older BIOS. Replace sda with the device that
    requires this option.

ide=nodma
:   This forces the disabling of DMA in the kernel and is required by
    some IDE chipsets and also by some CDROM drives. If the system is
    having trouble reading from the IDE CDROM, try this option. This
    also disables the default hdparm settings from being executed.

noapic
:   This disables the Advanced Programmable Interrupt Controller that is
    present on newer motherboards. It has been known to cause some
    problems on older hardware.

nodetect
:   This disables all of the autodetection done by the CD, including
    device autodetection and DHCP probing. This is useful for doing
    debugging of a failing CD or driver.

nodhcp
:   This disables DHCP probing on detected network cards. This is useful
    on networks with only static addresses.

nodmraid
:   Disables support for device-mapper RAID, such as that used for
    on-board IDE/SATA RAID controllers.

nofirewire
:   This disables the loading of Firewire modules. This should only be
    necessary if your Firewire hardware is causing a problem with
    booting the CD.

nogpm
:   This disables gpm console mouse support.

nohotplug
:   This disables the loading of the hotplug and coldplug init scripts
    at boot. This is useful for doing debugging of a failing CD or
    driver.

nokeymap
:   This disables the keymap selection used to select non-US keyboard
    layouts.

nolapic
:   This disables the local APIC on Uniprocessor kernels.

nosata
:   This disables the loading of Serial ATA modules. This is used if the
    system is having problems with the SATA subsystem.

nosmp
:   This disables SMP, or Symmetric Multiprocessing, on SMP-enabled
    kernels. This is useful for debugging SMP-related issues with
    certain drivers and motherboards.

nosound
:   This disables sound support and volume setting. This is useful for
    systems where sound support causes problems.

nousb
:   This disables the autoloading of USB modules. This is useful for
    debugging USB issues.

slowusb
:   This adds some extra pauses into the boot process for slow USB
    CDROMs, like in the IBM BladeCenter.

#### []{#Logical_volume/device_management}[Logical volume/device management]{#Logical_volume.2Fdevice_management .mw-headline}

dolvm
:   This enables support for Linux\'s Logical Volume Management.

#### [Other options]{#Other_options .mw-headline}

debug
:   Enables debugging code. This might get messy, as it displays a lot
    of data to the screen.

docache
:   This caches the entire runtime portion of the CD into RAM, which
    allows the user to umount
    [/mnt/cdrom]{style="font-family: monospace; font-size: 95%"} and
    mount another CDROM. This option requires that there is at least
    twice as much available RAM as the size of the CD.

doload=X
:   This causes the initial ramdisk to load any module listed, as well
    as dependencies. Replace X with the module name. Multiple modules
    can be specified by a comma-separated list.

dosshd
:   Starts sshd on boot, which is useful for unattended installs.

passwd=foo
:   Sets whatever follows the equals as the root password, which is
    required for *dosshd* since the root password is by default
    scrambled.

noload=X
:   This causes the initial ramdisk to skip the loading of a specific
    module that may be causing a problem. Syntax matches that of doload.

nonfs
:   Disables the starting of portmap/nfsmount on boot.

nox
:   This causes an X-enabled LiveCD to not automatically start X, but
    rather, to drop to the command line instead.

scandelay
:   This causes the CD to pause for 10 seconds during certain portions
    the boot process to allow for devices that are slow to initialize to
    be ready for use.

scandelay=X
:   This allows the user to specify a given delay, in seconds, to be
    added to certain portions of the boot process to allow for devices
    that are slow to initialize to be ready for use. Replace X with the
    number of seconds to pause.

::: {.alert .alert-info .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Note**\
The bootable media will check for `no*` options before `do*` options, so
that options can be overridden in the exact order specified.
:::

Now boot the media, select a kernel (if the default
[gentoo]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
kernel does not suffice) and boot options. As an example, we boot the
[gentoo]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
kernel, with `dopcmcia` as a kernel parameter:

::: {.cmd-box}
<div>

`boot:`{style="color: #4E9A06; font-weight: bold;"}[]{.tripleclick-separator}`gentoo dopcmcia`

</div>
:::

Next the user will be greeted with a boot screen and progress bar. If
the installation is done on a system with a non-US keyboard, make sure
to immediately press [Alt]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}+[F1]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}
to switch to verbose mode and follow the prompt. If no selection is made
in 10 seconds the default (US keyboard) will be accepted and the boot
process will continue. Once the boot process completes, the user is
automatically logged in to the \"Live\" Gentoo Linux environment as the
*root* user, the super user. A root prompt is displayed on the current
console, and one can switch to other consoles by pressing [Alt]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}+[F2]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"},
[Alt]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}+[F3]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}
and [Alt]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}+[F4]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}.
Get back to the one started on by pressing [Alt]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}+[F1]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}.

\

### [Extra hardware configuration]{#Extra_hardware_configuration .mw-headline}

When the Installation medium boots, it tries to detect all the hardware
devices and loads the appropriate kernel modules to support the
hardware. In the vast majority of cases, it does a very good job.
However, in some cases it may not auto-load the kernel modules needed by
the system. If the PCI auto-detection missed some of the system\'s
hardware, the appropriate kernel modules have to be loaded manually.

In the next example the 8139too module (which supports certain kinds of
network interfaces) is loaded:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`modprobe 8139too`

</div>
:::

### [Optional: User accounts]{#Optional:_User_accounts .mw-headline}

If other people need access to the installation environment, or there is
need to run commands as a non-root user on the installation medium (such
as to chat using [irssi]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
without root privileges for security reasons), then an additional user
account needs to be created and the root password set to a strong
password.

To change the root password, use the [passwd]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
utility:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`passwd`

</div>

    New password: (Enter the new password)
    Re-enter password: (Re-enter the password)
:::

To create a user account, first enter their credentials, followed by the
account\'s password. The [useradd]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} and
[passwd]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
commands are used for these tasks.

In the next example, a user called *john* is created:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`useradd -m -G users john`

</div>

<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`passwd john`

</div>

    New password: (Enter john's password)
    Re-enter password: (Re-enter john's password)
:::

To switch from the (current) *root* user to the newly created user
account, use the [su]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
command:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`su - john`

</div>
:::

### [Optional: Viewing documentation while installing]{#Optional:_Viewing_documentation_while_installing .mw-headline}

#### [TTYs]{#TTYs .mw-headline}

To view the Gentoo handbook during the installation, first create a user
account as described above. Then press [Alt]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}+[F2]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}
to go to a new terminal.

During the installation, the [links]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
command can be used to browse the Gentoo handbook - of course only from
the moment that the Internet connection is working.

::: {.cmd-box}
<div>

`user $`{style="color: #4E9A06; font-weight: bold;"}[]{.tripleclick-separator}`links https://wiki.gentoo.org/wiki/Handbook:AMD64`

</div>
:::

To go back to the original terminal, press [Alt]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}+[F1]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}.

#### [GNU Screen]{#GNU_Screen .mw-headline}

The [Screen](/wiki/Screen "Screen") utility is installed by default on
official Gentoo installation media. It may be more efficient for the
seasoned Linux enthusiast to use [screen]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} to
view installation instructions via split panes rather than the multiple
TTY method mentioned above.

### [Optional: Starting the SSH daemon]{#Optional:_Starting_the_SSH_daemon .mw-headline}

To allow other users to access the system during the installation
(perhaps to support during an installation, or even do it remotely), a
user account needs to be created (as was documented earlier on) and the
SSH daemon needs to be started.

To fire up the SSH daemon on an OpenRC init, execute the following
command:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`rc-service sshd start`

</div>
:::

::: {.alert .alert-info .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Note**\
If users log on to the system, they will see a message that the host key
for this system needs to be confirmed (through what is called a
fingerprint). This behavior is typical and can be expected for initial
connections to an SSH server. However, later when the system is set up
and someone logs on to the newly created system, the SSH client will
warn that the host key has been changed. This is because the user now
logs on to - for SSH - a different server (namely the freshly installed
Gentoo system rather than the live environment that the installation is
currently using). Follow the instructions given on the screen then to
replace the host key on the client system.
:::

To be able to use sshd, the network needs to function properly. Continue
with the chapter on [Configuring the
network](/wiki/Handbook:AMD64/Installation/Networking "Handbook:AMD64/Installation/Networking").

\

\

\

\

\

[Automatic network detection]{#Automatic_network_detection .mw-headline}
------------------------------------------------------------------------

Maybe it just works?

If the system is plugged into an Ethernet network with a DHCP server, it
is very likely that the networking configuration has already been set up
automatically. If so, then the many included network-aware commands on
the installation CD such as [ssh]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"},
[scp]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"},
[ping]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"},
[irssi]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"},
[wget]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}, and
[links]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"},
among others, will work immediately.

### [Determine interface names]{#Determine_interface_names .mw-headline}

#### [ifconfig command]{#ifconfig_command .mw-headline}

If networking has been configured, the [ifconfig]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
command should list one or more network interfaces (besides
[lo]{style="font-family: monospace; font-size: 95%"}). In the example
below [eth0]{style="font-family: monospace; font-size: 95%"} shows up:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`ifconfig`

</div>

    eth0      Link encap:Ethernet  HWaddr 00:50:BA:8F:61:7A
              inet addr:192.168.0.2  Bcast:192.168.0.255  Mask:255.255.255.0
              inet6 addr: fe80::50:ba8f:617a/10 Scope:Link
              UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
              RX packets:1498792 errors:0 dropped:0 overruns:0 frame:0
              TX packets:1284980 errors:0 dropped:0 overruns:0 carrier:0
              collisions:1984 txqueuelen:100
              RX bytes:485691215 (463.1 Mb)  TX bytes:123951388 (118.2 Mb)
              Interrupt:11 Base address:0xe800 
:::

As a result of the shift towards [predictable network interface
names](http://www.freedesktop.org/wiki/Software/systemd/PredictableNetworkInterfaceNames/){.external
.text}, the interface name on the system can be quite different from the
old [eth0]{style="font-family: monospace; font-size: 95%"} naming
convention. Recent installation media might show regular network
interfaces names like
[eno0]{style="font-family: monospace; font-size: 95%"},
[ens1]{style="font-family: monospace; font-size: 95%"}, or
[enp5s0]{style="font-family: monospace; font-size: 95%"}. Look for the
interface in the [ifconfig]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
output that has an IP address related to the local network.

::: {.alert .alert-success .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Tip**\
If no interfaces are displayed when the standard
[ifconfig]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
command is used, try using the same command with the `-a` option. This
option forces the utility to show all network interfaces detected by the
system whether they be in an up or down state. If [ifconfig
-a]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
produces no results then the hardware is faulty or the driver for the
interface has not been loaded into the kernel. Both situations reach
beyond the scope of this Handbook. Contact
[[\#gentoo](https://webchat.freenode.net/?channels=gentoo){.external
.text}]{style="font-family: monospace; font-size: 95%;"} for support.
:::

#### [ip command]{#ip_command .mw-headline}

As an alternative to [ifconfig]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}, the
[ip]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
command can be used to determine interface names. The following example
shows the output of [ip addr]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} (of
another system so the information shown is different from the previous
example):

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`ip addr`

</div>

    2: eno1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
        link/ether e8:40:f2:ac:25:7a brd ff:ff:ff:ff:ff:ff
        inet 10.0.20.77/22 brd 10.0.23.255 scope global eno1
           valid_lft forever preferred_lft forever
        inet6 fe80::ea40:f2ff:feac:257a/64 scope link 
           valid_lft forever preferred_lft forever
:::

The output above may be a bit more complicated to read than alternative.
The interface name in the above example directly follows the number; it
is [eno1]{style="font-family: monospace; font-size: 95%"}.

In the remainder of this document, the handbook will assume that the
operating network interface is called
[eth0]{style="font-family: monospace; font-size: 95%"}.

### [Optional: Configure any proxies]{#Optional:_Configure_any_proxies .mw-headline}

If the Internet is accessed through a proxy, then it is necessary to set
up proxy information during the installation. It is very easy to define
a proxy: just define a variable which contains the proxy server
information.

In most cases, it is sufficient to define the variables using the server
hostname. As an example, we assume the proxy is called proxy.gentoo.org
and the port is 8080.

To set up an HTTP proxy (for HTTP and HTTPS traffic):

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`export http_proxy="http://proxy.gentoo.org:8080"`

</div>
:::

To set up an FTP proxy:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`export ftp_proxy="ftp://proxy.gentoo.org:8080"`

</div>
:::

To set up an RSYNC proxy:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`export RSYNC_PROXY="proxy.gentoo.org:8080"`

</div>
:::

If the proxy requires a username and password, use the following syntax
for the variable:

::: {.gw-box}
::: {.box-caption}
[CODE]{.label style="margin-right: .5em; background-color: #204A87"}
**Adding username/password to the proxy variable**
:::

``` {.captioned}
http://username:password@proxy.gentoo.org:8080
```
:::

### [Testing the network]{#Testing_the_network .mw-headline}

Try pinging your ISP\'s DNS server (found in
[/etc/resolv.conf]{style="font-family: monospace; font-size: 95%"}) and
a web site of choice. This ensures that the network is functioning
properly and that the network packets are reaching the net, DNS name
resolution is working correctly, etc.

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`ping -c 3 www.gentoo.org`

</div>
:::

If this all works, then the remainder of this chapter can be skipped to
jump right to the next step of the installation instructions ([Preparing
the
disks](/wiki/Handbook:AMD64/Installation/Disks "Handbook:AMD64/Installation/Disks")).

[Automatic network configuration]{#Automatic_network_configuration .mw-headline}
--------------------------------------------------------------------------------

If the network doesn\'t work immediately, some installation media allow
the user to use [net-setup]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} (for
regular or wireless networks), [pppoe-setup]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} (for
ADSL users) or [pptp]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} (for
PPTP users).

If the installation medium does not contain any of these tools, continue
with the [Manual network configuration](#Manual_network_configuration).

-   Regular Ethernet users should continue with [Default: Using
    net-setup](#Default:_Using_net-setup)
-   ADSL users should continue with [Alternative: Using
    PPP](#Alternative:_Using_PPP)
-   PPTP users should continue with [Alternative: Using
    PPTP](#Alternative:_Using_PPTP)

### [Default: Using net-setup]{#Default:_Using_net-setup .mw-headline}

The simplest way to set up networking if it didn\'t get configured
automatically is to run the [net-setup]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
script:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`net-setup eth0`

</div>
:::

[net-setup]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} will
ask some questions about the network environment. When all is done, the
network connection should work. Test the network connection as stated
before. If the tests are positive, congratulations! Skip the rest of
this section and continue with [Preparing the
disks](/wiki/Handbook:AMD64/Installation/Disks "Handbook:AMD64/Installation/Disks").

If the network still doesn\'t work, continue with [Manual network
configuration](#Manual_network_configuration).

### [Alternative: Using PPP]{#Alternative:_Using_PPP .mw-headline}

Assuming PPPoE is needed to connect to the Internet, the installation CD
(any version) has made things easier by including ppp. Use the provided
[pppoe-setup]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
script to configure the connection. During the setup the Ethernet device
that is connected to your ADSL modem, the username and password, the IPs
of the DNS servers and if a basic firewall is needed or not will be
asked.

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`pppoe-setup`

</div>

<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`pppoe-start`

</div>
:::

If something goes wrong, double-check that the username and password are
correct by looking at
[etc/ppp/pap-secrets]{style="font-family: monospace; font-size: 95%"} or
[/etc/ppp/chap-secrets]{style="font-family: monospace; font-size: 95%"}
and make sure to use the right Ethernet device. If the Ethernet device
does not exist, the appropriate network modules need to be loaded. In
that case continue with [Manual network
configuration](#Manual_network_configuration) as it will explain how to
load the appropriate network modules there.

If everything worked, continue with [Preparing the
disks](/wiki/Handbook:AMD64/Installation/Disks "Handbook:AMD64/Installation/Disks").

### [Alternative: Using PPTP]{#Alternative:_Using_PPTP .mw-headline}

If PPTP support is needed, use [pptpclient]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
which is provided by the installation CDs. But first make sure that the
configuration is correct. Edit
[/etc/ppp/pap-secrets]{style="font-family: monospace; font-size: 95%"}
or
[/etc/ppp/chap-secrets]{style="font-family: monospace; font-size: 95%"}
so it contains the correct username/password combination:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`nano -w /etc/ppp/chap-secrets`

</div>
:::

Then adjust
[/etc/ppp/options.pptp]{style="font-family: monospace; font-size: 95%"}
if necessary:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`nano -w /etc/ppp/options.pptp`

</div>
:::

When all that is done, run [pptp]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
(along with the options that couldn\'t be set in
[options.pptp]{style="font-family: monospace; font-size: 95%"}) to
connect the server:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`pptp <server ip>`

</div>
:::

Now continue with [Preparing the
disks](/wiki/Handbook:AMD64/Installation/Disks "Handbook:AMD64/Installation/Disks").

[Manual network configuration]{#Manual_network_configuration .mw-headline}
--------------------------------------------------------------------------

### [Loading the appropriate network modules]{#Loading_the_appropriate_network_modules .mw-headline}

When the Installation CD boots, it tries to detect all the hardware
devices and loads the appropriate kernel modules (drivers) to support
the hardware. In the vast majority of cases, it does a very good job.
However, in some cases, it may not auto-load the kernel modules needed.

If [net-setup]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} or
[pppoe-setup]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
failed, then it is possible that the network card wasn\'t found
immediately. This means users may have to load the appropriate kernel
modules manually.

To find out what kernel modules are provided for networking, use the
[ls]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
command:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`` ls /lib/modules/`uname -r`/kernel/drivers/net ``

</div>
:::

If a driver is found for the network device, use
[modprobe]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} to
load the kernel module. For instance, to load the
[pcnet32]{style="font-family: monospace; font-size: 95%"} module:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`modprobe pcnet32`

</div>
:::

To check if the network card is now detected, use
[ifconfig]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}. A
detected network card would result in something like this (again,
[eth0]{style="font-family: monospace; font-size: 95%"} here is just an
example):

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`ifconfig eth0`

</div>

    eth0      Link encap:Ethernet  HWaddr FE:FD:00:00:00:00  
              BROADCAST NOARP MULTICAST  MTU:1500  Metric:1
              RX packets:0 errors:0 dropped:0 overruns:0 frame:0
              TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
              collisions:0 txqueuelen:0 
              RX bytes:0 (0.0 b)  TX bytes:0 (0.0 b)
:::

If however the following error is shown, the network card is not
detected:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`ifconfig eth0`

</div>

    eth0: error fetching interface information: Device not found
:::

The available network interface names on the system can be listed
through the [/sys]{style="font-family: monospace; font-size: 95%"} file
system:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`ls /sys/class/net`

</div>

    dummy0  eth0  lo  sit0  tap0  wlan0
:::

In the above example, 6 interfaces are found. The
[eth0]{style="font-family: monospace; font-size: 95%"} one is most
likely the (wired) Ethernet adapter whereas
[wlan0]{style="font-family: monospace; font-size: 95%"} is the wireless
one.

Assuming that the network card is now detected, retry
[net-setup]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} or
[pppoe-setup]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
again (which should work now), but for the hardcore people we explain
how to configure the network manually as well.

Select one of the following sections based on your network setup:

-   [Using DHCP](#Using_DHCP) for automatic IP retrieval
-   [Preparing for wireless access](#Preparing_for_wireless_access) if a
    wireless network is used
-   [Understanding network
    terminology](#Understanding_network_terminology) explains the basics
    about networking
-   [Using ifconfig and route](#Using_ifconfig_and_route) explains how
    to set up networking manually

### [Using DHCP]{#Using_DHCP .mw-headline}

DHCP (Dynamic Host Configuration Protocol) makes it possible to
automatically receive networking information (IP address, netmask,
broadcast address, gateway, nameservers etc.). This only works if a DHCP
server is in the network (or if the ISP provider provides a DHCP
service). To have a network interface receive this information
automatically, use [dhcpcd]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`dhcpcd eth0`

</div>
:::

Some network administrators require that the hostname and domainname
provided by the DHCP server is used by the system. In that case, use:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`dhcpcd -HD eth0`

</div>
:::

If this works (try pinging some Internet server, like Google\'s 8.8.8.8
or Cloudflare\'s 1.1.1.1), then everything is set and ready to continue.
Skip the rest of this section and continue with [Preparing the
disks](/wiki/Handbook:AMD64/Installation/Disks "Handbook:AMD64/Installation/Disks").

### [Preparing for wireless access]{#Preparing_for_wireless_access .mw-headline}

::: {.alert .alert-info .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Note**\
Support for the [iw]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
command might be architecture-specific. If the command is not available
see if the
[net-wireless/iw](https://packages.gentoo.org/packages/net-wireless/iw){.external
.text} package is available for the current architecture. The
[iw]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
command will be unavailable unless the
[net-wireless/iw](https://packages.gentoo.org/packages/net-wireless/iw){.external
.text} package has been installed.
:::

When using a wireless (802.11) card, the wireless settings need to be
configured before going any further. To see the current wireless
settings on the card, one can use [iw]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}.
Running [iw]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
might show something like:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`iw dev wlp9s0 info`

</div>

    Interface wlp9s0
        ifindex 3
        wdev 0x1
        addr 00:00:00:00:00:00
        type managed
        wiphy 0
        channel 11 (2462 MHz), width: 20 MHz (no HT), center1: 2462 MHz
        txpower 30.00 dBm
:::

To check for a current connection:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`iw dev wlp9s0 link`

</div>

    Not connected.
:::

or

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`iw dev wlp9s0 link`

</div>

    Connected to 00:00:00:00:00:00 (on wlp9s0)
        SSID: GentooNode
        freq: 2462
        RX: 3279 bytes (25 packets)
        TX: 1049 bytes (7 packets)
        signal: -23 dBm
        tx bitrate: 1.0 MBit/s
:::

::: {.alert .alert-info .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Note**\
Some wireless cards may have a device name of
[wlan0]{style="font-family: monospace; font-size: 95%"} or
[ra0]{style="font-family: monospace; font-size: 95%"} instead of wlp9s0.
Run [ip link]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} to
determine the correct device name.
:::

For most users, there are only two settings needed to connect, the ESSID
(aka wireless network name) and, optionally, the WEP key.

-   First, ensure the interface is active:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`ip link set dev wlp9s0 up`

</div>
:::

-   To connect to an open network with the name *GentooNode*:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`iw dev wlp9s0 connect -w GentooNode`

</div>
:::

-   To connect with a hex WEP key, prefix the key with `d:`:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`iw dev wlp9s0 connect -w GentooNode key 0:d:1234123412341234abcd`

</div>
:::

-   To connect with an ASCII WEP key:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`iw dev wlp9s0 connect -w GentooNode key 0:some-password`

</div>
:::

::: {.alert .alert-info .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Note**\
If the wireless network is set up with WPA or WPA2, then
[wpa\_supplicant]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
needs to be used. For more information on configuring wireless
networking in Gentoo Linux, please read the [Wireless networking
chapter](/wiki/Handbook:AMD64/Networking/Wireless "Handbook:AMD64/Networking/Wireless")
in the Gentoo Handbook.
:::

Confirm the wireless settings by using [iw dev wlp9s0
link]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}.
Once wireless is working, continue configuring the IP level networking
options as described in the next section ([Understanding network
terminology](#Understanding_network_terminology)) or use the
[net-setup]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} tool
as described previously.

### [Understanding network terminology]{#Understanding_network_terminology .mw-headline}

::: {.alert .alert-info .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Note**\
If the IP address, broadcast address, netmask and nameservers are known,
then skip this subsection and continue with [Using
[ifconfig]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} and
[route]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}](#Using_ifconfig_and_route).
:::

If all of the above fails, the network will need to be configured
manually. This is not difficult at all. However, some knowledge of
network terminology and basic concepts might be necessary. After reading
this section, users will know what a gateway is, what a netmask serves
for, how a broadcast address is formed and why systems need nameservers.

In a network, hosts are identified by their IP address (Internet
Protocol address). Such an address is perceived as a combination of four
numbers between 0 and 255. Well, at least when using IPv4 (IP version
4). In reality, such an IPv4 address consists of 32 bits (ones and
zeros). Let\'s view an example:

::: {.gw-box}
::: {.box-caption}
[CODE]{.label style="margin-right: .5em; background-color: #204A87"}
**Example of an IPv4 address**
:::

``` {.captioned}
IP Address (numbers):   192.168.0.2
IP Address (bits):      11000000 10101000 00000000 00000010
                        -------- -------- -------- --------
                           192      168       0        2
```
:::

::: {.alert .alert-info .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Note**\
The successor of IPv4, IPv6, uses 128 bits (ones and zeros). In this
section, the focus is on IPv4 addresses.
:::

Such an IP address is unique to a host as far as all accessible networks
are concerned (i.e. every host that one wants to be able to reach must
have a unique IP address). In order to distinguish between hosts inside
and outside a network, the IP address is divided in two parts: the
network part and the host part.

The separation is written down with the netmask, a collection of ones
followed by a collection of zeros. The part of the IP that can be mapped
on the ones is the network-part, the other one is the host-part. As
usual, the netmask can be written down as an IP address.

::: {.gw-box}
::: {.box-caption}
[CODE]{.label style="margin-right: .5em; background-color: #204A87"}
**Example of network/host separation**
:::

``` {.captioned}
IP address:    192      168      0         2
            11000000 10101000 00000000 00000010
Netmask:    11111111 11111111 11111111 00000000
               255      255     255        0
           +--------------------------+--------+
                    Network              Host
```
:::

In other words, 192.168.0.14 is part of the example network, but
192.168.1.2 is not.

The broadcast address is an IP address with the same network-part as the
network, but with only ones as host-part. Every host on the network
listens to this IP address. It is truly meant for broadcasting packets.

::: {.gw-box}
::: {.box-caption}
[CODE]{.label style="margin-right: .5em; background-color: #204A87"}
**Broadcast address**
:::

``` {.captioned}
IP address:    192      168      0         2
            11000000 10101000 00000000 00000010
Broadcast:  11000000 10101000 00000000 11111111
               192      168      0        255
           +--------------------------+--------+
                     Network             Host
```
:::

To be able to surf on the Internet, each computer in the network must
know which host shares the Internet connection. This host is called the
gateway. Since it is a regular host, it has a regular IP address (for
instance 192.168.0.1).

Previously we stated that every host has its own IP address. To be able
to reach this host by a name (instead of an IP address) we need a
service that translates a name (such as dev.gentoo.org) to an IP address
(such as 64.5.62.82). Such a service is called a *name service*. To use
such a service, the necessary name servers need to be defined in
[/etc/resolv.conf]{style="font-family: monospace; font-size: 95%"}.

In some cases, the gateway also serves as a nameserver. Otherwise the
nameservers provided by the ISP need to be entered in this file.

To summarize, the following information is needed before continuing:

  Network item            Example
  ----------------------- --------------------------------
  The system IP address   192.168.0.2
  Netmask                 255.255.255.0
  Broadcast               192.168.0.255
  Gateway                 192.168.0.1
  Nameserver(s)           195.130.130.5, 195.130.130.133

### [Using ifconfig and route]{#Using_ifconfig_and_route .mw-headline}

Setting up the network consists of three steps:

1.  Assign an IP address using [ifconfig]{.tripleclick-separator
    style="font-family: monospace; font-size: 95%; font-weight: bold;"}
2.  Set up routing to the gateway using [route]{.tripleclick-separator
    style="font-family: monospace; font-size: 95%; font-weight: bold;"}
3.  Finish up by placing the nameserver IPs in
    [/etc/resolv.conf]{style="font-family: monospace; font-size: 95%"}

To assign an IP address, the IP address, broadcast address and netmask
are needed. Then execute the following command, substituting
`${IP_ADDR}`{.variable} with the right IP address,
`${BROADCAST}`{.variable} with the right broadcast address and
`${NETMASK}`{.variable} with the right netmask:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`ifconfig eth0 ${IP_ADDR} broadcast ${BROADCAST} netmask ${NETMASK} up`

</div>
:::

Set up routing using [route]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}.
Substitute `${GATEWAY}`{.variable} with the right gateway IP address:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`route add default gw ${GATEWAY}`

</div>
:::

Now open
[/etc/resolv.conf]{style="font-family: monospace; font-size: 95%"}:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`nano -w /etc/resolv.conf`

</div>
:::

Fill in the nameserver(s) using the following as a template. Make sure
to substitute `${NAMESERVER1}`{.variable} and
`${NAMESERVER2}`{.variable} with the appropriate nameserver addresses:

::: {.box-caption}
[FILE]{.label style="margin-right: .5em; background-color: #54487A"}
**`/etc/resolv.conf`{style="border: none; background: none; color: #54487A; margin-right: .5em;"}Default
resolv.conf template**
:::

``` {.captioned}
nameserver ${NAMESERVER1}
nameserver ${NAMESERVER2}
```

That\'s it. Now test the network by pinging some Internet server (like
Google\'s 8.8.8.8 or Cloudflare\'s 1.1.1.1). If this works,
congratulations then. Continue with [Preparing the
disks](/wiki/Handbook:AMD64/Installation/Disks "Handbook:AMD64/Installation/Disks").

\

\

\

\

\

[Introduction to block devices]{#Introduction_to_block_devices .mw-headline}
----------------------------------------------------------------------------

### [Block devices]{#Block_devices .mw-headline}

Let\'s take a good look at disk-oriented aspects of Gentoo Linux and
Linux in general, including Linux filesystems, partitions, and block
devices. Once the ins and outs of disks and filesystems are understood,
partitions and filesystems can be established for the Gentoo Linux
installation.

To begin, let\'s look at block devices. The most famous block device is
probably the one that represents the first drive in a Linux system,
namely [/dev/sda]{style="font-family: monospace; font-size: 95%"}. SCSI
and Serial ATA drives are both labeled
[/dev/sd\*]{style="font-family: monospace; font-size: 95%"}; even IDE
drives are labeled
[/dev/sd\*]{style="font-family: monospace; font-size: 95%"} with the
libata framework in the kernel. When using the old device framework,
then the first IDE drive is
[/dev/hda]{style="font-family: monospace; font-size: 95%"}.

The block devices above represent an abstract interface to the disk.
User programs can use these block devices to interact with the disk
without worrying about whether the drives are IDE, SCSI, or something
else. The program can simply address the storage on the disk as a bunch
of contiguous, randomly-accessible 512-byte blocks.

\

### [Partition tables]{#Partition_tables .mw-headline}

Although it is theoretically possible to use a raw, unpartitioned disk
to house a Linux system (when creating a btrfs RAID for example), this
is almost never done in practice. Instead, disk block devices are split
up into smaller, more manageable block devices. On
**[amd64]{style="font-family: monospace; font-size: 95%; color: #54487a"}**
systems, these are called partitions. There are currently two standard
partitioning technologies in use: MBR and GPT.

#### [MBR]{#MBR .mw-headline}

The *MBR (Master Boot Record)* setup uses 32-bit identifiers for the
start sector and length of the partitions, and supports three partition
types: primary, extended, and logical. Primary partitions have their
information stored in the master boot record itself - a very small
(usually 512 bytes) location at the very beginning of a disk. Due to
this small space, only four primary partitions are supported (for
instance, [/dev/sda1]{style="font-family: monospace; font-size: 95%"} to
[/dev/sda4]{style="font-family: monospace; font-size: 95%"}).

To support more partitions, one of the primary partitions can be marked
as an extended partition. This partition can then contain logical
partitions (partitions within a partition).

::: {.alert .alert-warning .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Important**\
Although still supported by most motherboard manufacturers partition
tables are considered legacy. Unless working with hardware that is
pre-2010, it best to partition a disk using a [GUID Partition
Table](https://en.wikipedia.org/wiki/GUID_Partition_Table "wikipedia:GUID Partition Table"){.extiw}.
Readers who must proceed with MBR should acknowledge the following
information:

-   Most post-2010 motherboards consider MBR a legacy (supported, but
    not ideal) boot mode.
-   Due to using 32-bit identifiers, master boot record partitioning
    tables cannot handle disks that are greater than 2 TiBs in size.
-   Unless a extended partition is created, MBR supports a maximum of
    four partitions.
-   The MBR setup does not provide any backup-MBR, so if an application
    or user overwrites the MBR, all partition information is lost.
:::

The Handbook authors suggest using [GPT](#GPT) whenever possible for
Gentoo installations.

#### [GPT]{#GPT .mw-headline}

The *GPT (GUID Partition Table)* setup uses 64-bit identifiers for the
partitions. The location in which it stores the partition information is
much bigger than the 512 bytes of an MBR, which means there is
practically no limit on the amount of partitions for a GPT disk. Also
the size of a partition is bounded by a much greater limit (almost 8 ZiB
- yes, zettabytes).

When a system\'s software interface between the operating system and
firmware is UEFI (instead of BIOS), GPT is almost mandatory as
compatibility issues will arise with MBR.

GPT also takes advantage of checksumming and redundancy. It carries
CRC32 checksums to detect errors in the header and partition tables and
has a backup GPT at the end of the disk. This backup table can be used
to recover damage of the primary GPT near the beginning of the disk.

### [GPT or MBR]{#GPT_or_MBR .mw-headline}

From the description above, one might think that using GPT should always
be the recommended approach, however there are a few caveats.

Using GPT on a BIOS-based computer works, but then one cannot dual-boot
with a Microsoft Windows operating system. The reason is that Microsoft
Windows will boot in UEFI mode if it detects a GPT partition label.

Some buggy motherboard firmware configured to boot in BIOS/CSM/legacy
mode might also have problems with booting from GPT labeled disks. If
that is the case, it might be possible to work around the problem by
adding the boot/active flag on the protective MBR partition which has to
be done through [fdisk]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} with
the `-t dos` option to force it to read the partition table using the
MBR format.

In this case, launch [fdisk]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} and
toggle the flag using the [a]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}
key. Press [1]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}
to select the first partition, then press the [w]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}
key to write the changes to the disk and exit the
[fdisk]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
application:

::: {.cmd-box}
<div>

`user $`{style="color: #4E9A06; font-weight: bold;"}[]{.tripleclick-separator}`fdisk -t dos /dev/sda`

</div>

    Welcome to fdisk (util-linux 2.24.1).
    Changes will remain in memory only, until you decide to write them.
    Be careful before using the write command.
      
    Command (m for help): a
    Partition number (1-4): 1
      
    Command (m for help): w
:::

#### [Using UEFI]{#Using_UEFI .mw-headline}

When installing Gentoo on a system that uses UEFI to boot the operating
system (instead of BIOS), then it is important that an EFI System
Partition (ESP) is created. The instructions for
[parted]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
below contain the necessary pointers to correctly handle this operation.

The ESP *must* be a FAT variant (sometimes shown as *vfat* on Linux
systems). The official [UEFI
specification](http://www.uefi.org/sites/default/files/resources/UEFI%202_5.pdf){.external
.text} denotes FAT12, 16, or 32 filesystems will be recognized by the
UEFI firmware, although FAT32 is recommended for the ESP. Proceed in
formatting the ESP as FAT32:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`mkfs.fat -F 32 /dev/sda2`

</div>
:::

::: {.alert .alert-warning .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Important**\
If a FAT variant is not used for the ESP, the system\'s UEFI firmware is
not guaranteed to find the bootloader (or Linux kernel) and most likely
be unable to boot the system!
:::

### [Advanced storage]{#Advanced_storage .mw-headline}

#### [Btrfs RAID]{#Btrfs_RAID .mw-headline}

As noted above, btrfs has the ability to create filesystems across
multiple devices. Btrfs filesystems generated in this way can act in the
following modes: raid0, raid1, raid10, raid5, and raid6. RAID modes 5
and 6 have improved considerably, but are still considered unstable.
After a multiple device filesystem has been created, new devices can be
added and old devices removed in a few commands. Btrfs takes more
involvement than other filesystems making it not as friendly to
beginners.

#### [LVM]{#LVM .mw-headline}

The
**[amd64]{style="font-family: monospace; font-size: 95%; color: #54487a"}**
Installation CDs provide support for Logical Volume Manager (LVM). LVM
increases the flexibility offered by the partitioning setup. The
installation instructions below will focus on \"regular\" partitions,
but it is good to know LVM is supported if that route is desired. Visit
the [LVM](/wiki/LVM "LVM") article for more details. Newcomers beware:
although fully supported LVM is outside the scope of this guide.

### [Default partitioning scheme]{#Default_partitioning_scheme .mw-headline}

Throughout the remainder of the handbook, the following partitioning
scheme will be used as a simple example layout:

  Partition                                                     Filesystem                              Size               Description
  ------------------------------------------------------------- --------------------------------------- ------------------ ---------------------------
  [/dev/sda1]{style="font-family: monospace; font-size: 95%"}   (bootloader)                            2M                 BIOS boot partition
  [/dev/sda2]{style="font-family: monospace; font-size: 95%"}   ext2 (or fat32 if UEFI is being used)   128M               Boot/EFI system partition
  [/dev/sda3]{style="font-family: monospace; font-size: 95%"}   (swap)                                  512M or higher     Swap partition
  [/dev/sda4]{style="font-family: monospace; font-size: 95%"}   ext4                                    Rest of the disk   Root partition

If this suffices and the reader going the GPT route they can immediately
jump to [Default: Using parted to partition the
disk](#Default:_Using_parted_to_partition_the_disk). Those who are still
interested in MBR (hey - it happens!) and using the example layout can
jump to [Alternative: Using fdisk to partition the
disk](#Alternative:_Using_fdisk_to_partition_the_disk).

Both [fdisk]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} and
[parted]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} are
partitioning utilities. [fdisk]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} is
well known, stable, and recommended for the MBR partition layout while
[parted]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} was
one of the first Linux block device management utilities to support GPT
partitions. Those who like the user interface of
[fdisk]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} can
use [gdisk]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} (GPT
fdisk) as an alternative to [parted]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}.

Before going to the creation instructions, the first set of sections
will describe in more detail how partitioning schemes can be created and
mention some common pitfalls.

[Designing a partition scheme]{#Designing_a_partition_scheme .mw-headline}
--------------------------------------------------------------------------

### []{#How_many_partitions_and_how_big?}[How many partitions and how big?]{#How_many_partitions_and_how_big.3F .mw-headline}

The number of partitions is highly dependent on the environment. For
instance, if there are lots of users, then it is advised to have
[/home/]{style="font-family: monospace; font-size: 95%"} separate as it
increases security and makes backups easier. If Gentoo is being
installed to perform as a mail server, then
[/var/]{style="font-family: monospace; font-size: 95%"} should be
separate as all mails are stored inside
[/var/]{style="font-family: monospace; font-size: 95%"}. A good choice
of filesystem will then maximize the performance. Game servers will have
a separate [/opt/]{style="font-family: monospace; font-size: 95%"} as
most gaming servers are installed there. The reason is similar for the
[/home/]{style="font-family: monospace; font-size: 95%"} directory:
security and backups. In most situations,
[/usr/]{style="font-family: monospace; font-size: 95%"} is to be kept
big: not only will it contain the majority of applications, it typically
also hosts the Gentoo ebuild repository (by default located at
[/var/db/repos/gentoo]{style="font-family: monospace; font-size: 95%"})
which already takes around 650 MiB. This disk space estimate *excludes*
the [binpkgs/]{style="font-family: monospace; font-size: 95%"} and
[distfiles/]{style="font-family: monospace; font-size: 95%"} directories
that are stored under
[/var/cache/]{style="font-family: monospace; font-size: 95%"} by
default.

It very much depends on what the administrator wants to achieve.
Separate partitions or volumes have the following advantages:

-   Choose the best performing filesystem for each partition or volume.
-   The entire system cannot run out of free space if one defunct tool
    is continuously writing files to a partition or volume.
-   If necessary, file system checks are reduced in time, as multiple
    checks can be done in parallel (although this advantage is more with
    multiple disks than it is with multiple partitions).
-   Security can be enhanced by mounting some partitions or volumes
    read-only, `nosuid` (setuid bits are ignored), `noexec` (executable
    bits are ignored), etc.

However, multiple partitions have disadvantages as well. If not
configured properly, the system might have lots of free space on one
partition and none on another. Another nuisance is that separate
partitions - especially for important mount points like
[/usr/]{style="font-family: monospace; font-size: 95%"} or
[/var/]{style="font-family: monospace; font-size: 95%"} - often require
the administrator to boot with an initramfs to mount the partition
before other boot scripts start. This isn\'t always the case though, so
results may vary.

There is also a 15-partition limit for SCSI and SATA unless the disk
uses GPT labels.

### []{#What_about_swap_space?}[What about swap space?]{#What_about_swap_space.3F .mw-headline}

There is no perfect value for the swap partition. The purpose of swap
space is to provide disk storage to the kernel when internal memory
(RAM) is under pressure. A swap space allows for the kernel to move
memory pages that are not likely to be accessed soon to disk (swap or
page-out), freeing memory. Of course, if that memory is suddenly needed,
these pages need to be put back in memory (page-in) which will take a
while (as disks are very slow compared to internal memory).

When the system is not going to run memory intensive applications or the
system has lots of memory available, then it probably does not need much
swap space. However, swap space is also used to store the entire memory
in case of hibernation. If the system is going to need hibernation, then
a bigger swap space is necessary, often at least the amount of memory
installed in the system.

\

### []{#What_is_the_BIOS_boot_partition?}[What is the BIOS boot partition?]{#What_is_the_BIOS_boot_partition.3F .mw-headline}

A BIOS boot partition is a very small (1 to 2 MB) partition in which
boot loaders like GRUB2 can put additional data that doesn\'t fit in the
allocated storage (a few hundred bytes in case of MBR) and cannot be
placed elsewhere.

Such partitions are not always necessary, but considering the low space
consumption and the difficulties we have with documenting the plethora
of partitioning differences otherwise, it is recommended to create it in
either case.

For completeness, the BIOS boot partition is needed when a GPT partition
layout is used with GRUB2 in PC/BIOS mode. It is not required when
booting in EFI/UEFI mode.

[Default: Using parted to partition the disk]{#Default:_Using_parted_to_partition_the_disk .mw-headline}
--------------------------------------------------------------------------------------------------------

In this chapter, the example partition layout mentioned earlier in the
instructions will be used:

  Partition                                                     Description
  ------------------------------------------------------------- ---------------------
  [/dev/sda1]{style="font-family: monospace; font-size: 95%"}   BIOS boot partition
  [/dev/sda2]{style="font-family: monospace; font-size: 95%"}   Boot partition
  [/dev/sda3]{style="font-family: monospace; font-size: 95%"}   Swap partition
  [/dev/sda4]{style="font-family: monospace; font-size: 95%"}   Root partition

Change the partition layout according to personal preference.

### [Viewing the current partition layout with parted]{#Viewing_the_current_partition_layout_with_parted .mw-headline}

The [parted]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
application offers a simple interface for partitioning the disks and
supports very large partitions (more than 2 TB). Fire up
[parted]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
against the disk (in our example, we use
[/dev/sda]{style="font-family: monospace; font-size: 95%"}). It is
recommended to ask [parted]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} to
use optimal partition alignment:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`parted -a optimal /dev/sda`

</div>

    GNU Parted 2.3
    Using /dev/sda
    Welcome to GNU Parted! Type 'help' to view a list of commands.
:::

Alignment means that partitions are started on well-known boundaries
within the disk, ensuring that operations on the disk from the operating
system level (retrieve pages from the disk) use the least amount of
internal disk operations. Misaligned partitions might require the disk
to fetch two pages instead of one even if the operating system asked for
a single page.

To find out about all options supported by parted, type
[help]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} and
press return.

### [Setting the GPT label]{#Setting_the_GPT_label .mw-headline}

Most disks on the
**[x86]{style="font-family: monospace; font-size: 95%; color: #54487a"}**
or
**[amd64]{style="font-family: monospace; font-size: 95%; color: #54487a"}**
architectures are prepared using an *msdos* label. Using
[parted]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}, the
command to put a GPT label on the disk is [mklabel
gpt]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}:

::: {.alert .alert-danger .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Warning**\
Changing the partition type will remove all partitions from the disk.
All data on the disk will be lost.
:::

::: {.cmd-box}
<div>

`(parted)`{style="color: #4E9A06; font-weight: bold;"}[]{.tripleclick-separator}`mklabel gpt`

</div>
:::

To have the disk with MBR layout, use [mklabel
msdos]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}.

### [Removing all partitions with parted]{#Removing_all_partitions_with_parted .mw-headline}

If this isn\'t done yet (for instance through the
[mklabel]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
operation earlier, or because the disk is a freshly formatted one),
first remove all existing partitions from the disk. Type
[print]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} to
view the current partitions, and [rm \<N\>]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
where `<N>` is the number of the partition to remove.

::: {.cmd-box}
<div>

`(parted)`{style="color: #4E9A06; font-weight: bold;"}[]{.tripleclick-separator}`rm 2`

</div>
:::

Do the same for all other partitions that aren\'t needed. However, make
sure to not make any mistakes here - parted executes the changes
immediately (unlike [fdisk]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
which stages them, allowing a user to \"undo\" his changes before saving
or exiting fdisk).

### [Creating the partitions]{#Creating_the_partitions .mw-headline}

Now [parted]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} will
be used to create the partitions with the following settings:

-   The partition type to use. This usually is *primary*. If the msdos
    partition label is used, keep in mind that there can be no more than
    4 primary partitions. If more than 4 partitions are needed, make one
    of the first four partitions extended and create logical partitions
    inside it.
-   The start location of a partition (which can be expressed in MB, GB,
    \...)
-   The end location of the partition (which can be expressed in MB, GB,
    \...)

First, tell parted that the size unit we work with is megabytes
(actually mebibytes, abbreviated as MiB which is the \"standard\"
notation, but we will use MB in the text throughout as it is much more
common):

::: {.cmd-box}
<div>

`(parted)`{style="color: #4E9A06; font-weight: bold;"}[]{.tripleclick-separator}`unit mib`

</div>
:::

Now create a 2 MB partition that will be used by the GRUB2 boot loader
later. Use the [mkpart]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
command for this, and inform [parted]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} to
start from 1 MB and end at 3 MB (creating a partition of 2 MB in size).

::: {.cmd-box}
<div>

`(parted)`{style="color: #4E9A06; font-weight: bold;"}[]{.tripleclick-separator}`mkpart primary 1 3`

</div>

<div>

`(parted)`{style="color: #4E9A06; font-weight: bold;"}[]{.tripleclick-separator}`name 1 grub`

</div>

<div>

`(parted)`{style="color: #4E9A06; font-weight: bold;"}[]{.tripleclick-separator}`set 1 bios_grub on`

</div>

<div>

`(parted)`{style="color: #4E9A06; font-weight: bold;"}[]{.tripleclick-separator}`print`

</div>

    Model: Virtio Block Device (virtblk)
    Disk /dev/sda: 20480MiB
    Sector size (logical/physical): 512B/512B
    Partition Table: gpt
      
    Number   Start      End      Size     File system  Name   Flags
     1       1.00MiB    3.00MiB  2.00MiB               grub   bios_grub
:::

Do the same for the boot partition (128 MB), swap partition (in the
example, 512 MB) and the root partition that spans the remaining disk
(for which the end location is marked as -1, meaning the end of the disk
minus one MB, which is the farthest a partition can go).

::: {.cmd-box}
<div>

`(parted)`{style="color: #4E9A06; font-weight: bold;"}[]{.tripleclick-separator}`mkpart primary 3 131`

</div>

<div>

`(parted)`{style="color: #4E9A06; font-weight: bold;"}[]{.tripleclick-separator}`name 2 boot`

</div>

<div>

`(parted)`{style="color: #4E9A06; font-weight: bold;"}[]{.tripleclick-separator}`mkpart primary 131 643`

</div>

<div>

`(parted)`{style="color: #4E9A06; font-weight: bold;"}[]{.tripleclick-separator}`name 3 swap`

</div>

<div>

`(parted)`{style="color: #4E9A06; font-weight: bold;"}[]{.tripleclick-separator}`mkpart primary 643 -1`

</div>

<div>

`(parted)`{style="color: #4E9A06; font-weight: bold;"}[]{.tripleclick-separator}`name 4 rootfs`

</div>
:::

When using the UEFI interface to boot the system (instead of BIOS), mark
the boot partition as the EFI System Partition. Parted does this
automatically when the *boot* option is set on the partition:

::: {.cmd-box}
<div>

`(parted)`{style="color: #4E9A06; font-weight: bold;"}[]{.tripleclick-separator}`set 2 boot on`

</div>
:::

The end result looks like so:

::: {.cmd-box}
<div>

`(parted)`{style="color: #4E9A06; font-weight: bold;"}[]{.tripleclick-separator}`print`

</div>

    Model: Virtio Block Device (virtblk)
    Disk /dev/sda: 20480MiB
    Sector size (logical/physical): 512B/512B
    Partition Table: gpt
      
    Number   Start      End      Size     File system  Name   Flags
     1       1.00MiB    3.00MiB  2.00MiB               grub   bios_grub
     2       3.00MiB    131MiB   128MiB                boot   boot
     3       131MiB     643MiB   512MiB                swap
     4       643MiB     20479MiB 19836MiB              rootfs
:::

::: {.alert .alert-info .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Note**\
On an UEFI installation, the boot and esp flags will show up on the boot
partition.
:::

Use the [quit]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
command to exit parted.

With partitioning completed, jump down to the section on [creating file
systems](/wiki/Handbook:AMD64/Installation/Disks#Creating_file_systems "Handbook:AMD64/Installation/Disks").

[Alternative: Using fdisk to partition the disk]{#Alternative:_Using_fdisk_to_partition_the_disk .mw-headline}
--------------------------------------------------------------------------------------------------------------

::: {.alert .alert-info .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Note**\
Although recent [fdisk]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
should support GPT, it has still shown to have some issues with it. The
instructions given below assume that the partition layout being used is
MBR.
:::

The following parts explain how to create the example partition layout
using [fdisk]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}. The
example partition layout was mentioned earlier:

  Partition                                                     Description
  ------------------------------------------------------------- ---------------------
  [/dev/sda1]{style="font-family: monospace; font-size: 95%"}   BIOS boot partition
  [/dev/sda2]{style="font-family: monospace; font-size: 95%"}   Boot partition
  [/dev/sda3]{style="font-family: monospace; font-size: 95%"}   Swap partition
  [/dev/sda4]{style="font-family: monospace; font-size: 95%"}   Root partition

Change the partition layout according to personal preference.

### [Viewing the current partition layout]{#Viewing_the_current_partition_layout .mw-headline}

[fdisk]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} is a
popular and powerful tool to split a disk into partitions. Fire up
[fdisk]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
against the disk (in our example, we use
[/dev/sda]{style="font-family: monospace; font-size: 95%"}):

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`fdisk /dev/sda`

</div>
:::

::: {.alert .alert-info .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Note**\
To use GPT support, add `-t gpt`. It is recommended to closely
investigate the [fdisk]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
output in case more recent developments in
[fdisk]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
change its default behavior of defaulting to MBR. The remainder of the
instructions assume an MBR layout.
:::

Use the [p]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}
key to display the disk\'s current partition configuration:

::: {.cmd-box}
<div>

`Command (m for help):`{style="color: #4E9A06; font-weight: bold;"}[]{.tripleclick-separator}`p`

</div>

    Disk /dev/sda: 240 heads, 63 sectors, 2184 cylinders
    Units = cylinders of 15120 * 512 bytes
      
       Device Boot    Start       End    Blocks   Id  System
    /dev/sda1   *         1        14    105808+  83  Linux
    /dev/sda2            15        49    264600   82  Linux swap
    /dev/sda3            50        70    158760   83  Linux
    /dev/sda4            71      2184  15981840    5  Extended
    /dev/sda5            71       209   1050808+  83  Linux
    /dev/sda6           210       348   1050808+  83  Linux
    /dev/sda7           349       626   2101648+  83  Linux
    /dev/sda8           627       904   2101648+  83  Linux
    /dev/sda9           905      2184   9676768+  83  Linux
:::

This particular disk was configured to house seven Linux filesystems
(each with a corresponding partition listed as \"Linux\") as well as a
swap partition (listed as \"Linux swap\").

### [Removing all partitions with fdisk]{#Removing_all_partitions_with_fdisk .mw-headline}

First remove all existing partitions from the disk. Type [d]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}
to delete a partition. For instance, to delete an existing
[/dev/sda1]{style="font-family: monospace; font-size: 95%"}:

::: {.cmd-box}
<div>

`Command (m for help):`{style="color: #4E9A06; font-weight: bold;"}[]{.tripleclick-separator}`d`

</div>

    Partition number (1-4): 1
:::

The partition has now been scheduled for deletion. It will no longer
show up when printing the list of partitions ([p]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"},
but it will not be erased until the changes have been saved. This allows
users to abort the operation if a mistake was made - in that case, type
[q]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}
immediately and hit [Enter]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}
and the partition will not be deleted.

Repeatedly type [p]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}
to print out a partition listing and then type [d]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}
and the number of the partition to delete it. Eventually, the partition
table will be empty:

::: {.cmd-box}
<div>

`Command (m for help):`{style="color: #4E9A06; font-weight: bold;"}[]{.tripleclick-separator}`p`

</div>

    Disk /dev/sda: 30.0 GB, 30005821440 bytes
    240 heads, 63 sectors/track, 3876 cylinders
    Units = cylinders of 15120 * 512 = 7741440 bytes
      
    Device Boot    Start       End    Blocks   Id  System
:::

Now that the in-memory partition table is empty, we\'re ready to create
the partitions.

### [Creating the BIOS boot partition]{#Creating_the_BIOS_boot_partition .mw-headline}

First create a very small BIOS boot partition. Type [n]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}
to create a new partition, then [p]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}
to select a primary partition, followed by [1]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}
to select the first primary partition. When prompted for the first
sector, make sure it starts from 2048 (which is needed for the boot
loader) and hit [Enter]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}.
When prompted for the last sector, type +2M to create a partition 2
Mbyte in size:

::: {.alert .alert-info .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Note**\
The start from sector 2048 is a fail-safe in case the boot loader does
not detect this partition as being available for its use.
:::

::: {.cmd-box}
<div>

`Command (m for help):`{style="color: #4E9A06; font-weight: bold;"}[]{.tripleclick-separator}`n`

</div>

    Command action
      e   extended
      p   primary partition (1-4)
    p
    Partition number (1-4): 1
    First sector (64-10486533532, default 64): 2048
    Last sector, +sectors +size{M,K,G} (4096-10486533532, default 10486533532): +2M
:::

Mark the partition for UEFI purposes:

::: {.cmd-box}
<div>

`Command (m for help):`{style="color: #4E9A06; font-weight: bold;"}[]{.tripleclick-separator}`t`

</div>

    Selected partition 1
    Hex code (type L to list codes): 4
    Changed system type of partition 1 to 4 (BIOS boot)
:::

::: {.alert .alert-info .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Note**\
Using UEFI with MBR partition layout is discouraged. If an UEFI capable
system is used, please use GPT layout.
:::

### [Creating the boot partition]{#Creating_the_boot_partition .mw-headline}

Now create a small boot partition. Type [n]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}
to create a new partition, then [p]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}
to select a primary partition, followed by [2]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}
to select the second primary partition. When prompted for the first
sector, accept the default by hitting [Enter]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}.
When prompted for the last sector, type +128M to create a partition 128
Mbyte in size:

::: {.cmd-box}
<div>

`Command (m for help):`{style="color: #4E9A06; font-weight: bold;"}[]{.tripleclick-separator}`n`

</div>

    Command action
      e   extended
      p   primary partition (1-4)
    p
    Partition number (1-4): 2
    First sector (5198-10486533532, default 5198): (Hit enter)
    Last sector, +sectors +size{M,K,G} (4096-10486533532, default 10486533532): +128M
:::

Now, when pressing [p]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"},
the following partition printout is displayed:

::: {.cmd-box}
<div>

`Command (m for help):`{style="color: #4E9A06; font-weight: bold;"}[]{.tripleclick-separator}`p`

</div>

    Disk /dev/sda: 30.0 GB, 30005821440 bytes
    240 heads, 63 sectors/track, 3876 cylinders
    Units = cylinders of 15120 * 512 = 7741440 bytes
      
       Device Boot    Start       End    Blocks   Id  System
    /dev/sda1             1         3      5198+  ef  EFI (FAT-12/16/32)
    /dev/sda2             3        14    105808+  83  Linux
:::

Type [a]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}
to toggle the bootable flag on a partition and select [2]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}.
After pressing [p]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}
again, notice that an \* is placed in the \"Boot\" column.

### [Creating the swap partition]{#Creating_the_swap_partition .mw-headline}

To create the swap partition, type [n]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}
to create a new partition, then [p]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}
to tell fdisk to create a primary partition. Then type [3]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}
to create the third primary partition,
[/dev/sda3]{style="font-family: monospace; font-size: 95%"}. When
prompted for the first sector, hit [Enter]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}.
When prompted for the last sector, type +512M (or any other size needed
for the swap space) to create a partition 512MB in size.

After all this is done, type [t]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}
to set the partition type, [3]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}
to select the partition just created and then type in *82* to set the
partition type to \"Linux Swap\".

### [Creating the root partition]{#Creating_the_root_partition .mw-headline}

Finally, to create the root partition, type [n]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}
to create a new partition, then [p]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}
to tell [fdisk]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} to
create a primary partition. Then type [4]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}
to create the fourth primary partition,
[/dev/sda4]{style="font-family: monospace; font-size: 95%"}. When
prompted for the first sector, hit [Enter]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}.
When prompted for the last sector, hit [Enter]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}
to create a partition that takes up the rest of the remaining space on
the disk. After completing these steps, typing [p]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}
should display a partition table that looks similar to this:

::: {.cmd-box}
<div>

`Command (m for help):`{style="color: #4E9A06; font-weight: bold;"}[]{.tripleclick-separator}`p`

</div>

    Disk /dev/sda: 30.0 GB, 30005821440 bytes
    240 heads, 63 sectors/track, 3876 cylinders
    Units = cylinders of 15120 * 512 = 7741440 bytes
      
       Device Boot    Start       End    Blocks   Id  System
    /dev/sda1             1         3      5198+  ef  EFI (FAT-12/16/32)
    /dev/sda2   *         3        14    105808+  83  Linux
    /dev/sda3            15        81    506520   82  Linux swap
    /dev/sda4            82      3876  28690200   83  Linux
:::

### [Saving the partition layout]{#Saving_the_partition_layout .mw-headline}

To save the partition layout and exit [fdisk]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"},
type [w]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}.

::: {.cmd-box}
<div>

`Command (m for help):`{style="color: #4E9A06; font-weight: bold;"}[]{.tripleclick-separator}`w`

</div>
:::

With the partitions created, it is now time to put filesystems on them.

\

[Creating file systems]{#Creating_file_systems .mw-headline}
------------------------------------------------------------

### [Introduction]{#Introduction_2 .mw-headline}

Now that the partitions are created, it is time to place a filesystem on
them. In the next section the various file systems that Linux supports
are described. Readers that already know which filesystem to use can
continue with [Applying a filesystem to a
partition](#Applying_a_filesystem_to_a_partition). The others should
read on to learn about the available filesystems\...

### [Filesystems]{#Filesystems .mw-headline}

Several filesystems are available. Some of them are found stable on the
amd64 architecture - it is advised to read up on the filesystems and
their support state before selecting a more experimental one for
important partitions.

[btrfs](/wiki/Btrfs "Btrfs")
:   A next generation filesystem that provides many advanced features
    such as snapshotting, self-healing through checksums, transparent
    compression, subvolumes, and integrated RAID. A few distributions
    have begun to ship it as an out-of-the-box option, but it is not
    production ready. Reports of filesystem corruption are common. Its
    developers urge people to run the latest kernel version for safety
    because the older ones have known problems. This has been the case
    for years and it is too early to tell if things have changed. Fixes
    for corruption issues are rarely backported to older kernels.
    Proceed with caution when using this filesystem!

ext2
:   This is the tried and true Linux filesystem but doesn\'t have
    metadata journaling, which means that routine ext2 filesystem checks
    at startup time can be quite time-consuming. There is now quite a
    selection of newer-generation journaled filesystems that can be
    checked for consistency very quickly and are thus generally
    preferred over their non-journaled counterparts. Journaled
    filesystems prevent long delays when the system is booted and the
    filesystem happens to be in an inconsistent state.

ext3
:   The journaled version of the ext2 filesystem, providing metadata
    journaling for fast recovery in addition to other enhanced
    journaling modes like full data and ordered data journaling. It uses
    an HTree index that enables high performance in almost all
    situations. In short, ext3 is a very good and reliable filesystem.

[ext4](/wiki/Ext4 "Ext4")
:   Initially created as a fork of ext3, ext4 brings new features,
    performance improvements, and removal of size limits with moderate
    changes to the on-disk format. It can span volumes up to 1 EB and
    with maximum file size of 16TB. Instead of the classic ext2/3 bitmap
    block allocation ext4 uses extents, which improve large file
    performance and reduce fragmentation. Ext4 also provides more
    sophisticated block allocation algorithms (delayed allocation and
    multiblock allocation) giving the filesystem driver more ways to
    optimize the layout of data on the disk. Ext4 is the recommended
    all-purpose all-platform filesystem.

[f2fs](/wiki/F2fs "F2fs"){.mw-redirect}
:   The Flash-Friendly File System was originally created by Samsung for
    the use with NAND flash memory. As of Q2, 2016, this filesystem is
    still considered immature, but it is a decent choice when installing
    Gentoo to microSD cards, USB drives, or other flash-based storage
    devices.

JFS
:   IBM\'s high-performance journaling filesystem. JFS is a light, fast
    and reliable B+tree-based filesystem with good performance in
    various conditions.

ReiserFS
:   A B+tree-based journaled filesystem that has good overall
    performance, especially when dealing with many tiny files at the
    cost of more CPU cycles. ReiserFS is not included in the mainline
    Linux kernel, and therefore is not recommended to be used when
    initially installing Gentoo.

[XFS](/wiki/XFS "XFS")
:   A filesystem with metadata journaling which comes with a robust
    feature-set and is optimized for scalability. XFS seems to be less
    forgiving to various hardware problems, but has been continuously
    upgraded to include modern features.

[VFAT](/wiki/VFAT "VFAT"){.mw-redirect}
:   Also known as FAT32, is supported by Linux but does not support
    standard UNIX permission settings. It is mostly used for
    interoperability with other operating systems (Microsoft Windows or
    Apple\'s OSX) but is also a necessity for some system bootloader
    firmware (like UEFI).

[NTFS](/wiki/NTFS "NTFS")
:   This \"New Technology\" filesystem is the flagship filesystem of
    Microsoft Windows since Windows 3.1. Similar to vfat above it does
    not store UNIX permission settings or extended attributes necessary
    for BSD or Linux to function properly, therefore it should not be
    used as a root filesystem. It should *only* be used for
    interoperability with Microsoft Windows systems (note the emphasis
    on *only*).

When using ext2, ext3, or ext4 on a small partition (less than 8GB),
then the file system must be created with the proper options to reserve
enough inodes. The [mke2fs]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
([mkfs.ext2]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"})
application uses the \"bytes-per-inode\" setting to calculate the number
of inodes for a file system. On smaller partitions, it is advised to
increase the calculated number of inodes.

On ext2, ext3 and ext4, this can be done using one of the following
commands, respectively:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`mkfs.ext2 -T small /dev/<device>`

</div>

<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`mkfs.ext3 -T small /dev/<device>`

</div>

<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`mkfs.ext4 -T small /dev/<device>`

</div>
:::

This will generally quadruple the number of inodes for a given file
system as its \"bytes-per-inode\" reduces from one every 16kB to one
every 4kB. This can be tuned even further by providing the ratio:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`mkfs.ext2 -i <ratio> /dev/<device>`

</div>
:::

### [Applying a filesystem to a partition]{#Applying_a_filesystem_to_a_partition .mw-headline}

To create a filesystem on a partition or volume, there are user space
utilities available for each possible filesystem. Click the
filesystem\'s name in the table below for additional information on each
filesystem:

  Filesystem                                                                                           Creation command                                                                                             On minimal CD?                     Package
  ---------------------------------------------------------------------------------------------------- ------------------------------------------------------------------------------------------------------------ ---------------------------------- ----------------------------------------------------------------------------------------------------
  [btrfs](/wiki/Btrfs "Btrfs")                                                                         [mkfs.btrfs]{.tripleclick-separator style="font-family: monospace; font-size: 95%; font-weight: bold;"}      []{.glyphicon .glyphicon-ok} Yes   [sys-fs/btrfs-progs](https://packages.gentoo.org/packages/sys-fs/btrfs-progs){.external .text}
  [ext2](/wiki/Ext2 "Ext2")                                                                            [mkfs.ext2]{.tripleclick-separator style="font-family: monospace; font-size: 95%; font-weight: bold;"}       []{.glyphicon .glyphicon-ok} Yes   [sys-fs/e2fsprogs](https://packages.gentoo.org/packages/sys-fs/e2fsprogs){.external .text}
  [ext3](/wiki/Ext3 "Ext3")                                                                            [mkfs.ext3]{.tripleclick-separator style="font-family: monospace; font-size: 95%; font-weight: bold;"}       []{.glyphicon .glyphicon-ok} Yes   [sys-fs/e2fsprogs](https://packages.gentoo.org/packages/sys-fs/e2fsprogs){.external .text}
  [ext4](/wiki/Ext4 "Ext4")                                                                            [mkfs.ext4]{.tripleclick-separator style="font-family: monospace; font-size: 95%; font-weight: bold;"}       []{.glyphicon .glyphicon-ok} Yes   [sys-fs/e2fsprogs](https://packages.gentoo.org/packages/sys-fs/e2fsprogs){.external .text}
  [f2fs](/wiki/F2FS "F2FS")                                                                            [mkfs.f2fs]{.tripleclick-separator style="font-family: monospace; font-size: 95%; font-weight: bold;"}       []{.glyphicon .glyphicon-ok} Yes   [sys-fs/f2fs-tools](https://packages.gentoo.org/packages/sys-fs/f2fs-tools){.external .text}
  [jfs](/wiki/JFS "JFS")                                                                               [mkfs.jfs]{.tripleclick-separator style="font-family: monospace; font-size: 95%; font-weight: bold;"}        []{.glyphicon .glyphicon-ok} Yes   [sys-fs/jfsutils](https://packages.gentoo.org/packages/sys-fs/jfsutils){.external .text}
  [reiserfs](/index.php?title=Reiserfs&action=edit&redlink=1 "Reiserfs (page does not exist)"){.new}   [mkfs.reiserfs]{.tripleclick-separator style="font-family: monospace; font-size: 95%; font-weight: bold;"}   []{.glyphicon .glyphicon-ok} Yes   [sys-fs/reiserfsprogs](https://packages.gentoo.org/packages/sys-fs/reiserfsprogs){.external .text}
  [xfs](/wiki/XFS "XFS")                                                                               [mkfs.xfs]{.tripleclick-separator style="font-family: monospace; font-size: 95%; font-weight: bold;"}        []{.glyphicon .glyphicon-ok} Yes   [sys-fs/xfsprogs](https://packages.gentoo.org/packages/sys-fs/xfsprogs){.external .text}
  [vfat](/wiki/FAT "FAT")                                                                              [mkfs.vfat]{.tripleclick-separator style="font-family: monospace; font-size: 95%; font-weight: bold;"}       []{.glyphicon .glyphicon-ok} Yes   [sys-fs/dosfstools](https://packages.gentoo.org/packages/sys-fs/dosfstools){.external .text}
  [NTFS](/wiki/NTFS "NTFS")                                                                            [mkfs.ntfs]{.tripleclick-separator style="font-family: monospace; font-size: 95%; font-weight: bold;"}       []{.glyphicon .glyphicon-ok} Yes   [sys-fs/ntfs3g](https://packages.gentoo.org/packages/sys-fs/ntfs3g){.external .text}

For instance, to have the boot partition
([/dev/sda2]{style="font-family: monospace; font-size: 95%"}) in ext2
and the root partition
([/dev/sda4]{style="font-family: monospace; font-size: 95%"}) in ext4 as
used in the example partition structure, the following commands would be
used:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`mkfs.ext2 /dev/sda2`

</div>
:::

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`mkfs.ext4 /dev/sda4`

</div>
:::

Now create the filesystems on the newly created partitions (or logical
volumes).

### [Activating the swap partition]{#Activating_the_swap_partition .mw-headline}

[mkswap]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} is
the command that is used to initialize swap partitions:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`mkswap /dev/sda3`

</div>
:::

To activate the swap partition, use [swapon]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`swapon /dev/sda3`

</div>
:::

Create and activate the swap with the commands mentioned above.

[Mounting the root partition]{#Mounting_the_root_partition .mw-headline}
------------------------------------------------------------------------

Now that the partitions are initialized and are housing a filesystem, it
is time to mount those partitions. Use the
[mount]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
command, but don\'t forget to create the necessary mount directories for
every partition created. As an example we mount the root partition:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`mount /dev/sda4 /mnt/gentoo`

</div>
:::

::: {.alert .alert-info .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Note**\
If [/tmp/]{style="font-family: monospace; font-size: 95%"} needs to
reside on a separate partition, be sure to change its permissions after
mounting:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`chmod 1777 /mnt/gentoo/tmp`

</div>
:::

This also holds for
[/var/tmp]{style="font-family: monospace; font-size: 95%"}.
:::

Later in the instructions the proc filesystem (a virtual interface with
the kernel) as well as other kernel pseudo-filesystems will be mounted.
But first we [install the Gentoo installation
files](/wiki/Handbook:AMD64/Installation/Stage "Handbook:AMD64/Installation/Stage").

\

\

\

\

\

[Installing a stage tarball]{#Installing_a_stage_tarball .mw-headline}
----------------------------------------------------------------------

### [Setting the date and time]{#Setting_the_date_and_time .mw-headline}

Before installing Gentoo, it is a good idea to be sure the date and time
are set correctly. A mis-configured clock may lead to strange results:
base system files should be extracted with accurate time stamps. In
fact, due to several websites and services using encrypted
communications (SSL/TLS), it might not be possible to download the
installation files at all if the system clock is too far skewed!

Verify the current date and time by running the
[date]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
command:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`date`

</div>

    Mon Oct  3 13:16:22 PDT 2016
:::

If the date/time displayed is wrong, update it using one of the methods
below.

::: {.alert .alert-info .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Note**\
Motherboards that do not include a Real-Time Clock (RTC) should be
configured to automatically sync the system clock with a time server.
This is also true for systems that *do* include a RTC, but have a failed
battery.
:::

#### [Automatic]{#Automatic .mw-headline}

Official Gentoo installation media includes the
[ntpd]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
command (available through the
[net-misc/ntp](https://packages.gentoo.org/packages/net-misc/ntp){.external
.text} package). Official media includes a configuration file pointing
to ntp.org time servers. It can be used to automatically sync the system
clock to UTC time using a time server. Using this method requires a
[working network
configuration](/wiki/Handbook:AMD64/Installation/Networking "Handbook:AMD64/Installation/Networking")
and may not be available on all architectures.

::: {.alert .alert-danger .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Warning**\
Automatic time sync comes at a price. It will reveal the system\'s IP
address and related network information to a time server (in the case of
the example below ntp.org). Users with privacy concerns should be aware
of this *before* setting the system clock using the below method.
:::

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`ntpd -q -g`

</div>
:::

#### [Manual]{#Manual .mw-headline}

The [date]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
command can also be used to perform a manual set on the system clock.
Use the `MMDDhhmmYYYY` syntax (Month, Day, hour, minute and Year).

UTC time is recommended for all Linux systems. Later on during the
installation a timezone will be defined. This will modify the display of
the clock to local time.

For instance, to set the date to October 3rd, 13:16 in the year 2016:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`date 100313162016`

</div>
:::

### [Choosing a stage tarball]{#Choosing_a_stage_tarball .mw-headline}

#### []{#Multilib_(32_and_64-bit)}[Multilib (32 and 64-bit)]{#Multilib_.2832_and_64-bit.29 .mw-headline}

Choosing a base tarball for the system can save a considerable amount of
time later on in the installation process, specifically when it is time
to [choose a system
profile](/wiki/Handbook:AMD64/Installation/Base#Choosing_the_right_profile "Handbook:AMD64/Installation/Base").
The selection of a stage tarball will directly impact future system
configuration and can save a headache or two later on down the line. The
multilib tarball uses 64-bit libraries when possible, and only falls
back to the 32-bit versions when necessary for compatibility. This is an
excellent option for the majority of installations because it provides a
great amount of flexibility for customization in the future. Those who
desire their systems to be capable of easily switching profiles should
download the multilib tarball option for their respective processor
architecture.

Most users should not use the \'advanced\' tarballs options; they are
for specific software or hardware configurations.

#### []{#No-multilib_(pure_64-bit)}[No-multilib (pure 64-bit)]{#No-multilib_.28pure_64-bit.29 .mw-headline}

Selecting a no-multilib tarball to be the base of the system provides a
complete 64-bit operating system environment. This effectively renders
the ability to switch to multilib profiles improbable, but possible.
**Those who are just starting out with Gentoo should not choose a
no-multilib tarball unless it is absolutely necessary.**

::: {.alert .alert-danger .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Warning**\
Be aware, migrating from a no-multilib to a multilib system requires an
extremely well-working knowledge of Gentoo and the lower-level toolchain
(it may even cause our [Toolchain
developers](/wiki/Project:Toolchain "Project:Toolchain") to shudder a
little). It is not for the faint of heart and is beyond the scope of
this guide.
:::

### [Downloading the stage tarball]{#Downloading_the_stage_tarball .mw-headline}

Go to the Gentoo mount point where the root file system is mounted (most
likely [/mnt/gentoo]{style="font-family: monospace; font-size: 95%"}):

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`cd /mnt/gentoo`

</div>
:::

Depending on the installation medium, the only tool necessary to
download a stage tarball is a web browser.

#### [Graphical browsers]{#Graphical_browsers .mw-headline}

Those using environments with fully graphical web browsers will have no
problem copying a stage file URL from the main website\'s [download
section](https://www.gentoo.org/downloads/#other-arches){.external
.text}. Simply select the appropriate tab, right click the link to the
stage file, then [Copy link
address]{style="font-family: monospace; font-size: 95%"} (Firefox) or
[Copy link location]{style="font-family: monospace; font-size: 95%"}
(Chromium) to copy the link to the clipboard, then paste the link to the
[wget]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
utility on the command-line to download the stage tarball:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`wget <PASTED_STAGE_URL>`

</div>
:::

#### [Command-line browsers]{#Command-line_browsers .mw-headline}

More traditional readers or \'old timer\' Gentoo users, working
exclusively from command-line may prefer using
[links]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}, a
non-graphical, menu-driven browser. To download a stage, surf to the
Gentoo mirror list like so:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`links https://www.gentoo.org/downloads/mirrors/`

</div>
:::

To use an HTTP proxy with [links]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"},
pass on the URL with the `-http-proxy` option:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`links -http-proxy proxy.server.com:8080 https://www.gentoo.org/downloads/mirrors/`

</div>
:::

Next to [links]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
there is also the [lynx]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
browser. Like [links]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} it
is a non-graphical browser but it is not menu-driven.

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`lynx https://www.gentoo.org/downloads/mirrors/`

</div>
:::

If a proxy needs to be defined, export the `http_proxy`{.variable}
and/or `ftp_proxy`{.variable} variables:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`export http_proxy="http://proxy.server.com:port"`

</div>

<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`export ftp_proxy="http://proxy.server.com:port"`

</div>
:::

On the mirror list, select a mirror close by. Usually HTTP mirrors
suffice, but other protocols are available as well. Move to the
[releases/amd64/autobuilds/]{style="font-family: monospace; font-size: 95%"}
directory. There all available stage files are displayed (they might be
stored within subdirectories named after the individual
sub-architectures). Select one and press [d]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}
to download.

After the stage file download completes, it is possible to verify the
integrity and validate the contents of the stage tarball. Those
interested should proceed to the [next
section](#Verifying_and_validating).

Those not interested in verifying and validating the stage file can
close the command-line browser by pressing [q]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}
and can move directly to the [Unpacking the stage
tarball](#Unpacking_the_stage_tarball) section.

#### [Verifying and validating]{#Verifying_and_validating .mw-headline}

::: {.alert .alert-info .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Note**\
Some tarballs are being delivered via xz compression. When downloading a
tarball ending in
[.tar.xz]{style="font-family: monospace; font-size: 95%"}, be sure to
adjust the tarball filename from
[.tar.bz2]{style="font-family: monospace; font-size: 95%"} in the
following commands.
:::

Like with the minimal installation CDs, additional downloads to verify
and validate the stage file are available. Although these steps may be
skipped, these files are provided for users who care about the
legitimacy of the file(s) they just downloaded.

-   A [.CONTENTS]{style="font-family: monospace; font-size: 95%"} file
    that contains a list of all files inside the stage tarball.
-   A [.DIGESTS]{style="font-family: monospace; font-size: 95%"} file
    that contains checksums of the stage file in different algorithms.
-   A [.DIGESTS.asc]{style="font-family: monospace; font-size: 95%"}
    file that, like the
    [.DIGESTS]{style="font-family: monospace; font-size: 95%"} file,
    contains checksums of the stage file in different algorithms, but is
    also cryptographically signed to ensure it is provided by the Gentoo
    project.

Use [openssl]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} and
compare the output with the checksums provided by the
[.DIGESTS]{style="font-family: monospace; font-size: 95%"} or
[.DIGESTS.asc]{style="font-family: monospace; font-size: 95%"} files.

For instance, to validate the SHA512 checksum:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`openssl dgst -r -sha512 stage3-amd64-<release>.tar.?(bz2|xz)`

</div>
:::

Another way is to use the [sha512sum]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
command:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`sha512sum stage3-amd64-<release>.tar.?(bz2|xz)`

</div>
:::

To validate the Whirlpool checksum:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`openssl dgst -r -whirlpool stage3-amd64-<release>.tar.?(bz2|xz)`

</div>
:::

Compare the output of these commands with the value registered in the
[.DIGESTS(.asc)]{style="font-family: monospace; font-size: 95%"} files.
The values need to match, otherwise the downloaded file might be corrupt
(or the digests file is).

Just like with the ISO file, it is also possible to verify the
cryptographic signature of the
[.DIGESTS.asc]{style="font-family: monospace; font-size: 95%"} file
using [gpg]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} to
make sure the checksums have not been tampered with:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`gpg --verify stage3-amd64-<release>.tar.?(bz2|xz){.DIGESTS.asc,} `

</div>
:::

### [Unpacking the stage tarball]{#Unpacking_the_stage_tarball .mw-headline}

Now unpack the downloaded stage onto the system. We use
[tar]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} to
proceed:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`tar xpvf stage3-*.tar.bz2 --xattrs-include='*.*' --numeric-owner`

</div>
:::

Make sure that the same options (`xpf` and `--xattrs-include='*.*'`) are
used. The `x` stands for e**x**tract, the `p` for **p**reserve
permissions and the `f` to denote that we want to extract a **f**ile
(not standard input). `--xattrs-include='*.*'` is to include
preservation of the the extended attributes in all namespaces stored in
the archive. Finally, `--numeric-owner` is used to ensure that the user
and group IDs of the files being extracted from the tarball will remain
the same as Gentoo\'s release engineering team intended (even if
adventurous users are not using official Gentoo installation media).

Now that the stage file is unpacked, proceed with [Configuring the
compile options](#Configuring_the_compile_options).

[Configuring compile options]{#Configuring_compile_options .mw-headline}
------------------------------------------------------------------------

### [Introduction]{#Introduction_3 .mw-headline}

To optimize Gentoo, it is possible to set a couple of variables which
impacts the behavior of Portage, Gentoo\'s officially supported package
manager. All those variables can be set as environment variables (using
[export]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}) but
that isn\'t permanent. To keep the settings, Portage reads in the
[/etc/portage/make.conf]{style="font-family: monospace; font-size: 95%"}
file, a configuration file for Portage.

::: {.alert .alert-info .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Note**\
A commented listing of all possible variables can be found in
[/mnt/gentoo/usr/share/portage/config/make.conf.example]{style="font-family: monospace; font-size: 95%"}.
For a successful Gentoo installation only the variables that are
mentioned below need to be set.
:::

Fire up an editor (in this guide we use [nano]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}) to
alter the optimization variables we will discuss hereafter.

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`nano -w /mnt/gentoo/etc/portage/make.conf`

</div>
:::

From the
[make.conf.example]{style="font-family: monospace; font-size: 95%"} file
it is obvious how the file should be structured: commented lines start
with \"\#\", other lines define variables using the VARIABLE=\"content\"
syntax. Several of those variables are discussed next.

### [CFLAGS and CXXFLAGS]{#CFLAGS_and_CXXFLAGS .mw-headline}

The `CFLAGS`{.variable} and `CXXFLAGS`{.variable} variables define the
optimization flags for GCC C and C++ compilers respectively. Although
those are defined generally here, for maximum performance one would need
to optimize these flags for each program separately. The reason for this
is because every program is different. However, this is not manageable,
hence the definition of these flags in the
[make.conf]{style="font-family: monospace; font-size: 95%"} file.

In [make.conf]{style="font-family: monospace; font-size: 95%"} one
should define the optimization flags that will make the system the most
responsive generally. Don\'t place experimental settings in this
variable; too much optimization can make programs behave bad (crash, or
even worse, malfunction).

We will not explain all possible optimization options. To understand
them all, read the [GNU Online
Manual(s)](https://gcc.gnu.org/onlinedocs/){.external .text} or the gcc
info page ([info gcc]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} -
only works on a working Linux system). The
[make.conf.example]{style="font-family: monospace; font-size: 95%"} file
itself also contains lots of examples and information; don\'t forget to
read it too.

A first setting is the `-march=` or `-mtune=` flag, which specifies the
name of the target architecture. Possible options are described in the
[make.conf.example]{style="font-family: monospace; font-size: 95%"} file
(as comments). A commonly used value is *native* as that tells the
compiler to select the target architecture of the current system (the
one users are installing Gentoo on).

A second one is the `-O` flag (that is a capital O, not a zero), which
specifies the gcc optimization class flag. Possible classes are s (for
size-optimized), 0 (zero - for no optimizations), 1, 2 or even 3 for
more speed-optimization flags (every class has the same flags as the one
before, plus some extras). `-O2` is the recommended default. `-O3` is
known to cause problems when used system-wide, so we recommend to stick
to `-O2`.

Another popular optimization flag is `-pipe` (use pipes rather than
temporary files for communication between the various stages of
compilation). It has no impact on the generated code, but uses more
memory. On systems with low memory, gcc might get killed. In that case,
do not use this flag.

Using `-fomit-frame-pointer` (which doesn\'t keep the frame pointer in a
register for functions that don\'t need one) might have serious
repercussions on the debugging of applications.

When the `CFLAGS`{.variable} and `CXXFLAGS`{.variable} variables are
defined, combine the several optimization flags in one string. The
default values contained in the stage3 archive that is unpacked should
be good enough. The following one is just an example:

::: {.gw-box}
::: {.box-caption}
[CODE]{.label style="margin-right: .5em; background-color: #204A87"}
**Example `CFLAGS`{.variable} and `CXXFLAGS`{.variable} variables**
:::

``` {.captioned}
# Compiler flags to set for all languages
COMMON_FLAGS="-march=native -O2 -pipe"
# Use the same settings for both variables
CFLAGS="${COMMON_FLAGS}"
CXXFLAGS="${COMMON_FLAGS}"
```
:::

::: {.alert .alert-success .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Tip**\
Although the [GCC
optimization](/wiki/GCC_optimization "GCC optimization") article has
more information on how the various compilation options can affect a
system, the [Safe CFLAGS](/wiki/Safe_CFLAGS "Safe CFLAGS") article may
be a more practical place for beginners to start optimizing their
systems.
:::

### [MAKEOPTS]{#MAKEOPTS .mw-headline}

The `MAKEOPTS`{.variable} variable defines how many parallel
compilations should occur when installing a package. A good choice is
the number of CPUs (or CPU cores) in the system plus one, but this
guideline isn\'t always perfect.

::: {.gw-box}
::: {.box-caption}
[CODE]{.label style="margin-right: .5em; background-color: #204A87"}
**Example `MAKEOPTS`{.variable} declaration in make.conf**
:::

``` {.captioned}
MAKEOPTS="-j2"
```
:::

### []{#Ready,_set,_go!}[Ready, set, go!]{#Ready.2C_set.2C_go.21 .mw-headline}

Update the
[/mnt/gentoo/etc/portage/make.conf]{style="font-family: monospace; font-size: 95%"}
file to match personal preference and save (nano users would hit
[Ctrl]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}+[x]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}).

Then continue with [Installing the Gentoo base
system](/wiki/Handbook:AMD64/Installation/Base "Handbook:AMD64/Installation/Base").

\

\

\

\

\

[Chrooting]{#Chrooting .mw-headline}
------------------------------------

### [Optional: Selecting mirrors]{#Optional:_Selecting_mirrors .mw-headline}

#### [Distribution files]{#Distribution_files .mw-headline}

In order to download source code quickly it is recommended to select a
fast mirror. Portage will look in the
[make.conf]{style="font-family: monospace; font-size: 95%"} file for the
`GENTOO_MIRRORS`{.variable} variable and use the mirrors listed therein.
It is possible to surf to the Gentoo mirror list and search for a mirror
(or mirrors) that is close to the system\'s physical location (as those
are most frequently the fastest ones). However, we provide a nice tool
called [mirrorselect]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
which provides users with a nice interface to select the mirrors needed.
Just navigate to the mirrors of choice and press [Spacebar]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}
to select one or more mirrors.

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`mirrorselect -i -o >> /mnt/gentoo/etc/portage/make.conf`

</div>
:::

#### [Gentoo ebuild repository]{#Gentoo_ebuild_repository .mw-headline}

A second important step in selecting mirrors is to configure the Gentoo
ebuild repository via the
[/etc/portage/repos.conf/gentoo.conf]{style="font-family: monospace; font-size: 95%"}
file. This file contains the sync information needed to update the
package repository (the collection of ebuilds and related files
containing all the information Portage needs to download and install
software packages).

Configuring the repository can be done in a few simple steps. First, if
it does not exist, create the
[[repos.conf](/wiki//etc/portage/repos.conf "/etc/portage/repos.conf")]{style="font-family: monospace; font-size: 95%"}
directory:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`mkdir --parents /mnt/gentoo/etc/portage/repos.conf`

</div>
:::

Next, copy the Gentoo repository configuration file provided by Portage
to the (newly created)
[repos.conf]{style="font-family: monospace; font-size: 95%"} directory:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`cp /mnt/gentoo/usr/share/portage/config/repos.conf /mnt/gentoo/etc/portage/repos.conf/gentoo.conf`

</div>
:::

Take a peek with a text editor or by using the
[cat]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
command. The inside of the file should be in
[.ini]{style="font-family: monospace; font-size: 95%"} format and look
like this:

::: {.box-caption}
[FILE]{.label style="margin-right: .5em; background-color: #54487A"}
**`/mnt/gentoo/etc/portage/repos.conf/gentoo.conf`{style="border: none; background: none; color: #54487A; margin-right: .5em;"}**
:::

``` {.captioned}
[DEFAULT]
main-repo = gentoo
 
[gentoo]
location = /var/db/repos/gentoo
sync-type = rsync
sync-uri = rsync://rsync.gentoo.org/gentoo-portage
auto-sync = yes
sync-rsync-verify-jobs = 1
sync-rsync-verify-metamanifest = yes
sync-rsync-verify-max-age = 24
sync-openpgp-key-path = /usr/share/openpgp-keys/gentoo-release.asc
sync-openpgp-key-refresh-retry-count = 40
sync-openpgp-key-refresh-retry-overall-timeout = 1200
sync-openpgp-key-refresh-retry-delay-exp-base = 2
sync-openpgp-key-refresh-retry-delay-max = 60
sync-openpgp-key-refresh-retry-delay-mult = 4
```

The default `sync-uri`{.variable} variable value listed above will
determine a mirror location based on a rotation. This will aid in easing
bandwidth stress on Gentoo\'s infrastructure and will provide a
fail-safe in case a specific mirror is offline. It is recommended the
default URI is retained unless a local, private Portage mirror will be
used.

::: {.alert .alert-success .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Tip**\
For those interested, the official specification for Portage\'s plug-in
sync API can be found in the Portage project\'s [Sync
article](/wiki/Project:Portage/Sync "Project:Portage/Sync").
:::

### [Copy DNS info]{#Copy_DNS_info .mw-headline}

One thing still remains to be done before entering the new environment
and that is copying over the DNS information in
[/etc/resolv.conf]{style="font-family: monospace; font-size: 95%"}. This
needs to be done to ensure that networking still works even after
entering the new environment.
[/etc/resolv.conf]{style="font-family: monospace; font-size: 95%"}
contains the name servers for the network.

To copy this information, it is recommended to pass the `--dereference`
option to the [cp]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
command. This ensures that, if
[/etc/resolv.conf]{style="font-family: monospace; font-size: 95%"} is a
symbolic link, that the link\'s target file is copied instead of the
symbolic link itself. Otherwise in the new environment the symbolic link
would point to a non-existing file (as the link\'s target is most likely
not available inside the new environment).

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`cp --dereference /etc/resolv.conf /mnt/gentoo/etc/`

</div>
:::

### [Mounting the necessary filesystems]{#Mounting_the_necessary_filesystems .mw-headline}

In a few moments, the Linux root will be changed towards the new
location. To make sure that the new environment works properly, certain
filesystems need to be made available there as well.

The filesystems that need to be made available are:

-   [/proc/]{style="font-family: monospace; font-size: 95%"} which is a
    pseudo-filesystem (it looks like regular files, but is actually
    generated on-the-fly) from which the Linux kernel exposes
    information to the environment
-   [/sys/]{style="font-family: monospace; font-size: 95%"} which is a
    pseudo-filesystem, like
    [/proc/]{style="font-family: monospace; font-size: 95%"} which it
    was once meant to replace, and is more structured than
    [/proc/]{style="font-family: monospace; font-size: 95%"}
-   [/dev/]{style="font-family: monospace; font-size: 95%"} is a regular
    file system, partially managed by the Linux device manager (usually
    [udev]{.tripleclick-separator
    style="font-family: monospace; font-size: 95%; font-weight: bold;"}),
    which contains all device files

The [/proc/]{style="font-family: monospace; font-size: 95%"} location
will be mounted on
[/mnt/gentoo/proc/]{style="font-family: monospace; font-size: 95%"}
whereas the other two are bind-mounted. The latter means that, for
instance,
[/mnt/gentoo/sys/]{style="font-family: monospace; font-size: 95%"} will
actually *be* [/sys/]{style="font-family: monospace; font-size: 95%"}
(it is just a second entry point to the same filesystem) whereas
[/mnt/gentoo/proc/]{style="font-family: monospace; font-size: 95%"} is a
new mount (instance so to speak) of the filesystem.

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`mount --types proc /proc /mnt/gentoo/proc`

</div>

<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`mount --rbind /sys /mnt/gentoo/sys`

</div>

<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`mount --make-rslave /mnt/gentoo/sys`

</div>

<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`mount --rbind /dev /mnt/gentoo/dev`

</div>

<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`mount --make-rslave /mnt/gentoo/dev`

</div>
:::

::: {.alert .alert-info .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Note**\
The `--make-rslave` operations are needed for systemd support later in
the installation.
:::

::: {.alert .alert-danger .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Warning**\
When using non-Gentoo installation media, this might not be sufficient.
Some distributions make
[/dev/shm]{style="font-family: monospace; font-size: 95%"} a symbolic
link to [/run/shm/]{style="font-family: monospace; font-size: 95%"}
which, after the chroot, becomes invalid. Making
[/dev/shm/]{style="font-family: monospace; font-size: 95%"} a proper
tmpfs mount up front can fix this:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`test -L /dev/shm && rm /dev/shm && mkdir /dev/shm`

</div>

<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`mount --types tmpfs --options nosuid,nodev,noexec shm /dev/shm`

</div>
:::

Also ensure that mode 1777 is set:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}` chmod 1777 /dev/shm`

</div>
:::
:::

### [Entering the new environment]{#Entering_the_new_environment .mw-headline}

Now that all partitions are initialized and the base environment
installed, it is time to enter the new installation environment by
chrooting into it. This means that the session will change its root
(most top-level location that can be accessed) from the current
installation environment (installation CD or other installation medium)
to the installation system (namely the initialized partitions). Hence
the name, *change root* or *chroot*.

This chrooting is done in three steps:

1.  The root location is changed from
    [/]{style="font-family: monospace; font-size: 95%"} (on the
    installation medium) to
    [/mnt/gentoo/]{style="font-family: monospace; font-size: 95%"} (on
    the partitions) using chroot
2.  Some settings (those in
    [/etc/profile]{style="font-family: monospace; font-size: 95%"}) are
    reloaded in memory using the [source]{.tripleclick-separator
    style="font-family: monospace; font-size: 95%; font-weight: bold;"}
    command
3.  The primary prompt is changed to help us remember that this session
    is inside a chroot environment.

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`chroot /mnt/gentoo /bin/bash`

</div>

<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`source /etc/profile`

</div>

<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`export PS1="(chroot) ${PS1}"`

</div>
:::

From this point, all actions performed are immediately on the new Gentoo
Linux environment. Of course it is far from finished, which is why the
installation still has some sections left!

::: {.alert .alert-success .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Tip**\
If the Gentoo installation is interrupted anywhere after this point, it
*should* be possible to \'resume\' the installation at this step. There
is no need to repartition the disks again! Simply [mount the root
partition](/wiki/Handbook:AMD64/Installation/Disks#Mounting_the_root_partition "Handbook:AMD64/Installation/Disks")
and run the steps above starting with [copying the DNS
info](#Copy_DNS_info) to re-enter the working environment. This is also
useful for fixing bootloader issues. More information can be found in
the [chroot](/wiki/Chroot "Chroot") article.
:::

### [Mounting the boot partition]{#Mounting_the_boot_partition .mw-headline}

Now that the new environment has been entered, it is necessary to mount
the boot partition. This will be important when it is time to compile
the kernel and install the bootloader:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`mount /dev/sda2 /boot`

</div>
:::

[Configuring Portage]{#Configuring_Portage .mw-headline}
--------------------------------------------------------

### [Installing an ebuild repository snapshot from the web]{#Installing_an_ebuild_repository_snapshot_from_the_web .mw-headline}

Next step is to install a snapshot of the main ebuild repository. This
snapshot contains a collection of files that informs Portage about
available software titles (for installation), which profiles the system
administrator can select, package or profile specific news items, etc.

The use of [emerge-webrsync]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} is
recommended for those who are behind restrictive firewalls (because it
uses HTTP/FTP protocols for downloading the snapshot) and saves network
bandwidth. Readers who have no network or bandwidth restrictions can
happily skip down to the next section.

This will fetch the latest snapshot (which is released on a daily basis)
from one of Gentoo\'s mirrors and install it onto the system:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`emerge-webrsync`

</div>
:::

::: {.alert .alert-info .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Note**\
During this operation, [emerge-webrsync]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
might complain about a missing
[/var/db/repos/gentoo/]{style="font-family: monospace; font-size: 95%"}
location. This is to be expected and nothing to worry about - the tool
will create the location.
:::

From this point onward, Portage might mention that certain updates are
recommended to be executed. This is because system packages installed
through the stage file might have newer versions available; Portage is
now aware of new packages because of the repository snapshot. Package
updates can be safely ignored for now; updates can be delayed until
after the Gentoo installation has finished.

### [Optional: Updating the Gentoo ebuild repository]{#Optional:_Updating_the_Gentoo_ebuild_repository .mw-headline}

It is possible to update the Gentoo ebuild repository to the latest
version. The previous [emerge-webrsync]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
command will have installed a very recent snapshot (usually recent up to
24h) so this step is definitely optional.

Suppose there is a need for the last package updates (up to 1 hour),
then use [emerge \--sync]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}.
This command will use the rsync protocol to update the Gentoo ebuild
repository (which was fetched earlier on through
[emerge-webrsync]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}) to
the latest state.

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`emerge --sync`

</div>
:::

On slow terminals, like some framebuffers or serial consoles, it is
recommended to use the `--quiet` option to speed up the process:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`emerge --sync --quiet`

</div>
:::

### [Reading news items]{#Reading_news_items .mw-headline}

When the Gentoo ebuild repository is synchronized to the system, Portage
may warn the user with messages similar to the following:

::: {.cmd-box}
<div>

` * IMPORTANT: 2 news items need reading for repository 'gentoo'.`

</div>

<div>

` * Use eselect news to read news items.`

</div>
:::

News items were created to provide a communication medium to push
critical messages to users via the rsync tree. To manage them, use
[eselect news]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}. The
[eselect]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
application is a Gentoo application that allows for a common management
interface towards system changes and operations. In this case,
[eselect]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} is
asked to use its `news` module.

For the `news` module, three operations are most used:

-   With `list` an overview of the available news items is displayed.
-   With `read` the news items can be read.
-   With `purge` news items can be removed once they have been read and
    will not be reread anymore.

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`eselect news list`

</div>

<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`eselect news read`

</div>
:::

More information about the newsreader is available through its manual
page:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`man news.eselect`

</div>
:::

### [Choosing the right profile]{#Choosing_the_right_profile .mw-headline}

A *profile* is a building block for any Gentoo system. Not only does it
specify default values for `USE`{.variable}, `CFLAGS`{.variable}, and
other important variables, it also locks the system to a certain range
of package versions. These settings are all maintained by Gentoo\'s
Portage developers.

You can see what profile the system is currently using with
[eselect]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}, now
using the `profile` module:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`eselect profile list`

</div>

    Available profile symlink targets:
      [1]   default/linux/amd64/17.1 *
      [2]   default/linux/amd64/17.1/desktop
      [3]   default/linux/amd64/17.1/desktop/gnome
      [4]   default/linux/amd64/17.1/desktop/kde
:::

::: {.alert .alert-info .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Note**\
The output of the command is just an example and evolves over time.
:::

As can be seen, there are also desktop subprofiles available for some
architectures.

::: {.alert .alert-danger .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Warning**\
Profile upgrades are not to be taken lightly. When selecting the initial
profile, make sure to use profile corresponding to **the same version**
as the one initially used by stage3 (e.g. 17.0). Each new profile
version is announced through a news item containing migration
instructions. Make sure to read it and follow them before switching to a
newer profile.
:::

After viewing the available profiles for the amd64 architecture, users
can select a different profile for the system:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`eselect profile set 2`

</div>
:::

\

#### [No-multilib]{#No-multilib .mw-headline}

In order to select a pure 64-bit environment, with no 32-bit
applications or libraries, use a no-multilib profile:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`eselect profile list`

</div>

    Available profile symlink targets:
      [1]   default/linux/amd64/13.0 *
      [2]   default/linux/amd64/13.0/desktop
      [3]   default/linux/amd64/13.0/desktop/gnome
      [4]   default/linux/amd64/13.0/desktop/kde
      [5]   default/linux/amd64/13.0/no-multilib
:::

Next select the *no-multilib* profile:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`eselect profile set 5`

</div>

<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`eselect profile list`

</div>

    Available profile symlink targets:
      [1]   default/linux/amd64/13.0
      [2]   default/linux/amd64/13.0/desktop
      [3]   default/linux/amd64/13.0/desktop/gnome
      [4]   default/linux/amd64/13.0/desktop/kde
      [5]   default/linux/amd64/13.0/no-multilib *
:::

#### [systemd]{#systemd .mw-headline}

Those who desire systemd as their init system should select a profile
with `systemd` somewhere in the profile name:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`eselect profile set default/linux/amd64/13.0/systemd`

</div>

<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`eselect profile list`

</div>

    Available profile symlink targets:
      [10]  default/linux/amd64/13.0/developer
      [11]  default/linux/amd64/13.0/no-multilib
      [12]  default/linux/amd64/13.0/systemd *
      [13]  default/linux/amd64/13.0/x32
      [14]  hardened/linux/amd64
:::

::: {.alert .alert-success .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Tip**\
As seen above, full profile names can be used instead of the profile\'s
associated numerical value.
:::

\

::: {.alert .alert-info .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Note**\
The `developer` subprofile is specifically for Gentoo Linux development
and is not meant to be used by casual users.
:::

### []{#Updating_the_@world_set}[Updating the \@world set]{#Updating_the_.40world_set .mw-headline}

At this point, it is wise to update the system\'s [\@world
set](/wiki/World_set_(Portage) "World set (Portage)") so that a base can
be established.

This following step is *necessary* so the system can apply any updates
or USE flag changes which have appeared since the stage3 was built and
from any profile selection:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`emerge --askÂ --verbose --update --deep --newuse @world`

</div>
:::

::: {.alert .alert-success .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Tip**\
If a full scale desktop environment profile has been selected this
process could greatly extend the amount of time necessary for the
install process. Those in a time crunch can work by this \'rule of
thumb\': the shorter the profile name, the less specific the system\'s
[\@world set](/wiki/World_set_(Portage) "World set (Portage)"); the less
specific the \@world set, the fewer packages the system will require. In
other words:

-   Selecting `default/linux/amd64/17.1` will require very few packages
    to be updated, whereas
-   Selecting `default/linux/amd64/17.1/desktop/gnome/systemd` will
    require many packages to be installed since the init system is
    changing from OpenRC to systemd, and the GNOME desktop environment
    framework will be installed.
:::

### [Configuring the USE variable]{#Configuring_the_USE_variable .mw-headline}

`USE`{.variable} is one of the most powerful variables Gentoo provides
to its users. Several programs can be compiled with or without optional
support for certain items. For instance, some programs can be compiled
with support for GTK+ or with support for Qt. Others can be compiled
with or without SSL support. Some programs can even be compiled with
framebuffer support (svgalib) instead of X11 support (X-server).

Most distributions compile their packages with support for as much as
possible, increasing the size of the programs and startup time, not to
mention an enormous amount of dependencies. With Gentoo users can define
what options a package should be compiled with. This is where
`USE`{.variable} comes into play.

In the `USE`{.variable} variable users define keywords which are mapped
onto compile-options. For instance, `ssl` will compile SSL support in
the programs that support it. `-X` will remove X-server support (note
the minus sign in front). `gnome gtk -kde -qt4 -qt5` will compile
programs with GNOME (and GTK+) support, and not with KDE (and Qt)
support, making the system fully tweaked for GNOME (if the architecture
supports it).

The default USE settings are placed in the
[make.defaults]{style="font-family: monospace; font-size: 95%"} files of
the Gentoo profile used by the system. Gentoo uses a (complex)
inheritance system for its profiles, which we will not dive into at this
stage. The easiest way to check the currently active `USE`{.variable}
settings is to run [emerge \--info]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} and
select the line that starts with USE:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`emerge --info | grep ^USE`

</div>

    USE="X acl alsa amd64 berkdb bindist bzip2 cli cracklib crypt cxx dri ..."
:::

::: {.alert .alert-info .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Note**\
The above example is truncated, the actual list of `USE`{.variable}
values is much, much larger.
:::

A full description on the available USE flags can be found on the system
in
[/var/db/repos/gentoo/profiles/use.desc]{style="font-family: monospace; font-size: 95%"}.

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`less /var/db/repos/gentoo/profiles/use.desc`

</div>
:::

Inside the [less]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
command, scrolling can be done using the [â†‘]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}
and [â†“]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}
keys, and exited by pressing [q]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}.

As an example we show a USE setting for a KDE-based system with DVD,
ALSA, and CD recording support:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`nano -w /etc/portage/make.conf`

</div>
:::

::: {.box-caption}
[FILE]{.label style="margin-right: .5em; background-color: #54487A"}
**`/etc/portage/make.conf`{style="border: none; background: none; color: #54487A; margin-right: .5em;"}Enabling
flags for a KDE/Plasma-based system with DVD, ALSA, and CD recording
support**
:::

``` {.captioned}
USE="-gtk -gnome qt4 qt5 kde dvd alsa cdr"
```

When `USE`{.variable} is defined in
[/etc/portage/make.conf]{style="font-family: monospace; font-size: 95%"}
it is *added* (or *removed* if the USE flag starts with the [-]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}
sign) from that default list. Users who want to ignore any default USE
settings and manage it completely themselves should start the
`USE`{.variable} definition in
[make.conf]{style="font-family: monospace; font-size: 95%"} with `-*`:

::: {.box-caption}
[FILE]{.label style="margin-right: .5em; background-color: #54487A"}
**`/etc/portage/make.conf`{style="border: none; background: none; color: #54487A; margin-right: .5em;"}Ignoring
default USE flags**
:::

``` {.captioned}
USE="-* X acl alsa"
```

::: {.alert .alert-danger .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Warning**\
Although possible, setting `-*` (as seen in the example above) is
discouraged since carefully chosen USE flag defaults may be configured
for some packages to prevent conflicts and other errors.
:::

### [Optional: Configuring the ACCEPT\_LICENSE variable]{#Optional:_Configuring_the_ACCEPT_LICENSE_variable .mw-headline}

All of the Gentoo packages are tagged with the license(s) the package
falls under. This allows users to select software by specific licenses
or groups of licenses prior to installing it.

::: {.alert .alert-warning .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Important**\
The `LICENSE`{.variable} variable in an ebuild is only a guideline for
Gentoo developers and users. It is not a legal statement, and there is
no guarantee that it will reflect reality. So don\'t rely on it, but
check the package itself in depth, including all files that you use.
:::

Portage uses the `ACCEPT_LICENSE`{.variable} variable to determine which
packages to allow without prompting the user for the licenses previously
accepted. Exceptions can be made per-package in
[/etc/portage/package.license]{style="font-family: monospace; font-size: 95%"}
as well.

The license groups defined in the Gentoo repository, managed by the
[Gentoo Licenses project](/wiki/Project:Licenses "Project:Licenses"),
are:

  Group Name                 Description
  -------------------------- -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  \@GPL-COMPATIBLE           GPL compatible licenses approved by the Free Software Foundation ^[\[a\_license\ 1\]](#cite_note-1)^
  \@FSF-APPROVED             Free software licenses approved by the FSF (includes \@GPL-COMPATIBLE)
  \@OSI-APPROVED             Licenses approved by the Open Source Initiative ^[\[a\_license\ 2\]](#cite_note-2)^
  \@MISC-FREE                Misc licenses that are probably free software, i.e. follow the Free Software Definition ^[\[a\_license\ 3\]](#cite_note-3)^ but are not approved by either FSF or OSI
  \@FREE-SOFTWARE            Combines \@FSF-APPROVED, \@OSI-APPROVED and \@MISC-FREE
  \@FSF-APPROVED-OTHER       FSF-approved licenses for \"free documentation\" and \"works of practical use besides software and documentation\" (including fonts)
  \@MISC-FREE-DOCS           Misc licenses for free documents and other works (including fonts) that follow the free definition ^[\[a\_license\ 4\]](#cite_note-4)^ but are NOT listed in \@FSF-APPROVED-OTHER
  \@FREE-DOCUMENTS           Combines \@FSF-APPROVED-OTHER and \@MISC-FREE-DOCS
  \@FREE                     Metaset of all licenses with the freedom to use, share, modify and share modifications. Combines \@FREE-SOFTWARE and \@FREE-DOCUMENTS
  \@BINARY-REDISTRIBUTABLE   Licenses that at least permit free redistribution of the software in binary form. Includes \@FREE
  \@EULA                     License agreements that try to take away your rights. These are more restrictive than \"all-rights-reserved\" or require explicit approval

::: {.mw-references-wrap}
1.  [[[â†‘](#cite_ref-1)]{.mw-cite-backlink} [
    <https://www.gnu.org/licenses/license-list.html>]{.reference-text}]{#cite_note-1}
2.  [[[â†‘](#cite_ref-2)]{.mw-cite-backlink}
    [<https://www.opensource.org/licenses>]{.reference-text}]{#cite_note-2}
3.  [[[â†‘](#cite_ref-3)]{.mw-cite-backlink} [
    <https://www.gnu.org/philosophy/free-sw.html>]{.reference-text}]{#cite_note-3}
4.  [[[â†‘](#cite_ref-4)]{.mw-cite-backlink}
    [<https://freedomdefined.org/>]{.reference-text}]{#cite_note-4}
:::

Gentoo comes with a predefined value in the profiles, for example:

::: {.cmd-box}
<div>

`user $`{style="color: #4E9A06; font-weight: bold;"}[]{.tripleclick-separator}`portageq envvar ACCEPT_LICENSE`

</div>

    @FREE
:::

This can be customized system wide by changing
[/etc/portage/make.conf]{style="font-family: monospace; font-size: 95%"}.
The default value will only accept licenses that are explicitly approved
by the Free Software Foundation, the Open Source Initiative, or that
follow the Free Software Definition:

::: {.box-caption}
[FILE]{.label style="margin-right: .5em; background-color: #54487A"}
**`/etc/portage/make.conf`{style="border: none; background: none; color: #54487A; margin-right: .5em;"}Customizing
ACCEPT\_LICENSE**
:::

``` {.captioned}
ACCEPT_LICENSE="-* @FREE"
```

Per package overrides can then be added if necessary and desired, for
example:

::: {.box-caption}
[FILE]{.label style="margin-right: .5em; background-color: #54487A"}
**`/etc/portage/package.license/kernel`{style="border: none; background: none; color: #54487A; margin-right: .5em;"}Sample
license acceptance**
:::

``` {.captioned}
app-arch/unrar unRAR
sys-kernel/linux-firmware @BINARY-REDISTRIBUTABLE
sys-firmware/intel-microcode intel-ucode
```

[Optional: Using systemd as the init system]{#Optional:_Using_systemd_as_the_init_system .mw-headline}
------------------------------------------------------------------------------------------------------

The remainder of the Gentoo Handbook focuses on
[OpenRC](/wiki/OpenRC "OpenRC") (the traditional Gentoo init system) as
the default init system. If systemd is desired or if the reader will be
installing [GNOME](/wiki/GNOME "GNOME") 3.8 and later (which requires
systemd), please consult the [systemd](/wiki/Systemd "Systemd") article.
It contains instructions equivalent to the instructions in the following
sections of this Handbook. Specifically, it will walk the reader through
various init system commands ([systemctl]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}) and
systemd-specific services (such as [timedatectl]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"},
[hostnamectl]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"},
etc.) needed to establish a working systemd environment.

::: {.alert .alert-info .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Note**\
Certain applications are heavily dependent on the GNOME software
ecosystem and subsequently dependent on systemd. Readers who are unsure
if the GNOME desktop environment will be used can migrate to a systemd
profile later.
:::

[Timezone]{#Timezone .mw-headline}
----------------------------------

Select the timezone for the system. Look for the available timezones in
[/usr/share/zoneinfo/]{style="font-family: monospace; font-size: 95%"},
then write it in the
[/etc/timezone]{style="font-family: monospace; font-size: 95%"} file.

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`ls /usr/share/zoneinfo`

</div>
:::

Suppose the timezone of choice is *Europe/Brussels*:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`echo "Europe/Brussels" > /etc/timezone`

</div>
:::

Please avoid the
[/usr/share/zoneinfo/Etc/GMT\*]{style="font-family: monospace; font-size: 95%"}
timezones as their names do not indicate the expected zones. For
instance, [GMT-8]{style="font-family: monospace; font-size: 95%"} is in
fact [GMT+8]{style="font-family: monospace; font-size: 95%"}.

Next, reconfigure the
[sys-libs/timezone-data](https://packages.gentoo.org/packages/sys-libs/timezone-data){.external
.text} package, which will update the
[/etc/localtime]{style="font-family: monospace; font-size: 95%"} file
for us, based on the
[/etc/timezone]{style="font-family: monospace; font-size: 95%"} entry.
The [/etc/localtime]{style="font-family: monospace; font-size: 95%"}
file is used by the system C library to know the timezone the system is
in.

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`emerge --config sys-libs/timezone-data`

</div>
:::

[Configure locales]{#Configure_locales .mw-headline}
----------------------------------------------------

Most users will want to use only one or two locales on their system.

Locales specify not only the language that the user should use to
interact with the system, but also what the rules are for sorting
strings, displaying dates and times, etc.

The locales that a system should support should be mentioned in
[/etc/locale.gen]{style="font-family: monospace; font-size: 95%"}.

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`nano -w /etc/locale.gen`

</div>
:::

The following locales are an example to get both English (United States)
and German (Germany) with the accompanying character formats (like
UTF-8).

::: {.box-caption}
[FILE]{.label style="margin-right: .5em; background-color: #54487A"}
**`/etc/locale.gen`{style="border: none; background: none; color: #54487A; margin-right: .5em;"}Enabling
US and DE locales with the appropriate character formats**
:::

``` {.captioned}
en_US ISO-8859-1
en_US.UTF-8 UTF-8
de_DE ISO-8859-1
de_DE.UTF-8 UTF-8
```

::: {.alert .alert-danger .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Warning**\
We strongly suggest to use at least one UTF-8 locale because some
applications may require it.
:::

The next step is to run [locale-gen]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}. It
will generate all the locales specified in the
[/etc/locale.gen]{style="font-family: monospace; font-size: 95%"} file.

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`locale-gen`

</div>
:::

To verify that the selected locales are now available, run [locale
-a]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}.

Once done, it is now time to set the system-wide locale settings. Again
we use [eselect]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} for
this, now with the `locale` module.

With [eselect locale list]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}, the
available targets are displayed:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`eselect locale list`

</div>

    Available targets for the LANG variable:
      [1] C
      [2] POSIX
      [3] en_US
      [4] en_US.iso88591
      [5] en_US.utf8
      [6] de_DE
      [7] de_DE.iso88591
      [8] de_DE.iso885915
      [9] de_DE.utf8
      [ ] (free form)
:::

With [eselect locale set VALUE]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} the
correct locale can be set:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`eselect locale set 9`

</div>
:::

Manually, this can still be accomplished through the
[/etc/env.d/02locale]{style="font-family: monospace; font-size: 95%"}
file:

::: {.box-caption}
[FILE]{.label style="margin-right: .5em; background-color: #54487A"}
**`/etc/env.d/02locale`{style="border: none; background: none; color: #54487A; margin-right: .5em;"}Manually
setting system locale definitions**
:::

``` {.captioned}
LANG="de_DE.UTF-8"
LC_COLLATE="C"
```

Make sure a locale is set, as the system would otherwise display
warnings and errors during kernel builds and other software deployments
later in the installation.

Now reload the environment:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`env-update && source /etc/profile && export PS1="(chroot) ${PS1}"`

</div>
:::

We made a full [Localization
guide](/wiki/Localization/Guide "Localization/Guide") to help the user
guide through this process. Another interesting article is the
[UTF-8](/wiki/UTF-8 "UTF-8") guide for very specific information to
enable UTF-8 on the system.

\

\

\

\

\

[Installing the sources]{#Installing_the_sources .mw-headline}
--------------------------------------------------------------

The core around which all distributions are built is the Linux kernel.
It is the layer between the user programs and the system hardware.
Gentoo provides its users several possible kernel sources. A full
listing with description is available at the [Kernel overview
page](/wiki/Kernel/Overview "Kernel/Overview").

For amd64-based systems Gentoo recommends the
[sys-kernel/gentoo-sources](https://packages.gentoo.org/packages/sys-kernel/gentoo-sources){.external
.text} package.

Choose an appropriate kernel source and install it using
[emerge]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`emerge --ask sys-kernel/gentoo-sources`

</div>
:::

This will install the Linux kernel sources in
[/usr/src/]{style="font-family: monospace; font-size: 95%"} in which a
symbolic link called
[linux]{style="font-family: monospace; font-size: 95%"} will be pointing
to the installed kernel source:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`ls -l /usr/src/linux`

</div>

    lrwxrwxrwx    1 root   root    12 Oct 13 11:04 /usr/src/linux -> linux-4.9.16-gentoo
:::

Now it is time to configure and compile the kernel sources. There are
two approaches for this:

1.  The kernel is manually configured and built.
2.  A tool called [genkernel]{.tripleclick-separator
    style="font-family: monospace; font-size: 95%; font-weight: bold;"}
    is used to automatically build and install the Linux kernel.

We explain the manual configuration as the default choice here as it is
the best way to optimize an environment.

[Default: Manual configuration]{#Default:_Manual_configuration .mw-headline}
----------------------------------------------------------------------------

### [Introduction]{#Introduction_4 .mw-headline}

Manually configuring a kernel is often seen as the most difficult
procedure a Linux user ever has to perform. Nothing is less true - after
configuring a couple of kernels no-one even remembers that it was
difficultÂ ;)

However, one thing is true: it is vital to know the system when a kernel
is configured manually. Most information can be gathered by emerging
[sys-apps/pciutils](https://packages.gentoo.org/packages/sys-apps/pciutils){.external
.text} which contains the [lspci]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
command:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`emerge --ask sys-apps/pciutils`

</div>
:::

::: {.alert .alert-info .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Note**\
Inside the chroot, it is safe to ignore any pcilib warnings (like
*pcilib: cannot open /sys/bus/pci/devices*) that
[lspci]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
might throw out.
:::

Another source of system information is to run
[lsmod]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} to
see what kernel modules the installation CD uses as it might provide a
nice hint on what to enable.

Now go to the kernel source directory and execute [make
menuconfig]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}.
This will fire up menu-driven configuration screen.

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`cd /usr/src/linux`

</div>

<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`make menuconfig`

</div>
:::

The Linux kernel configuration has many, many sections. Let\'s first
list some options that must be activated (otherwise Gentoo will not
function, or not function properly without additional tweaks). We also
have a [Gentoo kernel configuration
guide](/wiki/Kernel/Gentoo_Kernel_Configuration_Guide "Kernel/Gentoo Kernel Configuration Guide")
on the Gentoo wiki that might help out further.

### [Activating required options]{#Activating_required_options .mw-headline}

Make sure that every driver that is vital to the booting of the system
(such as SCSI controller, etc.) is compiled in the kernel and not as a
module, otherwise the system will not be able to boot completely.

Next select the exact processor type. It is also recommended to enable
MCE features (if available) so that users are able to be notified of any
hardware problems. On some architectures (such as x86\_64), these errors
are not printed to [dmesg]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}, but
to [/dev/mcelog]{style="font-family: monospace; font-size: 95%"}. This
requires the
[app-admin/mcelog](https://packages.gentoo.org/packages/app-admin/mcelog){.external
.text} package.

Also select *Maintain a devtmpfs file system to mount at /dev* so that
critical device files are already available early in the boot process
(`CONFIG_DEVTMPFS`{.variable} and `CONFIG_DEVTMPFS_MOUNT`{.variable}):

::: {.box-caption}
[KERNEL]{.label style="margin-right: .5em; background-color: #4E9A06"}
**Enabling devtmpfs support**
:::

``` {.captioned}
Device Drivers --->
  Generic Driver Options --->
    [*] Maintain a devtmpfs filesystem to mount at /dev
    [*]   Automount devtmpfs at /dev, after the kernel mounted the rootfs
```

Verify SCSI disk support has been activated
(`CONFIG_BLK_DEV_SD`{.variable}):

::: {.box-caption}
[KERNEL]{.label style="margin-right: .5em; background-color: #4E9A06"}
**Enabling SCSI disk support**
:::

``` {.captioned}
Device Drivers --->
   SCSI device support  --->
      <*> SCSI disk support
```

Now go to File Systems and select support for the filesystems you use.
Don\'t compile the file system that is used for the root filesystem as
module, otherwise the Gentoo system will not be able to mount the
partition. Also select *Virtual memory* and */proc file system*. Select
one or more of the following options as needed by the system
(`CONFIG_EXT2_FS`{.variable}, `CONFIG_EXT3_FS`{.variable},
`CONFIG_EXT4_FS`{.variable}, `CONFIG_MSDOS_FS`{.variable},
`CONFIG_VFAT_FS`{.variable}, `CONFIG_PROC_FS`{.variable}, and
`CONFIG_TMPFS`{.variable}):

::: {.box-caption}
[KERNEL]{.label style="margin-right: .5em; background-color: #4E9A06"}
**Selecting necessary file systems**
:::

``` {.captioned}
File systems --->
  <*> Second extended fs support
  <*> The Extended 3 (ext3) filesystem
  <*> The Extended 4 (ext4) filesystem
  <*> Reiserfs support
  <*> JFS filesystem support
  <*> XFS filesystem support
  <*> Btrfs filesystem support
  DOS/FAT/NT Filesystems  --->
    <*> MSDOS fs support
    <*> VFAT (Windows-95) fs support
 
Pseudo Filesystems --->
    [*] /proc file system support
    [*] Tmpfs virtual memory file system support (former shm fs)
```

If PPPoE is used to connect to the Internet, or a dial-up modem, then
enable the following options (`CONFIG_PPP`{.variable},
`CONFIG_PPP_ASYNC`{.variable}, and `CONFIG_PPP_SYNC_TTY`{.variable}):

::: {.box-caption}
[KERNEL]{.label style="margin-right: .5em; background-color: #4E9A06"}
**Selecting PPPoE necessary drivers**
:::

``` {.captioned}
Device Drivers --->
  Network device support --->
    <*> PPP (point-to-point protocol) support
    <*>   PPP support for async serial ports
    <*>   PPP support for sync tty ports
```

The two compression options won\'t harm but are not definitely needed,
neither does the PPP over Ethernet option, that might only be used by
ppp when configured to do kernel mode PPPoE.

Don\'t forget to include support in the kernel for the network (Ethernet
or wireless) cards.

Most systems also have multiple cores at their disposal, so it is
important to activate *Symmetric multi-processing support*
(`CONFIG_SMP`{.variable}):

::: {.box-caption}
[KERNEL]{.label style="margin-right: .5em; background-color: #4E9A06"}
**Activating SMP support**
:::

``` {.captioned}
Processor type and features  --->
  [*] Symmetric multi-processing support
```

::: {.alert .alert-info .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Note**\
In multi-core systems, each core counts as one processor.
:::

If USB input devices (like keyboard or mouse) or other USB devices will
be used, do not forget to enable those as well
(`CONFIG_HID_GENERIC`{.variable} and `CONFIG_USB_HID`{.variable},
`CONFIG_USB_SUPPORT`{.variable}, `CONFIG_USB_XHCI_HCD`{.variable},
`CONFIG_USB_EHCI_HCD`{.variable}, `CONFIG_USB_OHCI_HCD`{.variable}):

::: {.box-caption}
[KERNEL]{.label style="margin-right: .5em; background-color: #4E9A06"}
**Activating USB support for input devices**
:::

``` {.captioned}
Device Drivers --->
  HID support  --->
    -*- HID bus support
    <*>   Generic HID driver
    [*]   Battery level reporting for HID devices
      USB HID support  --->
        <*> USB HID transport layer
  [*] USB support  --->
    <*>     xHCI HCD (USB 3.0) support
    <*>     EHCI HCD (USB 2.0) support
    <*>     OHCI HCD (USB 1.1) support
```

\

### [Architecture specific kernel configuration]{#Architecture_specific_kernel_configuration .mw-headline}

Make sure to select IA32 Emulation if 32-bit programs should be
supported (`CONFIG_IA32_EMULATION`{.variable}). Gentoo installs a
multilib system (mixed 32-bit/64-bit computing) by default, so unless a
no-multilib profile is used, this option is required.

::: {.box-caption}
[KERNEL]{.label style="margin-right: .5em; background-color: #4E9A06"}
**Selecting processor types and features**
:::

``` {.captioned}
Processor type and features  --->
   [ ] Machine Check / overheating reporting 
   [ ]   Intel MCE Features
   [ ]   AMD MCE Features
   Processor family (AMD-Opteron/Athlon64)  --->
      ( ) Opteron/Athlon64/Hammer/K8
      ( ) Intel P4 / older Netburst based Xeon
      ( ) Core 2/newer Xeon
      ( ) Intel Atom
      ( ) Generic-x86-64
Executable file formats / Emulations  --->
   [*] IA32 Emulation
```

Enable GPT partition label support if that was used previously when
partitioning the disk (`CONFIG_PARTITION_ADVANCED`{.variable} and
`CONFIG_EFI_PARTITION`{.variable}):

::: {.box-caption}
[KERNEL]{.label style="margin-right: .5em; background-color: #4E9A06"}
**Enable support for GPT**
:::

``` {.captioned}
-*- Enable the block layer --->
   Partition Types --->
      [*] Advanced partition selection
      [*] EFI GUID Partition support
```

Enable EFI stub support and EFI variables in the Linux kernel if UEFI is
used to boot the system (`CONFIG_EFI`{.variable},
`CONFIG_EFI_STUB`{.variable}, `CONFIG_EFI_MIXED`{.variable}, and
`CONFIG_EFI_VARS`{.variable}):

::: {.box-caption}
[KERNEL]{.label style="margin-right: .5em; background-color: #4E9A06"}
**Enable support for UEFI**
:::

``` {.captioned}
Processor type and features  --->
    [*] EFI runtime service support 
    [*]   EFI stub support
    [*]     EFI mixed-mode support
 
Firmware Drivers  --->
    EFI (Extensible Firmware Interface) Support  --->
        <*> EFI Variable Support via sysfs
```

### [Compiling and installing]{#Compiling_and_installing .mw-headline}

With the configuration now done, it is time to compile and install the
kernel. Exit the configuration and start the compilation process:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`make && make modules_install`

</div>
:::

::: {.alert .alert-info .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Note**\
It is possible to enable parallel builds using [make
-jX]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} with
`X` being an integer number of parallel tasks that the build process is
allowed to launch. This is similar to the instructions about
[/etc/portage/make.conf]{style="font-family: monospace; font-size: 95%"}
earlier, with the `MAKEOPTS`{.variable} variable.
:::

When the kernel has finished compiling, copy the kernel image to
[/boot/]{style="font-family: monospace; font-size: 95%"}. This is
handled by the [make install]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
command:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`make install`

</div>
:::

This will copy the kernel image into
[/boot/]{style="font-family: monospace; font-size: 95%"} together with
the [System.map]{style="font-family: monospace; font-size: 95%"} file
and the kernel configuration file.

\

### [Optional: Building an initramfs]{#Optional:_Building_an_initramfs .mw-headline}

In certain cases it is necessary to build an initramfs - an initial
ram-based file system. The most common reason is when important file
system locations (like
[/usr/]{style="font-family: monospace; font-size: 95%"} or
[/var/]{style="font-family: monospace; font-size: 95%"}) are on separate
partitions. With an initramfs, these partitions can be mounted using the
tools available inside the initramfs.

Without an initramfs, there is a huge risk that the system will not boot
up properly as the tools that are responsible for mounting the file
systems need information that resides on those file systems. An
initramfs will pull in the necessary files into an archive which is used
right after the kernel boots, but before the control is handed over to
the init tool. Scripts on the initramfs will then make sure that the
partitions are properly mounted before the system continues booting.

To install an initramfs, install
[sys-kernel/genkernel](https://packages.gentoo.org/packages/sys-kernel/genkernel){.external
.text} first, then have it generate an initramfs:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`emerge --ask sys-kernel/genkernel`

</div>
:::

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`genkernel --install initramfs`

</div>
:::

In order to enable specific support in the initramfs, such as LVM or
RAID, add in the appropriate options to
[genkernel]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}. See
[genkernel \--help]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} for
more information. In the next example support is enabled for LVM and
software RAID ([mdadm]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}):

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`genkernel --lvm --mdadm --install initramfs`

</div>
:::

The initramfs will be stored in
[/boot/]{style="font-family: monospace; font-size: 95%"}. The resulting
file can be found by simply listing the files starting with *initramfs*:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`ls /boot/initramfs*`

</div>
:::

Now continue with [Kernel modules](#Kernel_modules).

[Alternative: Using genkernel]{#Alternative:_Using_genkernel .mw-headline}
--------------------------------------------------------------------------

If a manual configuration looks too daunting, then using
[genkernel]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} is
recommended. It will configure and build the kernel automatically.

[genkernel]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
works by configuring a kernel nearly identically to the way the
installation CD kernel is configured. This means that when
[genkernel]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} is
used to build the kernel, the system will generally detect all hardware
at boot-time, just like the installation CD does. Because
[genkernel]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
doesn\'t require any manual kernel configuration, it is an ideal
solution for those users who may not be comfortable compiling their own
kernels.

Now, let\'s see how to use genkernel. First, emerge the
[sys-kernel/genkernel](https://packages.gentoo.org/packages/sys-kernel/genkernel){.external
.text} ebuild:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`emerge --ask sys-kernel/genkernel`

</div>
:::

Next, edit the
[/etc/fstab]{style="font-family: monospace; font-size: 95%"} file so
that the line containing
[/boot/]{style="font-family: monospace; font-size: 95%"} as second field
has the first field pointing to the right device. If the partitioning
example from the handbook is followed, then this device is most likely
/dev/sda2 with the ext2 file system. This would make the entry in the
file look like so:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`nano -w /etc/fstab`

</div>
:::

::: {.box-caption}
[FILE]{.label style="margin-right: .5em; background-color: #54487A"}
**`/etc/fstab`{style="border: none; background: none; color: #54487A; margin-right: .5em;"}Configuring
the /boot mountpoint**
:::

``` {.captioned}
/dev/sda2  /boot   ext2    defaults    0 2
```

::: {.alert .alert-info .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Note**\
Further in the Gentoo installation,
[/etc/fstab]{style="font-family: monospace; font-size: 95%"} will be
configured again. The
[/boot]{style="font-family: monospace; font-size: 95%"} setting is
needed right now as the [genkernel]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
application reads in this configuration.
:::

Now, compile the kernel sources by running [genkernel
all]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}. Be
aware though, as [genkernel]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
compiles a kernel that supports almost all hardware, this compilation
will take quite a while to finish!

::: {.alert .alert-info .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Note**\
If the root partition/volume doesn\'t use ext2 or ext3 or ext4 as
filesystem it *might* be necessary to manually configure the kernel
using [genkernel \--menuconfig all]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} and
add support for this particular filesystem in the kernel (i.e. not as a
module). Users of LVM2 will probably want to add `--lvm` as an argument
as well.
:::

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`genkernel all`

</div>
:::

Once genkernel completes, a kernel, full set of modules and initial ram
disk (initramfs) will be created. We will use the kernel and initrd when
configuring a boot loader later in this document. Write down the names
of the kernel and initrd as this information is used when the boot
loader configuration file is edited. The initrd will be started
immediately after booting to perform hardware autodetection (just like
on the installation CD) before the \"real\" system starts up.

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`ls /boot/vmlinu* /boot/initramfs*`

</div>
:::

[Kernel modules]{#Kernel_modules .mw-headline}
----------------------------------------------

### [Configuring the modules]{#Configuring_the_modules .mw-headline}

::: {.alert .alert-info .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Note**\
Hardware modules are optional to be listed manually.
[udev]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} will
normally load all hardware modules that are detected to be connected in
most cases. However, it is not harmful for automatically detected
modules to be listed. Sometimes exotic hardware requires help to load
their drivers.
:::

List the modules that need to be loaded automatically in
[/etc/modules-load.d/\*.conf]{style="font-family: monospace; font-size: 95%"}
files one module per line. Extra options for the modules, if necessary,
should be set in
[/etc/modprobe.d/\*.conf]{style="font-family: monospace; font-size: 95%"}
files.

To view all available modules, run the following
[find]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
command. Don\'t forget to substitute \"\<kernel version\>\" with the
version of the kernel just compiled:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`find /lib/modules/<kernel version>/ -type f -iname '*.o' -or -iname '*.ko' | less`

</div>
:::

For instance, to automatically load the
[3c59x.ko]{style="font-family: monospace; font-size: 95%"} module (which
is the driver for a specific 3Com network card family), edit the
[/etc/modules-load.d/network.conf]{style="font-family: monospace; font-size: 95%"}
file and enter the module name in it. The actual file name is
insignificant to the loader.

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`mkdir -p /etc/modules-load.d`

</div>

<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`nano -w /etc/modules-load.d/network.conf`

</div>
:::

::: {.box-caption}
[FILE]{.label style="margin-right: .5em; background-color: #54487A"}
**`/etc/modules-load.d/network.conf`{style="border: none; background: none; color: #54487A; margin-right: .5em;"}Force
loading 3c59x module**
:::

``` {.captioned}
3c59x
```

Continue the installation with [Configuring the
system](/wiki/Handbook:AMD64/Installation/System "Handbook:AMD64/Installation/System").

### [Optional: Installing firmware]{#Optional:_Installing_firmware .mw-headline}

Some drivers require additional firmware to be installed on the system
before they work. This is often the case for network interfaces,
especially wireless network interfaces. Also, modern video chips, from
vendors like AMD, NVidia, and Intel when using open source drivers,
often need external firmware files. Most of the firmware is packaged in
[sys-kernel/linux-firmware](https://packages.gentoo.org/packages/sys-kernel/linux-firmware){.external
.text}:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`emerge --ask sys-kernel/linux-firmware`

</div>
:::

\

\

\

\

\

[Filesystem information]{#Filesystem_information .mw-headline}
--------------------------------------------------------------

### [About fstab]{#About_fstab .mw-headline}

Under Linux, all partitions used by the system must be listed in
[/etc/fstab]{style="font-family: monospace; font-size: 95%"}. This file
contains the mount points of those partitions (where they are seen in
the file system structure), how they should be mounted and with what
special options (automatically or not, whether users can mount them or
not, etc.)

### [Creating the fstab file]{#Creating_the_fstab_file .mw-headline}

The [/etc/fstab]{style="font-family: monospace; font-size: 95%"} file
uses a table-like syntax. Every line consists of six fields, separated
by whitespace (space(s), tabs or a mixture). Each field has its own
meaning:

1.  The first field shows the block special device or remote filesystem
    to be mounted. Several kinds of device identifiers are available for
    block special device nodes, including paths to device files,
    filesystem labels and UUIDs, and partition labels and UUIDs.
2.  The second field shows the mount point at which the partition should
    be mounted.
3.  The third field shows the filesystem used by the partition.
4.  The fourth field shows the mount options used by
    [mount]{.tripleclick-separator
    style="font-family: monospace; font-size: 95%; font-weight: bold;"}
    when it wants to mount the partition. As every filesystem has its
    own mount options, users are encouraged to read the mount man page
    ([man mount]{.tripleclick-separator
    style="font-family: monospace; font-size: 95%; font-weight: bold;"})
    for a full listing. Multiple mount options are comma-separated.
5.  The fifth field is used by dump to determine if the partition needs
    to be dumped or not. This can generally be left as 0 (zero).
6.  The sixth field is used by [fsck]{.tripleclick-separator
    style="font-family: monospace; font-size: 95%; font-weight: bold;"}
    to determine the order in which filesystems should be checked if the
    system wasn\'t shut down properly. The root filesystem should have 1
    while the rest should have 2 (or 0 if a filesystem check isn\'t
    necessary).

::: {.alert .alert-warning .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Important**\
The default [/etc/fstab]{style="font-family: monospace; font-size: 95%"}
file provided by Gentoo is not a valid
[fstab]{style="font-family: monospace; font-size: 95%"} file but instead
more of a template.
:::

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`nano -w /etc/fstab`

</div>
:::

In the remainder of the text, we use the default
[/dev/sd\*]{style="font-family: monospace; font-size: 95%"} block device
files as partition.

#### [Filesystem labels and UUIDs]{#Filesystem_labels_and_UUIDs .mw-headline}

Both MBR (BIOS) and GPT include support for *filesystem* labels and
*filesystem* UUIDs. These attributes can be defined in
[/etc/fstab]{style="font-family: monospace; font-size: 95%"} as
alternatives for the [mount]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
command to use when attempting to find and mount block devices.
Filesystem labels and UUIDs are identified by the `LABEL`{.variable} and
`UUID`{.variable} prefix and can be viewed with the
[blkid]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
command:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`blkid`

</div>
:::

::: {.alert .alert-danger .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Warning**\
If the filesystem inside a partition is wiped, then the filesystem label
and the UUID values will be subsequently altered or removed.
:::

Because of uniqueness, readers that are using an MBR-style partition
table are recommended to use UUIDs over labels to define mountable
volumes in [/etc/fstab]{style="font-family: monospace; font-size: 95%"}.

#### [Partition labels and UUIDs]{#Partition_labels_and_UUIDs .mw-headline}

Users who have gone the GPT route have a couple more \'robust\' options
available to define partitions in
[/etc/fstab]{style="font-family: monospace; font-size: 95%"}. Partition
labels and partition UUIDs can be used to identify the block device\'s
individual partition(s), regardless of what filesystem has been chosen
for the partition itself. Partition labels and UUIDs are identified by
the `PARTLABEL`{.variable} and `PARTUUID`{.variable} prefixes
respectively and can be viewed nicely in the terminal by running the
[blkid]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
command:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`blkid`

</div>
:::

While not always true for partition labels, using a UUID to identify a
partition in [fstab]{style="font-family: monospace; font-size: 95%"}
provides a guarantee that the bootloader will not be confused when
looking for a certain volume, even if the filesystem would be changed in
the future. Using the older default block device files
([/dev/sd\*N]{style="font-family: monospace; font-size: 95%"}) for
defining the partitions in
[fstab]{style="font-family: monospace; font-size: 95%"} is risky for
systems that are restarted often and have SATA block devices added and
removed regularly.

The naming for block device files depends on a number of factors,
including how and in what order the disks are attached to the system.
They also could show up in a different order depending on which of the
devices are detected by the kernel first during the early boot process.
With this being stated, unless one intends to constantly fiddle with the
disk ordering, using default block device files is a simple and
straightforward approach.

\
Let us take a look at how to write down the options for the
[/boot/]{style="font-family: monospace; font-size: 95%"} partition. This
is just an example, and should be modified according to the partitioning
decisions made earlier in the installation. In our amd64 partitioning
example, [/boot/]{style="font-family: monospace; font-size: 95%"} is
usually the [/dev/sda2]{style="font-family: monospace; font-size: 95%"}
partition, with ext2 as filesystem. It needs to be checked during boot,
so we would write down:

::: {.box-caption}
[FILE]{.label style="margin-right: .5em; background-color: #54487A"}
**`/etc/fstab`{style="border: none; background: none; color: #54487A; margin-right: .5em;"}An
example /boot line for /etc/fstab**
:::

``` {.captioned}
/dev/sda2   /boot     ext2    defaults        0 2
```

Some users don\'t want their
[/boot/]{style="font-family: monospace; font-size: 95%"} partition to be
mounted automatically to improve their system\'s security. Those people
should substitute *defaults* with *noauto*. This does mean that those
users will need to manually mount this partition every time they want to
use it.

Add the rules that match the previously decided partitioning scheme and
append rules for devices such as CD-ROM drive(s), and of course, if
other partitions or drives are used, for those too.

Below is a more elaborate example of an
[/etc/fstab]{style="font-family: monospace; font-size: 95%"} file:

\

::: {.box-caption}
[FILE]{.label style="margin-right: .5em; background-color: #54487A"}
**`/etc/fstab`{style="border: none; background: none; color: #54487A; margin-right: .5em;"}A
full /etc/fstab example**
:::

``` {.captioned}
/dev/sda2   /boot        ext2    defaults,noatime     0 2
/dev/sda3   none         swap    sw                   0 0
/dev/sda4   /            ext4    noatime              0 1
  
/dev/cdrom  /mnt/cdrom   auto    noauto,user          0 0
```

When `auto` is used in the third field, it makes the
[mount]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
command guess what the filesystem would be. This is recommended for
removable media as they can be created with one of many filesystems. The
`user` option in the fourth field makes it possible for non-root users
to mount the CD.

To improve performance, most users would want to add the `noatime` mount
option, which results in a faster system since access times aren\'t
registered (those are not needed generally anyway). This is also
recommended for solid state drive (SSD) users, who should also enable
the `discard` mount option (ext4 and btrfs only for now) which makes the
`TRIM` command work.

Double-check the
[/etc/fstab]{style="font-family: monospace; font-size: 95%"} file, save
and quit to continue.

[Networking information]{#Networking_information .mw-headline}
--------------------------------------------------------------

### [Host and domain information]{#Host_and_domain_information .mw-headline}

One of the choices the user has to make is name his/her PC. This seems
to be quite easy, but lots of users are having difficulties finding the
appropriate name for their Linux PC. To speed things up, know that the
decision is not final - it can be changed afterwards. In the examples
below, the hostname *tux* is used within the domain *homenetwork*.

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`nano -w /etc/conf.d/hostname`

</div>

    # Set the hostname variable to the selected host name
    hostname="tux"
:::

Second, if a domain name is needed, set it in
[/etc/conf.d/net]{style="font-family: monospace; font-size: 95%"}. This
is only necessary if the ISP or network administrator says so, or if the
network has a DNS server but not a DHCP server. Don\'t worry about DNS
or domain names if the system uses DHCP for dynamic IP address
allocation and network configuration.

::: {.alert .alert-info .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Note**\
The [/etc/conf.d/net]{style="font-family: monospace; font-size: 95%"}
file does not exist by default, so needs to be created.
:::

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`nano -w /etc/conf.d/net`

</div>

    # Set the dns_domain_lo variable to the selected domain name
    dns_domain_lo="homenetwork"
:::

::: {.alert .alert-info .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Note**\
If no domain name is configured, then users will notice they get \"This
is hostname.(none)\" messages at their login screen. This should then be
fixed by editing
[/etc/issue]{style="font-family: monospace; font-size: 95%"} and
deleting the string `.\O` from that file.
:::

If a NIS domain is needed (users that do not know this will not need
one), define that one too:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`nano -w /etc/conf.d/net`

</div>

    # Set the nis_domain_lo variable to the selected NIS domain name
    nis_domain_lo="my-nisdomain"
:::

::: {.alert .alert-info .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Note**\
For more information on configuring DNS and NIS, please read the
examples provided in
[/usr/share/doc/netifrc-\*/net.example.bz2]{style="font-family: monospace; font-size: 95%"}
which can be read using [bzless]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}.
Also, it might be interesting to install
[net-dns/openresolv](https://packages.gentoo.org/packages/net-dns/openresolv){.external
.text} to help manage the DNS/NIS setup.
:::

### [Configuring the network]{#Configuring_the_network .mw-headline}

During the Gentoo Linux installation, networking was already configured.
However, that was for the installation CD itself and not for the
installed environment. Right now, the network configuration is made for
the installed Gentoo Linux system.

::: {.alert .alert-info .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Note**\
More detailed information about networking, including advanced topics
like bonding, bridging, 802.1Q VLANs or wireless networking is covered
in the Gentoo Network Configuration section.
:::

All networking information is gathered in
[/etc/conf.d/net]{style="font-family: monospace; font-size: 95%"}. It
uses a straightforward yet perhaps not intuitive syntax. But don\'t
fear, everything is explained below. A fully commented example that
covers many different configurations is available in
[/usr/share/doc/netifrc-\*/net.example.bz2]{style="font-family: monospace; font-size: 95%"}.

First install
[net-misc/netifrc](https://packages.gentoo.org/packages/net-misc/netifrc){.external
.text}:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`emerge --askÂ --noreplace net-misc/netifrc`

</div>
:::

DHCP is used by default. For DHCP to work, a DHCP client needs to be
installed. This is described later in Installing Necessary System Tools.

If the network connection needs to be configured because of specific
DHCP options or because DHCP is not used at all, then open
[/etc/conf.d/net]{style="font-family: monospace; font-size: 95%"}:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`nano -w /etc/conf.d/net`

</div>
:::

Set both `config_eth0`{.variable} and `routes_eth0`{.variable} to enter
IP address information and routing information:

::: {.alert .alert-info .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Note**\
This assumes that the network interface will be called eth0. This is,
however, very system dependent. It is recommended to assume that the
interface is named the same as the interface name when booted from the
installation media if the installation media is sufficiently recent.
More information can be found in Network Interface Naming.
:::

::: {.box-caption}
[FILE]{.label style="margin-right: .5em; background-color: #54487A"}
**`/etc/conf.d/net`{style="border: none; background: none; color: #54487A; margin-right: .5em;"}Static
IP definition**
:::

``` {.captioned}
config_eth0="192.168.0.2 netmask 255.255.255.0 brd 192.168.0.255"
routes_eth0="default via 192.168.0.1"
```

To use DHCP, define `config_eth0`{.variable}:

::: {.box-caption}
[FILE]{.label style="margin-right: .5em; background-color: #54487A"}
**`/etc/conf.d/net`{style="border: none; background: none; color: #54487A; margin-right: .5em;"}DHCP
definition**
:::

``` {.captioned}
config_eth0="dhcp"
```

Please read
[/usr/share/doc/netifrc-\*/net.example.bz2]{style="font-family: monospace; font-size: 95%"}
for a list of all available options. Be sure to also read up on the DHCP
client man page if specific DHCP options need to be set.

If the system has several network interfaces, then repeat the above
steps for `config_eth1`{.variable}, `config_eth2`{.variable}, etc.

Now save the configuration and exit to continue.

### [Automatically start networking at boot]{#Automatically_start_networking_at_boot .mw-headline}

To have the network interfaces activated at boot, they need to be added
to the default runlevel.

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`cd /etc/init.d`

</div>

<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`ln -s net.lo net.eth0`

</div>

<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`rc-update add net.eth0 default`

</div>
:::

If the system has several network interfaces, then the appropriate
[net.\*]{style="font-family: monospace; font-size: 95%"} files need to
be created just like we did with
[net.eth0]{style="font-family: monospace; font-size: 95%"}.

If after booting the system we find out that the assumption about the
network interface name (which is currently documented as `eth0`) was
wrong, then execute the following steps to rectify this:

1.  Update the
    [/etc/conf.d/net]{style="font-family: monospace; font-size: 95%"}
    file with the correct interface name (like `enp3s0` instead of
    `eth0`).
2.  Create new symbolic link (like
    [/etc/init.d/net.enp3s0]{style="font-family: monospace; font-size: 95%"}).
3.  Remove the old symbolic link ([rm
    /etc/init.d/net.eth0]{.tripleclick-separator
    style="font-family: monospace; font-size: 95%; font-weight: bold;"}).
4.  Add the new one to the default runlevel.
5.  Remove the old one using [rc-update del net.eth0
    default]{.tripleclick-separator
    style="font-family: monospace; font-size: 95%; font-weight: bold;"}.

### [The hosts file]{#The_hosts_file .mw-headline}

Next inform Linux about the network environment. This is defined in
[/etc/hosts]{style="font-family: monospace; font-size: 95%"} and helps
in resolving host names to IP addresses for hosts that aren\'t resolved
by the nameserver.

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`nano -w /etc/hosts`

</div>
:::

::: {.box-caption}
[FILE]{.label style="margin-right: .5em; background-color: #54487A"}
**`/etc/hosts`{style="border: none; background: none; color: #54487A; margin-right: .5em;"}Filling
in the networking information**
:::

``` {.captioned}
# This defines the current system and must be set
127.0.0.1     tux.homenetwork tux localhost
  
# Optional definition of extra systems on the network
192.168.0.5   jenny.homenetwork jenny
192.168.0.6   benny.homenetwork benny
```

Save and exit the editor to continue.

### [Optional: Get PCMCIA working]{#Optional:_Get_PCMCIA_working .mw-headline}

PCMCIA users should now install the
[sys-apps/pcmciautils](https://packages.gentoo.org/packages/sys-apps/pcmciautils){.external
.text} package.

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`emerge --ask sys-apps/pcmciautils`

</div>
:::

[System information]{#System_information .mw-headline}
------------------------------------------------------

### [Root password]{#Root_password .mw-headline}

Set the root password using the [passwd]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
command.

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`passwd`

</div>
:::

The root Linux account is an all-powerful account, so pick a strong
password. Later an additional regular user account will be created for
daily operations.

### [Init and boot configuration]{#Init_and_boot_configuration .mw-headline}

Gentoo (at least when using OpenRC) uses
[/etc/rc.conf]{style="font-family: monospace; font-size: 95%"} to
configure the services, startup, and shutdown of a system. Open up
[/etc/rc.conf]{style="font-family: monospace; font-size: 95%"} and enjoy
all the comments in the file. Review the settings and change where
needed.

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`nano -w /etc/rc.conf`

</div>
:::

Next, open
[/etc/conf.d/keymaps]{style="font-family: monospace; font-size: 95%"} to
handle keyboard configuration. Edit it to configure and select the right
keyboard.

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`nano -w /etc/conf.d/keymaps`

</div>
:::

Take special care with the `keymap`{.variable} variable. If the wrong
keymap is selected, then weird results will come up when typing on the
keyboard.

Finally, edit
[/etc/conf.d/hwclock]{style="font-family: monospace; font-size: 95%"} to
set the clock options. Edit it according to personal preference.

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`nano -w /etc/conf.d/hwclock`

</div>
:::

If the hardware clock is not using UTC, then it is necessary to set
`clock="local"` in the file. Otherwise the system might show clock skew
behavior.

\

\

\

\

\

[System logger]{#System_logger .mw-headline}
--------------------------------------------

Some tools are missing from the stage3 archive because several packages
provide the same functionality. It is now up to the user to choose which
ones to install.

The first tool to decide on has to provide logging facilities for the
system. Unix and Linux have an excellent history of logging capabilities
- if needed, everything that happens on the system can be logged in log
files. This happens through the system logger.

Gentoo offers several system logger utilities. A few of these include:

-   [app-admin/sysklogd](https://packages.gentoo.org/packages/app-admin/sysklogd){.external
    .text} - Offers the traditional set of system logging daemons. The
    default logging configuration works well out of the box which makes
    this package a good option for beginners.
-   [app-admin/syslog-ng](https://packages.gentoo.org/packages/app-admin/syslog-ng){.external
    .text} - An advanced system logger. Requires additional
    configuration for anything beyond logging to one big file. More
    advanced users may choose this package based on its logging
    potential; be aware additional configuration is a necessity for any
    kind of smart logging.
-   [app-admin/metalog](https://packages.gentoo.org/packages/app-admin/metalog){.external
    .text} - A highly-configurable system logger.

Others are available through Portage as well - the number of available
packages increases on a daily basis.

::: {.alert .alert-success .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Tip**\
If sysklogd or syslog-ng are going to be used, it is recommended to
install and configure [logrotate](/wiki/Logrotate "Logrotate")
afterwards as those system loggers don\'t provide any rotation mechanism
for the log files.
:::

::: {.alert .alert-success .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Tip**\
systemd provides its own logging facility called the \"journal\".
Installing a separate syslog provider is optional on systems running
systemd, and may require additional configuration to have the syslog
daemon read messages from the journal.
:::

To install the system logger of choice, emerge it and have it added to
the default runlevel using [rc-update]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}. The
following example installs
[app-admin/sysklogd](https://packages.gentoo.org/packages/app-admin/sysklogd){.external
.text}:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`emerge --ask app-admin/sysklogd`

</div>
:::

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`rc-update add sysklogd default`

</div>
:::

[Optional: Cron daemon]{#Optional:_Cron_daemon .mw-headline}
------------------------------------------------------------

Next is the cron daemon. Although it is optional and not required for
every system, it is wise to install one.

A cron daemon executes scheduled commands. It is very handy if some
command needs to be executed regularly (for instance daily, weekly or
monthly).

Gentoo offers several possible cron daemons, including
[sys-process/bcron](https://packages.gentoo.org/packages/sys-process/bcron){.external
.text},
[sys-process/dcron](https://packages.gentoo.org/packages/sys-process/dcron){.external
.text},
[sys-process/fcron](https://packages.gentoo.org/packages/sys-process/fcron){.external
.text}, and
[sys-process/cronie](https://packages.gentoo.org/packages/sys-process/cronie){.external
.text}. Installing one of them is similar to installing a system logger.
The following example uses
[sys-process/cronie](https://packages.gentoo.org/packages/sys-process/cronie){.external
.text}:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`emerge --ask sys-process/cronie`

</div>
:::

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`rc-update add cronie default`

</div>
:::

If dcron or fcron are used, an additional initialization command needs
to be executed:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`crontab /etc/crontab`

</div>
:::

[Optional: File indexing]{#Optional:_File_indexing .mw-headline}
----------------------------------------------------------------

In order to index the file system to provide faster file location
capabilities, install
[sys-apps/mlocate](https://packages.gentoo.org/packages/sys-apps/mlocate){.external
.text}.

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`emerge --ask sys-apps/mlocate`

</div>
:::

[Optional: Remote access]{#Optional:_Remote_access .mw-headline}
----------------------------------------------------------------

To be able to access the system remotely after installation, add the
[sshd]{style="font-family: monospace; font-size: 95%"} init script to
the default runlevel:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`rc-update add sshd default`

</div>
:::

If serial console access is needed (which is possible in case of remote
servers), uncomment the serial console section in
[/etc/inittab]{style="font-family: monospace; font-size: 95%"}:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`nano -w /etc/inittab`

</div>

    # SERIAL CONSOLES
    s0:12345:respawn:/sbin/agetty 9600 ttyS0 vt100
    s1:12345:respawn:/sbin/agetty 9600 ttyS1 vt100
:::

[Filesystem tools]{#Filesystem_tools .mw-headline}
--------------------------------------------------

Depending on the filesystems used, it is necessary to install the
required file system utilities (for checking the filesystem integrity,
creating additional file systems etc.). Note that tools for managing
ext2, ext3, or ext4 filesystems
([sys-fs/e2fsprogs](https://packages.gentoo.org/packages/sys-fs/e2fsprogs){.external
.text}) are already installed as a part of the [\@system
set](/wiki/System_set_(Portage) "System set (Portage)").

The following table lists the tools to install if a certain filesystem
is used:

  Filesystem           Package
  -------------------- ----------------------------------------------------------------------------------------------------
  Ext2, 3, and 4       [sys-fs/e2fsprogs](https://packages.gentoo.org/packages/sys-fs/e2fsprogs){.external .text}
  XFS                  [sys-fs/xfsprogs](https://packages.gentoo.org/packages/sys-fs/xfsprogs){.external .text}
  ReiserFS             [sys-fs/reiserfsprogs](https://packages.gentoo.org/packages/sys-fs/reiserfsprogs){.external .text}
  JFS                  [sys-fs/jfsutils](https://packages.gentoo.org/packages/sys-fs/jfsutils){.external .text}
  VFAT (FAT32, \...)   [sys-fs/dosfstools](https://packages.gentoo.org/packages/sys-fs/dosfstools){.external .text}
  Btrfs                [sys-fs/btrfs-progs](https://packages.gentoo.org/packages/sys-fs/btrfs-progs){.external .text}

::: {.alert .alert-success .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Tip**\
For more information on filesystems in Gentoo see the [filesystem
article](/wiki/Filesystem "Filesystem").
:::

[Networking tools]{#Networking_tools .mw-headline}
--------------------------------------------------

If there is no need for any additional networking tools, continue
immediately with the section on [Configuring a
bootloader](/wiki/Handbook:AMD64/Installation/Bootloader "Handbook:AMD64/Installation/Bootloader").

### [Installing a DHCP client]{#Installing_a_DHCP_client .mw-headline}

::: {.alert .alert-warning .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Important**\
Although optional, the majority of users will find that they need a DHCP
client to connect to the DHCP server on their network. Please take this
opportunity to install a DHCP client. If this step is forgotten, then
the system might not be able to get on the network thus making it
impossible to download a DHCP client afterward.
:::

In order for the system to automatically obtain an IP address for one or
more network interface(s) using netifrc scripts, it is necessary to
install a DHCP client. We recommend the use of
[net-misc/dhcpcd](https://packages.gentoo.org/packages/net-misc/dhcpcd){.external
.text} although many other DHCP clients are available through the Gentoo
repository:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`emerge --ask net-misc/dhcpcd`

</div>
:::

More information on [dhcpcd]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} can
be found in the [dhcpcd article](/wiki/Dhcpcd "Dhcpcd").

### [Optional: Installing a PPPoE client]{#Optional:_Installing_a_PPPoE_client .mw-headline}

If PPP is used to connect to the internet, install the
[net-dialup/ppp](https://packages.gentoo.org/packages/net-dialup/ppp){.external
.text} package:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`emerge --ask net-dialup/ppp`

</div>
:::

### [Optional: Install wireless networking tools]{#Optional:_Install_wireless_networking_tools .mw-headline}

If the system will be connecting to wireless networks, install the
[net-wireless/iw](https://packages.gentoo.org/packages/net-wireless/iw){.external
.text} package for Open or WEP networks and/or the
[net-wireless/wpa\_supplicant](https://packages.gentoo.org/packages/net-wireless/wpa_supplicant){.external
.text} package for WPA or WPA2 networks. [iw]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} is
also a useful basic diagnostic tool for scanning wireless networks.

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`emerge --ask net-wireless/iw net-wireless/wpa_supplicant`

</div>
:::

Now continue with [Configuring the
bootloader](/wiki/Handbook:AMD64/Installation/Bootloader "Handbook:AMD64/Installation/Bootloader").

\

\

\

\

\

\

[Selecting a boot loader]{#Selecting_a_boot_loader .mw-headline}
----------------------------------------------------------------

With the Linux kernel configured, system tools installed and
configuration files edited, it is time to install the last important
piece of a Linux installation: the boot loader.

The boot loader is responsible for firing up the Linux kernel upon boot
- without it, the system would not know how to proceed when the power
button has been pressed.

For
**[amd64]{style="font-family: monospace; font-size: 95%; color: #54487a"}**,
we document how to configure either [GRUB2](#Default:_Using_GRUB2) or
[LILO](#Alternative:_Using_LILO) for BIOS based systems, and
[GRUB2](#Default:_Using_GRUB2) or
[efibootmgr](#Alternative:_Using_efibootmgr) for UEFI systems.

In this section of the Handbook a delineation has been made between
*emerging* the boot loader\'s package and *installing* a boot loader to
a system disk. Here the term *emerge* will be used to ask
[Portage](/wiki/Portage "Portage") to make the software package
available to the system. The term *install* will signify the boot loader
copying files or physically modifying appropriate sections of the
system\'s disk drive in order to render the boot loader *activated and
ready to operate* on the next power cycle.

[Default: GRUB2]{#Default:_GRUB2 .mw-headline}
----------------------------------------------

Previously, Gentoo Linux used what is now called *GRUB Legacy* as the
recommended boot loader. As the name implies, the older GRUB package is
no longer actively maintained and has been superseded by GRUB2. For more
information about the legacy GRUB, please refer to its
[GRUB](/wiki/GRUB "GRUB") article.

By default, the majority of Gentoo systems now rely upon GRUB2 (found in
the
[sys-boot/grub](https://packages.gentoo.org/packages/sys-boot/grub){.external
.text} package), which is the direct successor to GRUB Legacy. With no
additional configuration, GRUB2 gladly supports older BIOS (\"pc\")
systems. With a small amount of configuration, necessary before build
time, GRUB2 can support more than a half a dozen additional platforms.
For more information, consult the [Prerequisites
section](/wiki/GRUB2#Prerequisites "GRUB2") of the
[GRUB2](/wiki/GRUB2 "GRUB2") article.

### [Emerge]{#Emerge .mw-headline}

When using an older BIOS system supporting only MBR partition tables, no
additional configuration is needed in order to emerge GRUB:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`emerge --askÂ --verbose sys-boot/grub:2`

</div>
:::

A note for UEFI users: running the above command will output the enabled
`GRUB_PLATFORMS`{.variable} values before emerging. When using UEFI
capable systems, users will need to ensure `GRUB_PLATFORMS="efi-64"` is
enabled (as it is the case by default). If that is not the case for the
setup, `GRUB_PLATFORMS="efi-64"` will need to be added to the
[/etc/portage/make.conf]{style="font-family: monospace; font-size: 95%"}
file *before* emerging GRUB2 so that the package will be built with EFI
functionality:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`echo 'GRUB_PLATFORMS="efi-64"' >> /etc/portage/make.conf`

</div>
:::

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`emerge --ask sys-boot/grub:2`

</div>
:::

If GRUB2 was somehow emerged without enabling `GRUB_PLATFORMS="efi-64"`,
the line (as shown above) can be added to
[make.conf]{style="font-family: monospace; font-size: 95%"} then and
dependencies for the [world package
set](/wiki/World_set_(Portage) "World set (Portage)") re-calculated by
passing the `--update --newuse` options to
[emerge]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`emerge --askÂ --update --newuse --verbose sys-boot/grub:2`

</div>
:::

The GRUB2 software has now been merged to the system, but not yet
installed.

### [Install]{#Install .mw-headline}

Next, install the necessary GRUB2 files to the
[/boot/grub/]{style="font-family: monospace; font-size: 95%"} directory
via the [grub-install]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
command. Presuming the first disk (the one where the system boots from)
is [/dev/sda]{style="font-family: monospace; font-size: 95%"}, one of
the following commands will do:

-   When using BIOS:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`grub-install /dev/sda`

</div>
:::

-   When using UEFI:

::: {.alert .alert-warning .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Important**\
Make sure the EFI system partition has been mounted *before* running
[grub-install]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}. It
is possible for [grub-install]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} to
install the GRUB EFI file
([grubx64.efi]{style="font-family: monospace; font-size: 95%"}) into the
wrong directory **without** providing *any* indication the wrong
directory was used.
:::

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`grub-install --target=x86_64-efi --efi-directory=/boot`

</div>
:::

::: {.alert .alert-info .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Note**\
Modify the `--efi-directory` option to the root of the EFI System
Partition. This is necessary if the
[/boot]{style="font-family: monospace; font-size: 95%"} partition was
not formatted as a FAT variant.
:::

::: {.alert .alert-warning .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Important**\
If [grub\_install]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
returns an error like
`Could not prepare Boot variable: Read-only file system`, it may be
necessary to remount the efivars special mount as read-write in order to
succeed:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`mount -o remount,rw /sys/firmware/efi/efivars`

</div>
:::
:::

Some motherboard manufacturers seem to only support the
[/efi/boot/]{style="font-family: monospace; font-size: 95%"} directory
location for the .EFI file in the EFI System Partition (ESP). The GRUB
installer can perform this operation automatically with the
`--removable` option. Verify the ESP is mounted before running the
following commands. Presuming the ESP is mounted at
[/boot]{style="font-family: monospace; font-size: 95%"} (as suggested
earlier), execute:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`grub-install --target=x86_64-efi --efi-directory=/boot --removable`

</div>
:::

This creates the default directory defined by the UEFI specification,
and then copies the
[grubx64.efi]{style="font-family: monospace; font-size: 95%"} file to
the \'default\' EFI file location defined by the same specification.

### [Configure]{#Configure .mw-headline}

Next, generate the GRUB2 configuration based on the user configuration
specified in the
[/etc/default/grub]{style="font-family: monospace; font-size: 95%"} file
and [/etc/grub.d]{style="font-family: monospace; font-size: 95%"}
scripts. In most cases, no configuration is needed by users as GRUB2
will automatically detect which kernel to boot (the highest one
available in [/boot/]{style="font-family: monospace; font-size: 95%"})
and what the root file system is. It is also possible to append kernel
parameters in
[/etc/default/grub]{style="font-family: monospace; font-size: 95%"}
using the `GRUB_CMDLINE_LINUX`{.variable} variable.

To generate the final GRUB2 configuration, run the
[grub-mkconfig]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
command:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`grub-mkconfig -o /boot/grub/grub.cfg`

</div>

    Generating grub.cfg ...
    Found linux image: /boot/vmlinuz-4.9.16-gentoo
    Found initrd image: /boot/initramfs-genkernel-amd64-4.9.16-gentoo
    done
:::

The output of the command must mention that at least one Linux image is
found, as those are needed to boot the system. If an initramfs is used
or [genkernel]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} was
used to build the kernel, the correct initrd image should be detected as
well. If this is not the case, go to
[/boot/]{style="font-family: monospace; font-size: 95%"} and check the
contents using the [ls]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
command. If the files are indeed missing, go back to the kernel
configuration and installation instructions.

::: {.alert .alert-success .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Tip**\
The [os-prober]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
utility can be used in conjunction with GRUB2 to detect other operating
systems from attached drives. Windows 7, 8.1, 10, and other
distributions of Linux are detectable. Those desiring dual boot systems
should emerge the
[sys-boot/os-prober](https://packages.gentoo.org/packages/sys-boot/os-prober){.external
.text} package then re-run the [grub-mkconfig]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
command (as seen above). If detection problems are encountered be sure
to read the [GRUB2](/wiki/GRUB2 "GRUB2") article in its entirety
*before* asking the Gentoo community for support.
:::

[Alternative 1: LILO]{#Alternative_1:_LILO .mw-headline}
--------------------------------------------------------

### [Emerge]{#Emerge_2 .mw-headline}

LILO, the **LI**nux**LO**ader, is the tried and true workhorse of Linux
boot loaders. However, it lacks features when compared to GRUB. LILO is
still used because, on some systems, GRUB does not work and LILO does.
Of course, it is also used because some people know LILO and want to
stick with it. Either way, Gentoo supports both bootloaders.

Installing LILO is a breeze; just use emerge.

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`emerge --ask sys-boot/lilo`

</div>
:::

### [Configure]{#Configure_2 .mw-headline}

To configure LILO, first create
[/etc/lilo.conf]{style="font-family: monospace; font-size: 95%"}:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`nano -w /etc/lilo.conf`

</div>
:::

In the configuration file, sections are used to refer to the bootable
kernel. Make sure that the kernel files (with kernel version) and
initramfs files are known, as they need to be referred to in this
configuration file.

::: {.alert .alert-info .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Note**\
If the root filesystem is JFS, add an `append="ro"` line after each boot
item since JFS needs to replay its log before it allows read-write
mounting.
:::

::: {.box-caption}
[FILE]{.label style="margin-right: .5em; background-color: #54487A"}
**`/etc/lilo.conf`{style="border: none; background: none; color: #54487A; margin-right: .5em;"}Example
LILO configuration**
:::

``` {.captioned}
boot=/dev/sda             # Install LILO in the MBR
prompt                    # Give the user the chance to select another section
timeout=50                # Wait 5 (five) seconds before booting the default section
default=gentoo            # When the timeout has passed, boot the "gentoo" section
compact                   # This drastically reduces load time and keeps the map file smaller; may fail on some systems
  
image=/boot/vmlinuz-4.9.16-gentoo
  label=gentoo            # Name we give to this section
  read-only               # Start with a read-only root. Do not alter!
  root=/dev/sda4          # Location of the root filesystem
  
image=/boot/vmlinuz-4.9.16-gentoo
  label=gentoo.rescue     # Name we give to this section
  read-only               # Start with a read-only root. Do not alter!
  root=/dev/sda4         # Location of the root filesystem
  append="init=/bin/bb"   # Launch the Gentoo static rescue shell
  
# The next two lines are for dual booting with a Windows system.
# In this example, Windows is hosted on /dev/sda6.
other=/dev/sda6
  label=windows
```

::: {.alert .alert-info .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Note**\
If a different partitioning scheme and/or kernel image is used, adjust
accordingly.
:::

If an initramfs is necessary, then change the configuration by referring
to this initramfs file and telling the initramfs where the root device
is located:

::: {.box-caption}
[FILE]{.label style="margin-right: .5em; background-color: #54487A"}
**`/etc/lilo.conf`{style="border: none; background: none; color: #54487A; margin-right: .5em;"}Adding
initramfs information to a boot entry**
:::

``` {.captioned}
image=/boot/vmlinuz-4.9.16-gentoo
  label=gentoo
  read-only
  append="root=/dev/sda4"
  initrd=/boot/initramfs-genkernel-amd64-4.9.16-gentoo
```

If additional options need to be passed to the kernel, use an `append`
statement. For instance, to add the `video` statement to enable
framebuffer:

::: {.box-caption}
[FILE]{.label style="margin-right: .5em; background-color: #54487A"}
**`/etc/lilo.conf`{style="border: none; background: none; color: #54487A; margin-right: .5em;"}Adding
video parameter to the boot options**
:::

``` {.captioned}
image=/boot/vmlinuz-4.9.16-gentoo
  label=gentoo
  read-only
  root=/dev/sda4
  append="video=uvesafb:mtrr,ywrap,1024x768-32@85"
```

Users that used [genkernel]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
should know that their kernels use the same boot options as is used for
the installation CD. For instance, if SCSI device support needs to be
enabled, add `doscsi` as kernel option.

Now save the file and exit.

### [Install]{#Install_2 .mw-headline}

To finish up, run the
[/sbin/lilo]{style="font-family: monospace; font-size: 95%"} executable
so LILO can apply the
[/etc/lilo.conf]{style="font-family: monospace; font-size: 95%"}
settings to the system (i.e. install itself on the disk). Keep in mind
that [/sbin/lilo]{style="font-family: monospace; font-size: 95%"} must
be executed each time a new kernel is installed or a change has been
made to the [lilo.conf]{style="font-family: monospace; font-size: 95%"}
file in order for the system to boot if the filename of the kernel has
changed.

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`/sbin/lilo`

</div>
:::

[Alternative 2: efibootmgr]{#Alternative_2:_efibootmgr .mw-headline}
--------------------------------------------------------------------

On UEFI based systems, the UEFI firmware on the system (in other words
the primary bootloader), can be directly manipulated to look for UEFI
boot entries. Such systems do not need to have additional (also known as
secondary) bootloaders like GRUB2 in order to help boot the system. With
that being said, the reason EFI-based bootloaders such as GRUB2 exist is
to *extend* the functionality of UEFI systems during the boot process.
Using [efibootmgr]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} is
really for those who desire to take a minimalist (although more rigid)
approach to booting their system; using GRUB2 (see above) is easier for
the majority of users because it offers a flexible approach when booting
UEFI systems.

Remember
[sys-boot/efibootmgr](https://packages.gentoo.org/packages/sys-boot/efibootmgr){.external
.text} application is not a bootloader; it is a tool to interact with
the UEFI firmware and update its settings, so that the Linux kernel that
was previously installed can be booted with additional options (if
necessary), or to allow multiple boot entries. This interaction is done
through the EFI variables (hence the need for kernel support of EFI
vars).

Be sure to read through the [EFI stub
kernel](/wiki/EFI_stub_kernel "EFI stub kernel") article *before*
continuing. The kernel must have specific options enabled to be directly
bootable by the system\'s UEFI firmware. It might be necessary to
recompile the kernel. It is also a good idea to take a look at the
[[efibootmgr](/wiki/Efibootmgr "Efibootmgr")]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}
article.

::: {.alert .alert-info .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Note**\
To reiterate, [efibootmgr]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} is
*not* a requirement to boot an UEFI system. The Linux kernel itself can
be booted immediately, and additional kernel command-line options can be
built-in to the Linux kernel (there is a kernel configuration option
called that allows the user to specify boot parameters as command-line
options. Even an initramfs can be \'built-in\' to the kernel.
:::

Those that have decided to take this approach must install the software:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`emerge --ask sys-boot/efibootmgr`

</div>
:::

Then, create the
[/boot/efi/boot/]{style="font-family: monospace; font-size: 95%"}
location, and then copy the kernel into this location, calling it
[bootx64.efi]{style="font-family: monospace; font-size: 95%"}:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`mkdir -p /boot/efi/boot`

</div>

<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`cp /boot/vmlinuz-* /boot/efi/boot/bootx64.efi`

</div>
:::

Next, tell the UEFI firmware that a boot entry called \"Gentoo\" is to
be created, which has the freshly compiled EFI stub kernel:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`efibootmgr --create --disk /dev/sda --part 2 --label "Gentoo" --loader "\efi\boot\bootx64.efi"`

</div>
:::

If an initial RAM file system (initramfs) is used, add the proper boot
option to it:

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`efibootmgr -c -d /dev/sda -p 2 -L "Gentoo" -l "\efi\boot\bootx64.efi" initrd='\initramfs-genkernel-amd64-4.9.16-gentoo'`

</div>
:::

::: {.alert .alert-info .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Note**\
The use of [\\]{.kbd
style="color: black; font-size: small; border: 0.2em solid; border-color: #DDD #BBB #BBB #DDD; padding: 0 0.4em; background: #EEE; white-space: nowrap;"}
as directory separator is mandatory when using UEFI definitions.
:::

With these changes done, when the system reboots, a boot entry called
\"Gentoo\" will be available.

[Alternative 3: Syslinux]{#Alternative_3:_Syslinux .mw-headline}
----------------------------------------------------------------

Syslinux is yet another bootloader alternative for the
**[amd64]{style="font-family: monospace; font-size: 95%; color: #54487a"}**
architecture. It supports MBR and, as of version 6.00, it supports EFI
boot. PXE (network) boot and lesser-known options are also supported.
Although Syslinux is a popular bootloader for many it is unsupported by
the Handbook. Readers can find information on emerging and then
installing this bootloader in the [Syslinux](/wiki/Syslinux "Syslinux")
article.

\

[Rebooting the system]{#Rebooting_the_system .mw-headline}
----------------------------------------------------------

Exit the chrooted environment and unmount all mounted partitions. Then
type in that one magical command that initiates the final, true test:
[reboot]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}.

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`exit`

</div>
:::

::: {.cmd-box}
<div>

`cdimage ~#`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`cd`

</div>

<div>

`cdimage ~#`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`umount -l /mnt/gentoo/dev{/shm,/pts,}`

</div>

<div>

`cdimage ~#`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`umount -R /mnt/gentoo`

</div>

<div>

`cdimage ~#`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`reboot`

</div>
:::

Do not forget to remove the bootable CD, otherwise the CD might be
booted again instead of the new Gentoo system.

Once rebooted in the freshly installed Gentoo environment, finish up
with [Finalizing the Gentoo
installation](/wiki/Handbook:AMD64/Installation/Finalizing "Handbook:AMD64/Installation/Finalizing").

\

\

\

\

\

[User administration]{#User_administration .mw-headline}
--------------------------------------------------------

### [Adding a user for daily use]{#Adding_a_user_for_daily_use .mw-headline}

Working as root on a Unix/Linux system is dangerous and should be
avoided as much as possible. Therefore it is strongly recommended to add
a user for day-to-day use.

The groups the user is member of define what activities the user can
perform. The following table lists a number of important groups:

  Group     Description
  --------- -----------------------------------------------------------------------------------------------------------------
  audio     Be able to access the audio devices.
  cdrom     Be able to directly access optical devices.
  floppy    Be able to directly access floppy devices.
  games     Be able to play games.
  portage   Be able to access portage restricted resources.
  usb       Be able to access USB devices.
  video     Be able to access video capturing hardware and doing hardware acceleration.
  wheel     Be able to use [su]{.tripleclick-separator style="font-family: monospace; font-size: 95%; font-weight: bold;"}.

For instance, to create a user called
[larry](/wiki/User:Larry "User:Larry") who is member of the *wheel*,
*users*, and *audio* groups, log in as root first (only root can create
users) and run [useradd]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"}:

::: {.cmd-box}
<div>

`Login:`{style="color: white; font-weight: bold;"}[]{.tripleclick-separator}`root`

</div>

    Password: (Enter the root password)
:::

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`useradd -m -G users,wheel,audio -s /bin/bash larry`

</div>

<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`passwd larry`

</div>

    Password: (Enter the password for larry)
    Re-enter password: (Re-enter the password to verify)
:::

If a user ever needs to perform some task as root, they can use [su
-]{.tripleclick-separator
style="font-family: monospace; font-size: 95%; font-weight: bold;"} to
temporarily receive root privileges. Another way is to use the
[sudo](/wiki/Sudo "Sudo") package which is, if correctly configured,
very secure.

[Disk cleanup]{#Disk_cleanup .mw-headline}
------------------------------------------

### [Removing tarballs]{#Removing_tarballs .mw-headline}

With the Gentoo installation finished and the system rebooted, if
everything has gone well, we can now remove the downloaded stage3
tarball from the hard disk. Remember that they were downloaded to the
[/]{style="font-family: monospace; font-size: 95%"} directory.

::: {.cmd-box}
<div>

`root #`{style="color: #ef2929; font-weight: bold;"}[]{.tripleclick-separator}`rm /stage3-*.tar.*`

</div>
:::

[Where to go from here]{#Where_to_go_from_here .mw-headline}
------------------------------------------------------------

### [Documentation]{#Documentation .mw-headline}

Not sure where to go from here? There are many paths to explore\...
Gentoo provides its users with lots of possibilities and therefore has
lots of documented (and less documented) features to explore here on the
wiki and on other Gentoo related sub-domains (see the [Gentoo
online](#Gentoo_online) section below).

Readers should definitely take a look at the next part of the Gentoo
Handbook entitled [Working with
Gentoo](/wiki/Handbook:AMD64/Working/Portage "Handbook:AMD64/Working/Portage")
which explains how to keep the software up to date, install additional
software packages, details on USE flags, the OpenRC init system, and
various other informative topics relating to managing a Gentoo system
post-installation.

Apart from the handbook, readers should also feel encouraged to explore
other corners of the Gentoo wiki to find additional, community-provided
documentation. The Gentoo wiki team also offers a [documentation topic
overview](/wiki/Main_Page#Documentation_topics "Main Page") which lists
a selection of wiki articles by category. For instance, it refers to the
[localization guide](/wiki/Localization/Guide "Localization/Guide") to
make a system feel more at home (particularly useful for users who speak
English as a second language).

### [Gentoo online]{#Gentoo_online .mw-headline}

::: {.alert .alert-warning .gw-box style="padding-top: 8px; padding-bottom: 8px;"}
** Important**\
Readers should note that all official Gentoo sites online are governed
by Gentoo\'s [code of
conduct](/wiki/Project:Council/Code_of_conduct "Project:Council/Code of conduct").
Being active in the Gentoo community is a privilege, not a right, and
users should be aware that the code of conduct exists for a reason.
:::

With the exception of the Freenode hosted internet relay chat (IRC)
network and the mailing lists, most Gentoo websites require an account
on a per site basis in order to ask questions, open a discussion, or
enter a bug.

#### [Forums and IRC]{#Forums_and_IRC .mw-headline}

Every user is welcome on our [Gentoo
forums](https://forums.gentoo.org){.external .text} or on one of our
[internet relay chat
channels](https://www.gentoo.org/get-involved/irc-channels/){.external
.text}. It is easy to search for the forums to see if an issue
experienced on a fresh Gentoo install has been discovered in the past
and resolved after some feedback. The likelihood of other users
experiencing the installation issues by first-time Gentoo can be
surprising. It is advised users search the forums and the wiki before
asking for assistance in Gentoo support channels.

#### [Mailing lists]{#Mailing_lists .mw-headline}

[Several mailing
lists](https://www.gentoo.org/get-involved/mailing-lists/){.external
.text} are available to the community members who prefer to ask for
support or feedback over email rather than create a user account on the
forums or IRC. Users will need to follow the instructions in order to
subscribe to specific mailing lists.

#### [Bugs]{#Bugs .mw-headline}

Sometimes after reviewing the wiki, searching the forums, and seeking
support in the IRC channel or mailing lists there is no known solution
to a problem. Generally this is a sign to open a bug on Gentoo\'s
[Bugzilla site](https://bugs.gentoo.org){.external .text}.

#### [Development guide]{#Development_guide .mw-headline}

Readers who desire to learn more about developing Gentoo can take a look
at the [Development guide](https://devmanual.gentoo.org/){.external
.text}. This guide provides instructions on writing ebuilds, working
with eclasses, and provides definitions for many [general
concepts](https://devmanual.gentoo.org/general-concepts/index.html){.external
.text} behind Gentoo development.

### [Closing thoughts]{#Closing_thoughts .mw-headline}

Gentoo is a robust, flexible, and excellently maintained distribution.
The developer community is happy to hear feedback on how to make Gentoo
an even *better* distribution.

As a reminder, any feedback for *this handbook* should follow the
guidelines detailed in the [How do I improve the
Handbook?](/wiki/Handbook:Main_Page#How_do_I_improve_the_Handbook.3F "Handbook:Main Page")
section at the beginning of the handbook.

We look forward to seeing how our users will choose to implement Gentoo!

\

\

\

\

\

::: {.printfooter}
Retrieved from
\"<https://wiki.gentoo.org/index.php?title=Handbook:AMD64/Full/Installation&oldid=229552>\"
:::

::: {#catlinks .catlinks .catlinks-allhidden mw="interface"}
:::

::: {.container}
::: {.row}
::: {.col-xs-12 .col-md-offset-2 .col-md-7}
::: {.spacer}
:::

-   [This page was last edited on 4 January 2015, at 15:16.]{#lastmod>}
-   [[Privacy
    policy](/wiki/Gentoo_Wiki:Privacy_policy "Gentoo Wiki:Privacy policy"){.mw-redirect}]{#privacy>}
-   [[About Gentoo
    Wiki](/wiki/Gentoo_Wiki:About "Gentoo Wiki:About")]{#about>}
-   [[Disclaimers](/wiki/Gentoo_Wiki:General_disclaimer "Gentoo Wiki:General disclaimer")]{#disclaimer>}
:::

::: {.col-xs-12 .col-md-3}
:::
:::

::: {.row}
::: {.col-xs-3 .col-md-2}
-   [[]{.fa .fa-twitter
    .fa-fw}](https://twitter.com/gentoo "@Gentoo on Twitter")
-   [[]{.fa .fa-facebook
    .fa-fw}](https://www.facebook.com/gentoo.org "Gentoo on Facebook")
-   
:::

::: {.col-xs-9 .col-md-9}
**Â© 2001--2020 Gentoo Foundation, Inc.**\
[Gentoo is a trademark of the Gentoo Foundation, Inc. The contents of
this document, unless otherwise expressly stated, are licensed under the
[CC-BY-SA-3.0](https://creativecommons.org/licenses/by-sa/3.0/) license.
The [Gentoo Name and Logo Usage
Guidelines](https://www.gentoo.org/inside-gentoo/foundation/name-logo-guidelines.html)
apply.]{.small}
:::
:::
:::
